<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>XL Lease Generator</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --navy: #0d1b2a;
    --navy-mid: #1a2f45;
    --navy-light: #243b55;
    --gold: #c9a84c;
    --gold-light: #e8c97a;
    --cream: #f7f4ef;
    --white: #ffffff;
    --text: #1a1a2e;
    --text-muted: #6b7280;
    --border: #e2ddd5;
    --success: #2d6a4f;
    --danger: #c0392b;
    --radius: 6px;
    --shadow: 0 2px 16px rgba(13,27,42,0.10);
    --shadow-lg: 0 8px 40px rgba(13,27,42,0.18);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--cream);
    color: var(--text);
    min-height: 100vh;
  }

  /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
  header {
    background: var(--navy);
    padding: 18px 40px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 2px 20px rgba(0,0,0,0.3);
  }
  .logo {
    font-family: 'Playfair Display', serif;
    color: var(--gold);
    font-size: 1.35rem;
    letter-spacing: 0.04em;
  }
  .logo span { color: var(--white); font-weight: 400; }

  /* ‚îÄ‚îÄ PROGRESS ‚îÄ‚îÄ */
  .progress-bar {
    display: flex;
    align-items: center;
    gap: 0;
  }
  .step-dot {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: default;
  }
  .step-dot .dot {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    border: 2px solid rgba(201,168,76,0.3);
    color: rgba(255,255,255,0.4);
    font-size: 0.72rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s;
    flex-shrink: 0;
  }
  .step-dot.active .dot {
    border-color: var(--gold);
    background: var(--gold);
    color: var(--navy);
  }
  .step-dot.done .dot {
    border-color: var(--gold);
    background: transparent;
    color: var(--gold);
  }
  .step-dot .label {
    font-size: 0.7rem;
    color: rgba(255,255,255,0.4);
    letter-spacing: 0.06em;
    text-transform: uppercase;
    white-space: nowrap;
    transition: color 0.3s;
  }
  .step-dot.active .label { color: var(--gold-light); }
  .step-dot.done .label { color: rgba(255,255,255,0.6); }
  .step-connector {
    width: 32px;
    height: 1px;
    background: rgba(201,168,76,0.2);
    margin: 0 4px;
  }

  /* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
  main {
    max-width: 820px;
    margin: 0 auto;
    padding: 48px 24px 80px;
  }

  .screen { display: none; }
  .screen.active { display: block; animation: fadeIn 0.3s ease; }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .screen-title {
    font-family: 'Playfair Display', serif;
    font-size: 1.9rem;
    color: var(--navy);
    margin-bottom: 6px;
  }
  .screen-sub {
    color: var(--text-muted);
    font-size: 0.92rem;
    margin-bottom: 36px;
    font-weight: 300;
  }

  /* ‚îÄ‚îÄ PROPERTY TYPE CARDS ‚îÄ‚îÄ */
  .type-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 16px;
    margin-bottom: 40px;
  }
  .type-card {
    background: var(--white);
    border: 2px solid var(--border);
    border-radius: 10px;
    padding: 28px 24px;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
    overflow: hidden;
  }
  .type-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 3px;
    background: var(--gold);
    transform: scaleX(0);
    transition: transform 0.2s;
  }
  .type-card:hover { border-color: var(--gold); box-shadow: var(--shadow); transform: translateY(-2px); }
  .type-card:hover::before { transform: scaleX(1); }
  .type-card.selected { border-color: var(--gold); background: #fffdf7; box-shadow: var(--shadow); }
  .type-card.selected::before { transform: scaleX(1); }
  .type-icon { font-size: 1.8rem; margin-bottom: 12px; }
  .type-name {
    font-family: 'Playfair Display', serif;
    font-size: 1.1rem;
    color: var(--navy);
    margin-bottom: 4px;
  }
  .type-desc { font-size: 0.8rem; color: var(--text-muted); line-height: 1.4; }
  .type-badge {
    display: inline-block;
    background: var(--navy);
    color: var(--gold);
    font-size: 0.65rem;
    font-weight: 600;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    padding: 2px 8px;
    border-radius: 20px;
    margin-top: 8px;
  }

  /* ‚îÄ‚îÄ FORM SECTION ‚îÄ‚îÄ */
  .card {
    background: var(--white);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 28px;
    margin-bottom: 20px;
    box-shadow: var(--shadow);
  }
  .card-title {
    font-family: 'Playfair Display', serif;
    font-size: 1.1rem;
    color: var(--navy);
    margin-bottom: 20px;
    padding-bottom: 14px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .card-title .tag {
    font-family: 'DM Sans', sans-serif;
    font-size: 0.65rem;
    font-weight: 600;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    background: var(--cream);
    color: var(--text-muted);
    padding: 2px 8px;
    border-radius: 4px;
  }

  /* Toggle row for REBNY/Blumberg */
  .toggle-row {
    display: flex;
    gap: 12px;
    margin-bottom: 24px;
  }
  .toggle-opt {
    flex: 1;
    border: 2px solid var(--border);
    border-radius: 8px;
    padding: 16px 20px;
    cursor: pointer;
    transition: all 0.2s;
    text-align: center;
  }
  .toggle-opt:hover { border-color: var(--navy-light); }
  .toggle-opt.selected { border-color: var(--navy); background: var(--navy); color: var(--white); }
  .toggle-opt .t-name { font-weight: 600; font-size: 0.95rem; margin-bottom: 2px; }
  .toggle-opt .t-sub { font-size: 0.75rem; opacity: 0.7; }

  /* Form grid */
  .form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
  }
  .form-grid.cols-3 { grid-template-columns: 1fr 1fr 1fr; }
  .form-grid.cols-1 { grid-template-columns: 1fr; }
  .field { display: flex; flex-direction: column; gap: 6px; }
  .field.span-2 { grid-column: span 2; }
  .field.span-3 { grid-column: span 3; }
  label {
    font-size: 0.78rem;
    font-weight: 500;
    color: var(--text-muted);
    letter-spacing: 0.04em;
    text-transform: uppercase;
  }
  input, select, textarea {
    font-family: 'DM Sans', sans-serif;
    font-size: 0.92rem;
    padding: 10px 14px;
    border: 1.5px solid var(--border);
    border-radius: var(--radius);
    background: var(--white);
    color: var(--text);
    transition: border-color 0.2s;
    outline: none;
    width: 100%;
  }
  input:focus, select:focus, textarea:focus {
    border-color: var(--navy-light);
    box-shadow: 0 0 0 3px rgba(36,59,85,0.08);
  }
  textarea { resize: vertical; min-height: 80px; }

  /* ‚îÄ‚îÄ CLAUSES ‚îÄ‚îÄ */
  .clause-list { display: flex; flex-direction: column; gap: 12px; }
  .clause-item {
    display: flex;
    align-items: flex-start;
    gap: 14px;
    padding: 16px;
    border: 1.5px solid var(--border);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
    background: var(--white);
  }
  .clause-item:hover { border-color: var(--navy-light); background: #fafaf8; }
  .clause-item.included { border-color: var(--success); background: #f0faf4; }
  .clause-item.struck { border-color: var(--danger); background: #fdf4f4; }

  .clause-check {
    width: 22px;
    height: 22px;
    border-radius: 4px;
    border: 2px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    margin-top: 1px;
    transition: all 0.2s;
    font-size: 0.75rem;
  }
  .clause-item.included .clause-check { background: var(--success); border-color: var(--success); color: white; }
  .clause-item.struck .clause-check { background: var(--danger); border-color: var(--danger); color: white; }

  .clause-body { flex: 1; }
  .clause-name { font-weight: 600; font-size: 0.9rem; margin-bottom: 3px; }
  .clause-item.struck .clause-name { text-decoration: line-through; color: var(--text-muted); }
  .clause-preview { font-size: 0.8rem; color: var(--text-muted); line-height: 1.4; }

  .clause-controls {
    display: flex;
    gap: 6px;
    flex-shrink: 0;
  }
  .ctrl-btn {
    padding: 4px 10px;
    border-radius: 4px;
    border: 1.5px solid var(--border);
    font-size: 0.72rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    background: white;
    color: var(--text-muted);
  }
  .ctrl-btn:hover { border-color: var(--navy); color: var(--navy); }
  .ctrl-btn.active-include { background: var(--success); border-color: var(--success); color: white; }
  .ctrl-btn.active-strike { background: var(--danger); border-color: var(--danger); color: white; }

  /* ‚îÄ‚îÄ RIDERS ‚îÄ‚îÄ */
  .riders-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
  }
  .rider-card {
    border: 1.5px solid var(--border);
    border-radius: 8px;
    padding: 16px 18px;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: flex-start;
    gap: 12px;
  }
  .rider-card:hover { border-color: var(--navy-light); }
  .rider-card.checked { border-color: var(--navy); background: #f5f8ff; }
  .rider-card.required { border-color: var(--gold); background: #fffdf5; }
  .rider-check {
    width: 20px;
    height: 20px;
    border-radius: 4px;
    border: 2px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    font-size: 0.7rem;
    transition: all 0.2s;
  }
  .rider-card.checked .rider-check,
  .rider-card.required .rider-check {
    background: var(--navy);
    border-color: var(--navy);
    color: white;
  }
  .rider-card.required .rider-check { background: var(--gold); border-color: var(--gold); color: var(--navy); }
  .rider-info { flex: 1; }
  .rider-name { font-weight: 600; font-size: 0.88rem; margin-bottom: 3px; }
  .rider-desc { font-size: 0.76rem; color: var(--text-muted); line-height: 1.35; }
  .rider-badge {
    font-size: 0.63rem;
    font-weight: 700;
    letter-spacing: 0.07em;
    text-transform: uppercase;
    margin-top: 5px;
    display: inline-block;
  }
  .rider-badge.req { color: #8b6914; }
  .rider-badge.law { color: var(--success); }

  /* ‚îÄ‚îÄ PREVIEW ‚îÄ‚îÄ */
  .preview-meta {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 14px;
    margin-bottom: 28px;
  }
  .meta-chip {
    background: var(--white);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 14px 18px;
  }
  .meta-chip .m-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.06em; color: var(--text-muted); margin-bottom: 4px; }
  .meta-chip .m-val { font-weight: 600; font-size: 0.95rem; color: var(--navy); }

  .preview-doc {
    background: var(--white);
    border: 1px solid var(--border);
    border-radius: 10px;
    overflow: hidden;
    box-shadow: var(--shadow-lg);
  }
  .doc-header {
    background: var(--navy);
    padding: 20px 28px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .doc-header-title { color: var(--gold); font-family: 'Playfair Display', serif; font-size: 1.05rem; }
  .doc-header-sub { color: rgba(255,255,255,0.5); font-size: 0.78rem; margin-top: 2px; }
  .doc-pages {
    display: flex;
    border-top: 1px solid var(--border);
  }
  .doc-sidebar {
    width: 200px;
    border-right: 1px solid var(--border);
    padding: 16px 0;
    background: #fafaf8;
    flex-shrink: 0;
  }
  .sidebar-section { padding: 8px 16px; }
  .sidebar-section-title {
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-muted);
    font-weight: 600;
    margin-bottom: 6px;
  }
  .sidebar-item {
    font-size: 0.8rem;
    padding: 5px 8px;
    border-radius: 4px;
    cursor: pointer;
    transition: background 0.15s;
    color: var(--text);
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .sidebar-item:hover { background: var(--border); }
  .sidebar-item.active { background: var(--navy); color: white; }
  .sidebar-item .item-icon { font-size: 0.8rem; }
  .sidebar-divider { height: 1px; background: var(--border); margin: 10px 0; }

  .doc-content {
    flex: 1;
    padding: 32px;
    max-height: 520px;
    overflow-y: auto;
    font-size: 0.87rem;
    line-height: 1.7;
    color: var(--text);
  }
  .doc-section-heading {
    font-family: 'Playfair Display', serif;
    font-size: 1rem;
    color: var(--navy);
    margin: 20px 0 10px;
    padding-bottom: 6px;
    border-bottom: 1px solid var(--border);
  }
  .doc-section-heading:first-child { margin-top: 0; }
  .blank { border-bottom: 1px solid #999; display: inline-block; min-width: 120px; color: var(--navy); font-weight: 500; }
  .struck-text { text-decoration: line-through; color: var(--text-muted); }

  /* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
  .btn-row {
    display: flex;
    justify-content: flex-end;
    gap: 12px;
    margin-top: 32px;
  }
  .btn {
    font-family: 'DM Sans', sans-serif;
    font-size: 0.9rem;
    font-weight: 500;
    padding: 12px 28px;
    border-radius: var(--radius);
    border: none;
    cursor: pointer;
    transition: all 0.2s;
    letter-spacing: 0.02em;
  }
  .btn-ghost {
    background: transparent;
    border: 1.5px solid var(--border);
    color: var(--text-muted);
  }
  .btn-ghost:hover { border-color: var(--navy); color: var(--navy); }
  .btn-primary {
    background: var(--navy);
    color: var(--white);
  }
  .btn-primary:hover { background: var(--navy-mid); box-shadow: 0 4px 16px rgba(13,27,42,0.25); }
  .btn-gold {
    background: var(--gold);
    color: var(--navy);
    font-weight: 700;
  }
  .btn-gold:hover { background: var(--gold-light); box-shadow: 0 4px 16px rgba(201,168,76,0.3); }

  .export-row {
    display: flex;
    gap: 12px;
    margin-top: 20px;
    flex-wrap: wrap;
  }
  .export-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 11px 22px;
    border-radius: var(--radius);
    border: 1.5px solid var(--border);
    cursor: pointer;
    background: white;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.88rem;
    font-weight: 500;
    transition: all 0.2s;
  }
  .export-btn:hover { border-color: var(--navy); box-shadow: var(--shadow); }
  .export-btn.primary { background: var(--navy); color: white; border-color: var(--navy); }
  .export-btn.primary:hover { background: var(--navy-mid); }
  .export-btn .icon { font-size: 1rem; }

  /* ‚îÄ‚îÄ STABILIZED BADGE ‚îÄ‚îÄ */
  .stab-pill {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: #fff3cd;
    border: 1px solid #f0c040;
    color: #7a5c00;
    font-size: 0.75rem;
    font-weight: 600;
    padding: 4px 12px;
    border-radius: 20px;
    margin-bottom: 20px;
  }

  /* ‚îÄ‚îÄ SECTION DIVIDER ‚îÄ‚îÄ */
  .section-divider {
    display: flex;
    align-items: center;
    gap: 14px;
    margin: 28px 0 20px;
  }
  .section-divider span {
    font-size: 0.72rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--text-muted);
    font-weight: 600;
    white-space: nowrap;
  }
  .section-divider::before, .section-divider::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--border);
  }

  /* scrollbar */
  .doc-content::-webkit-scrollbar { width: 6px; }
  .doc-content::-webkit-scrollbar-track { background: var(--cream); }
  .doc-content::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

  @media (max-width: 640px) {
    header { padding: 14px 16px; }
    .step-dot .label { display: none; }
    main { padding: 28px 16px 60px; }
    .form-grid { grid-template-columns: 1fr; }
    .form-grid.cols-3 { grid-template-columns: 1fr; }
    .field.span-2, .field.span-3 { grid-column: span 1; }
    .riders-grid { grid-template-columns: 1fr; }
    .preview-meta { grid-template-columns: 1fr 1fr; }
    .doc-sidebar { display: none; }
  }

  /* ‚îÄ‚îÄ PIN Gate ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  #pinGate {
    position: fixed;
    inset: 0;
    background: var(--navy);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    flex-direction: column;
  }
  #pinGate.hidden { display: none; }

  .pin-card {
    background: var(--navy-mid);
    border: 1px solid rgba(201,168,76,0.25);
    border-radius: 12px;
    padding: 48px 44px 44px;
    width: 100%;
    max-width: 380px;
    text-align: center;
    box-shadow: var(--shadow-lg);
  }
  .pin-logo {
    font-family: 'Playfair Display', serif;
    font-size: 26px;
    font-weight: 700;
    color: var(--white);
    letter-spacing: 0.04em;
    margin-bottom: 6px;
  }
  .pin-logo span { color: var(--gold); }
  .pin-subtitle {
    font-size: 12px;
    color: var(--text-muted);
    letter-spacing: 0.08em;
    text-transform: uppercase;
    margin-bottom: 36px;
  }
  .pin-label {
    font-size: 11px;
    color: var(--text-muted);
    letter-spacing: 0.1em;
    text-transform: uppercase;
    margin-bottom: 10px;
    text-align: left;
  }
  .pin-input {
    width: 100%;
    background: var(--navy);
    border: 1px solid rgba(201,168,76,0.3);
    border-radius: var(--radius);
    color: var(--white);
    font-size: 22px;
    letter-spacing: 0.35em;
    text-align: center;
    padding: 14px 16px;
    outline: none;
    transition: border-color 0.2s;
    font-family: 'DM Sans', sans-serif;
    -webkit-text-security: disc;
  }
  .pin-input:focus { border-color: var(--gold); }
  .pin-input.error { border-color: var(--danger); animation: pinShake 0.35s ease; }
  .pin-error {
    font-size: 12px;
    color: #e07070;
    margin-top: 10px;
    min-height: 18px;
    text-align: center;
  }
  .pin-btn {
    margin-top: 24px;
    width: 100%;
    background: var(--gold);
    color: var(--navy);
    border: none;
    border-radius: var(--radius);
    padding: 14px;
    font-size: 13px;
    font-weight: 600;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    cursor: pointer;
    transition: background 0.2s, transform 0.1s;
    font-family: 'DM Sans', sans-serif;
  }
  .pin-btn:hover { background: var(--gold-light); }
  .pin-btn:active { transform: scale(0.98); }
  @keyframes pinShake {
    0%,100% { transform: translateX(0); }
    20%      { transform: translateX(-8px); }
    40%      { transform: translateX(8px); }
    60%      { transform: translateX(-6px); }
    80%      { transform: translateX(6px); }
  }
</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê PIN GATE ‚ïê‚ïê‚ïê -->
<div id="pinGate">
  <div class="pin-card">
    <div class="pin-logo">XL<span>.</span></div>
    <div class="pin-subtitle">Lease Generator</div>
    <div class="pin-label">Enter PIN to continue</div>
    <input
      class="pin-input"
      id="pinInput"
      type="password"
      inputmode="numeric"
      maxlength="8"
      autocomplete="off"
      placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
      onkeydown="if(event.key==='Enter') submitPin()"
    />
    <div class="pin-error" id="pinError"></div>
    <button class="pin-btn" onclick="submitPin()">Unlock</button>
  </div>
</div>

<header>
  <div class="logo">XL<span> Lease Generator</span></div>
  <nav class="progress-bar" id="progressBar">
    <div class="step-dot active" data-step="1"><div class="dot">1</div><div class="label">Property</div></div>
    <div class="step-connector"></div>
    <div class="step-dot" data-step="2"><div class="dot">2</div><div class="label">Details</div></div>
    <div class="step-connector"></div>
    <div class="step-dot" data-step="3"><div class="dot">3</div><div class="label">Clauses</div></div>
    <div class="step-connector"></div>
    <div class="step-dot" data-step="4"><div class="dot">4</div><div class="label">Riders</div></div>
    <div class="step-connector"></div>
    <div class="step-dot" data-step="5"><div class="dot">5</div><div class="label">Preview</div></div>
  </nav>
</header>

<main>

  <!-- ‚ïê‚ïê‚ïê STEP 1: PROPERTY TYPE ‚ïê‚ïê‚ïê -->
  <div class="screen active" id="step1">
    <h1 class="screen-title">What type of property is this?</h1>
    <p class="screen-sub">Select the property classification to load the appropriate lease framework.</p>
    <div class="type-grid">
      <div class="type-card" data-type="condo" onclick="selectType(this)">
        <div class="type-icon">üèôÔ∏è</div>
        <div class="type-name">Condominium</div>
        <div class="type-desc">Owner-leased unit in a condo building with board rules and proprietary regulations.</div>
      </div>
      <div class="type-card" data-type="coop" onclick="selectType(this)">
        <div class="type-icon">üèõÔ∏è</div>
        <div class="type-name">Co-op</div>
        <div class="type-desc">Sublet from a shareholder, subject to co-op board approval and house rules.</div>
      </div>
      <div class="type-card" data-type="townhouse" onclick="selectType(this)">
        <div class="type-icon">üè°</div>
        <div class="type-name">Townhouse</div>
        <div class="type-desc">Entire building or floor-through in a multi-story row or detached home.</div>
      </div>
      <div class="type-card" data-type="rental" onclick="selectType(this)">
        <div class="type-icon">üîë</div>
        <div class="type-name">Rental</div>
        <div class="type-desc">Standard apartment rental directly from a landlord or management company.</div>
      </div>
      <div class="type-card" data-type="stabilized" onclick="selectType(this)">
        <div class="type-icon">‚öñÔ∏è</div>
        <div class="type-name">Rent Stabilized</div>
        <div class="type-desc">Unit subject to NYC Rent Stabilization Laws with regulated rent and renewal rights.</div>
        <div class="type-badge">Regulated</div>
      </div>
      <div class="type-card" data-type="commercial" onclick="selectType(this)">
        <div class="type-icon">üè¢</div>
        <div class="type-name">Commercial</div>
        <div class="type-desc">Retail, restaurant, or general commercial space. Non-residential lease terms apply.</div>
        <div class="type-badge" style="background:rgba(45,106,79,0.15);color:#2d6a4f;border-color:rgba(45,106,79,0.3);">Commercial</div>
      </div>
      <div class="type-card" data-type="office" onclick="selectType(this)">
        <div class="type-icon">üíº</div>
        <div class="type-name">Office</div>
        <div class="type-desc">Professional office space including suites, floors, and co-working arrangements.</div>
        <div class="type-badge" style="background:rgba(45,106,79,0.15);color:#2d6a4f;border-color:rgba(45,106,79,0.3);">Commercial</div>
      </div>
    </div>
    <div class="btn-row">
      <button class="btn btn-primary" onclick="goToStep(2)">Continue ‚Üí</button>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê STEP 2: DEAL DETAILS ‚ïê‚ïê‚ïê -->
  <div class="screen" id="step2">
    <h1 class="screen-title">Lease Details</h1>
    <p class="screen-sub" id="step2Sub">Fill in the deal terms. All fields marked with lease blanks will be auto-populated.</p>

    <!-- Stabilized notice -->
    <div id="stabNotice" style="display:none" class="stab-pill">‚öñÔ∏è Rent Stabilized ‚Äî additional regulated fields included below</div>

    <!-- Stabilized form notice (replaces REBNY/Blumberg toggle) -->
    <div id="stabFormNotice" style="display:none" class="card">
      <div class="card-title">Lease Form <span class="tag">Regulated</span></div>
      <div style="display:flex; align-items:center; gap:12px; padding:14px 16px; background:#fffdf5; border:1.5px solid var(--gold); border-radius:8px;">
        <span style="font-size:1.4rem;">‚öñÔ∏è</span>
        <div>
          <div style="font-weight:600; font-size:0.95rem; color:var(--navy);">NYC Rent Stabilized Lease (RTP-8 / DHCR Form)</div>
          <div style="font-size:0.8rem; color:var(--text-muted); margin-top:2px;">Rent stabilized tenancies use the DHCR-prescribed form only. REBNY and Blumberg forms do not apply.</div>
        </div>
      </div>
    </div>

    <!-- Lease Form -->
    <div class="card" id="leaseFormCard">
      <div class="card-title">Lease Form <span class="tag">Required</span></div>
      <div class="toggle-row">
        <div class="toggle-opt selected" id="opt-rebny" onclick="selectForm('rebny')">
          <div class="t-name">REBNY</div>
          <div class="t-sub">Real Estate Board of NY standard form</div>
        </div>
        <div class="toggle-opt" id="opt-blumberg" onclick="selectForm('blumberg')">
          <div class="t-name">Blumberg</div>
          <div class="t-sub">Blumberg standard residential form</div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-title">Premises</div>
      <div class="form-grid">
        <div class="field span-2">
          <label>Property Address</label>
          <input type="text" id="address" placeholder="123 West 72nd Street, New York, NY 10023">
        </div>
        <div class="field">
          <label>Apartment / Unit</label>
          <input type="text" id="unit" placeholder="Apt 4B">
        </div>
        <div class="field">
          <label>Floor</label>
          <input type="text" id="floor" placeholder="4th">
        </div>
        <div class="field" id="buildingNameField" style="display:none">
          <label>Building / Condo Name</label>
          <input type="text" id="buildingName" placeholder="The Ansonia">
        </div>
        <div class="field span-2" id="permittedOccupantsField">
          <label>Permitted Occupants <span style="font-weight:400;color:var(--text-muted);font-size:0.8rem;">(names of all additional occupants beyond primary tenant)</span></label>
          <input type="text" id="permittedOccupants" placeholder="Leave blank if none beyond named tenant(s)">
        </div>
        <div class="field" id="boroughField">
          <label>Borough</label>
          <select id="borough">
            <option>Manhattan</option>
            <option>Brooklyn</option>
            <option>Queens</option>
            <option>Bronx</option>
            <option>Staten Island</option>
          </select>
        </div>
        <div class="field" id="boardApprovalField" style="display:none">
          <label>Board Approval Required?</label>
          <select id="boardApproval">
            <option>Yes</option>
            <option>No</option>
            <option>Waived</option>
          </select>
        </div>
        <div class="field" id="apartmentCorpField" style="display:none">
          <label>Apartment Corporation Name</label>
          <input type="text" id="apartmentCorp" placeholder="e.g. 123 West 72nd Owners Corp.">
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-title">Parties</div>
      <div class="form-grid">
        <div class="field">
          <label>Landlord / Owner Full Legal Name</label>
          <input type="text" id="landlord" placeholder="Jane Smith">
        </div>
        <div class="field">
          <label>Landlord Entity Type</label>
          <select id="landlordType">
            <option>Individual</option>
            <option>LLC</option>
            <option>Trust</option>
            <option>Corporation</option>
          </select>
        </div>
        <div class="field span-2">
          <label>Landlord Address (for notices)</label>
          <input type="text" id="landlordAddr" value="c/o XL Real Property Management, 80 Fifth Avenue, Suite 1501, New York, NY 10011">
        </div>
        <div class="field">
          <label>Owner / Landlord Email</label>
          <input type="email" id="landlordEmail" value="josh@xl-rpm.com">
        </div>
        <div class="field">
          <label>Tenant(s) Full Legal Name(s)</label>
          <input type="text" id="tenant" placeholder="John Doe and Mary Doe">
        </div>
        <div class="field">
          <label>Tenant Email</label>
          <input type="email" id="tenantEmail" placeholder="tenant@email.com">
        </div>
        <div class="field span-2">
          <label>Tenant Current Address</label>
          <input type="text" id="tenantCurrentAddr" placeholder="789 Broadway, Apt 2C, New York, NY 10003">
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-title">Lease Term & Financials</div>
      <div class="form-grid cols-3">
        <div class="field">
          <label>Lease Start Date</label>
          <input type="date" id="startDate">
        </div>
        <div class="field">
          <label>Lease End Date</label>
          <input type="date" id="endDate">
        </div>
        <div class="field">
          <label>Monthly Rent</label>
          <input type="text" id="rent" placeholder="$4,500.00">
        </div>
        <div class="field">
          <label>Security Deposit</label>
          <input type="text" id="deposit" placeholder="$4,500.00">
        </div>

        <div class="field">
          <label>Rent Due Day</label>
          <select id="dueDay">
            <option>1st of the month</option>
            <option>15th of the month</option>
            <option>Other</option>
          </select>
        </div>
        <div class="field">
          <label>Security Deposit Bank</label>
          <input type="text" id="securityBank" value="Chase">
        </div>
        <div class="field span-2">
          <label>Bank Address</label>
          <input type="text" id="securityBankAddr" value="610 Madison Avenue, New York, NY">
        </div>
        <div class="field">
          <label>Rent Payment Method</label>
          <select id="paymentMethod">
            <option>Check</option>
            <option>Direct Deposit / ACH</option>
            <option>Check or Direct Deposit</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Renewal Options -->
    <div id="renewalCard" class="card">
      <div class="card-title">Renewal Option <span class="tag">Optional</span></div>
      <div class="form-grid">
        <div class="field">
          <label>Number of Renewal Options</label>
          <select id="renewalCount" onchange="toggleRenewalFields()">
            <option value="0">None</option>
            <option value="1" selected>1 option</option>
            <option value="2">2 options</option>
            <option value="3">3 options</option>
            <option value="4">4 options</option>
          </select>
        </div>
        <div class="field" id="renewalTermWrap">
          <label>Renewal Term Length</label>
          <select id="renewalTerm">
            <option value="1 year">1 year</option>
            <option value="2 years">2 years</option>
            <option value="the same term as the initial Lease">Same as initial term</option>
            <option value="month-to-month">Month-to-month</option>
          </select>
        </div>
        <div class="field" id="renewalNoticeWrap">
          <label>Notice Required to Exercise</label>
          <select id="renewalNotice">
            <option value="30">30 days</option>
            <option value="60" selected>60 days</option>
            <option value="90">90 days</option>
            <option value="120">120 days</option>
          </select>
        </div>
        <div class="field" id="renewalRentTypeWrap">
          <label>Renewal Rent</label>
          <select id="renewalRentType" onchange="toggleRenewalRentField()">
            <option value="tbd">To be mutually agreed upon</option>
            <option value="pct">Fixed % increase above current rent</option>
            <option value="fixed">Fixed dollar amount</option>
          </select>
        </div>
        <div class="field" id="renewalRentValWrap" style="display:none">
          <label id="renewalRentValLabel">Amount</label>
          <input type="text" id="renewalRentVal" placeholder="e.g. 3% or $4,750.00">
        </div>
      </div>
    </div>

    <!-- Stabilized-only fields -->
    <div id="stabFields" style="display:none" class="card">
      <div class="card-title">Rent Stabilization <span class="tag">Regulated</span></div>
      <div class="form-grid">
        <div class="field">
          <label>Legal Registered Rent</label>
          <input type="text" id="legalRent" placeholder="$3,200.00">
        </div>
        <div class="field">
          <label>Preferential Rent (if any)</label>
          <input type="text" id="prefRent" placeholder="$2,900.00">
        </div>
        <div class="field">
          <label>RGB Lease Year / Guidelines Order</label>
          <input type="text" id="rgbOrder" placeholder="e.g. Order #55">
        </div>
        <div class="field">
          <label>Prior Tenant Vacated</label>
          <select id="vacated">
            <option>Yes</option>
            <option>No (renewal)</option>
          </select>
        </div>
        <div class="field">
          <label>DHCR Registration No.</label>
          <input type="text" id="dhcrNo" placeholder="e.g. 001-0001234-R">
        </div>
        <div class="field">
          <label>Lease Type</label>
          <select id="stabLeaseType">
            <option>Initial Stabilized Lease</option>
            <option>Renewal Lease</option>
          </select>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-title">Use & Occupancy</div>
      <div class="form-grid">
        <div class="field">
          <label>Furnished?</label>
          <div style="display:flex;gap:10px;margin-top:4px;">
            <label style="display:flex;align-items:center;gap:6px;cursor:pointer;font-weight:400;font-size:0.9rem;">
              <input type="radio" name="furnished" id="furnishedNo" value="no" checked onchange="onFurnishedChange()"> Unfurnished
            </label>
            <label style="display:flex;align-items:center;gap:6px;cursor:pointer;font-weight:400;font-size:0.9rem;">
              <input type="radio" name="furnished" id="furnishedYes" value="yes" onchange="onFurnishedChange()"> Furnished
            </label>
          </div>
        </div>
        <div class="field">
          <label>Max Occupants</label>
          <input type="number" id="maxOccupants" placeholder="2" min="1">
        </div>
        <div class="field">
          <label>Broker (if any)</label>
          <input type="text" id="broker" placeholder="Brokerage firm name">
        </div>
        <div class="field">
          <label>Broker Fee Paid By</label>
          <select id="brokerFee">
            <option>Tenant</option>
            <option>Landlord</option>
            <option>N/A ‚Äî No broker</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Condo/Co-op extras ‚Äî shown for condo/coop only -->
    <div id="condoCoopFields" style="display:none" class="card">
      <div class="card-title">Condominium / Co-op Details <span class="tag">Conditional</span></div>
      <div class="form-grid">
        <div class="field" id="garageSpaceFieldWrap">
          <label>Garage Space # (if any)</label>
          <input type="text" id="garageSpace" placeholder="e.g. G-14 or N/A">
        </div>
        <div class="field" id="garageFeeFieldWrap">
          <label>Garage Fee (monthly)</label>
          <input type="text" id="garageFee" placeholder="$0.00 or N/A">
        </div>
        <div class="field" id="leasePackageDueWrap">
          <label>Lease Package Due Date</label>
          <input type="date" id="leasePackageDue">
        </div>
        <div class="field">
          <label>Tenant Insurance Minimum</label>
          <input type="text" id="tenantInsurance" placeholder="e.g. $300,000">
        </div>
      </div>
    </div>

    <!-- Attorney section ‚Äî shown for REBNY-based forms -->
    <div class="card" id="attorneyCard" style="display:none">
      <div class="card-title">Attorneys <span class="tag">Optional</span></div>
      <div class="form-grid">
        <div class="field">
          <label>Landlord&#39;s Attorney</label>
          <input type="text" id="landlordAtty" placeholder="Firm name or attorney name">
        </div>
        <div class="field">
          <label>Landlord Attorney Address</label>
          <input type="text" id="landlordAttyAddr" placeholder="Address">
        </div>
        <div class="field">
          <label>Tenant&#39;s Attorney</label>
          <input type="text" id="tenantAtty" placeholder="Firm name or attorney name">
        </div>
        <div class="field">
          <label>Tenant Attorney Address</label>
          <input type="text" id="tenantAttyAddr" placeholder="Address">
        </div>
      </div>
    </div>

    <!-- Billing -->
    <div class="card" id="billingCard">
      <div class="card-title">Lease Drafting Fee <span class="tag">Invoice</span></div>
      <div class="form-grid">
        <div class="field">
          <label>Bill Owner for Lease Drafting?</label>
          <div style="display:flex;gap:10px;margin-top:4px;">
            <label style="display:flex;align-items:center;gap:6px;cursor:pointer;font-weight:400;font-size:0.9rem;">
              <input type="radio" name="billing" id="billingYes" value="yes" checked onchange="toggleBillingAmount()"> Yes
            </label>
            <label style="display:flex;align-items:center;gap:6px;cursor:pointer;font-weight:400;font-size:0.9rem;">
              <input type="radio" name="billing" id="billingNo" value="no" onchange="toggleBillingAmount()"> No
            </label>
          </div>
        </div>
        <div class="field" id="billingAmountWrap">
          <label>Invoice Amount</label>
          <input type="text" id="billingAmount" value="$400.00" placeholder="$400.00">
        </div>
        <div class="field span-2" id="boardPackageWrap">
          <label style="display:flex;align-items:center;gap:8px;cursor:pointer;font-weight:400;">
            <input type="checkbox" id="boardPackage" onchange="toggleBoardPackageAmount()" style="width:16px;height:16px;accent-color:var(--gold);cursor:pointer;">
            <span>Also handling board package / screening process?</span>
          </label>
        </div>
        <div class="field" id="boardPackageAmountWrap" style="display:none;">
          <label>Board Package / Screening Fee</label>
          <input type="text" id="boardPackageAmount" value="$600.00" placeholder="$600.00">
        </div>
      </div>
    </div>

    <div class="btn-row">
      <button class="btn btn-ghost" onclick="goToStep(1)">‚Üê Back</button>
      <button class="btn btn-primary" onclick="goToStep(3)">Continue ‚Üí</button>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê STEP 3: CLAUSES ‚ïê‚ïê‚ïê -->
  <div class="screen" id="step3">
    <h1 class="screen-title">Terms & Clauses</h1>
    <p class="screen-sub">Include or strike specific lease provisions. Struck clauses will appear crossed out in the final document.</p>

    <div class="card">
      <div class="card-title">Standard Provisions</div>
      <div class="clause-list" id="clauseList"></div>
    </div>

    <div class="btn-row">
      <button class="btn btn-ghost" onclick="goToStep(2)">‚Üê Back</button>
      <button class="btn btn-primary" onclick="goToStep(4)">Continue ‚Üí</button>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê STEP 4: RIDERS ‚ïê‚ïê‚ïê -->
  <div class="screen" id="step4">
    <h1 class="screen-title">Riders</h1>
    <p class="screen-sub">Select which riders to include in the lease package. Highlighted riders are pre-selected based on the property type.</p>

    <div class="card">
      <div class="card-title">Available Riders</div>
      <div class="riders-grid" id="riderGrid"></div>
    </div>

    <div class="btn-row">
      <button class="btn btn-ghost" onclick="goToStep(3)">‚Üê Back</button>
      <button class="btn btn-gold" onclick="goToStep(5)">Generate Lease Package ‚Üí</button>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê STEP 5: PREVIEW ‚ïê‚ïê‚ïê -->
  <div class="screen" id="step5">
    <h1 class="screen-title">Lease Package Preview</h1>
    <p class="screen-sub">Review your lease package below. Use the sidebar to navigate between documents.</p>

    <div class="preview-meta" id="previewMeta"></div>

    <div class="preview-doc">
      <div class="doc-header">
        <div>
          <div class="doc-header-title" id="docTitle">RESIDENTIAL LEASE AGREEMENT</div>
          <div class="doc-header-sub" id="docSubtitle">Loading...</div>
        </div>
        <div style="color: rgba(255,255,255,0.4); font-size: 0.78rem;">DRAFT ‚Äî NOT EXECUTED</div>
      </div>
      <div class="doc-pages">
        <div class="doc-sidebar" id="docSidebar"></div>
        <div class="doc-content" id="docContent"></div>
      </div>
    </div>

    <div class="export-row">
      <button class="export-btn primary" onclick="exportPortfolio()">
        <span class="icon">üìé</span> Export Portfolio PDF
      </button>
      <button class="export-btn" onclick="exportConsolidated()">
        <span class="icon">üìÑ</span> Export Single PDF
      </button>
      <button class="export-btn" id="invoiceBtn" onclick="generateInvoice()" style="display:none;">
        <span class="icon">üßæ</span> Generate Invoice
      </button>
      <button class="export-btn" onclick="goToStep(1)">
        <span class="icon">‚Ü∫</span> Start New Lease
      </button>
    </div>
  </div>

</main>

<script>
// ‚ïê‚ïê‚ïê STATE ‚ïê‚ïê‚ïê
const state = {
  propertyType: null,
  leaseForm: 'rebny',
  data: {}
};

// ‚ïê‚ïê‚ïê CLAUSES DATA ‚ïê‚ïê‚ïê
const ALL_CLAUSES = [
  { id: 'pets', name: 'Pet Policy', preview: 'No pets permitted without prior written consent of Landlord. Any consent may be conditioned upon additional deposit.', defaultFor: ['condo','townhouse','rental'] },
  { id: 'sublet', name: 'Subletting', preview: 'Tenant shall not sublet the premises or any part thereof without prior written consent of Landlord.', defaultFor: ['condo','coop','townhouse','rental','stabilized'] },
  { id: 'alterations', name: 'Alterations & Improvements', preview: 'Tenant shall make no structural alterations or improvements to the premises without prior written consent.', defaultFor: ['condo','coop','townhouse','rental','stabilized'] },
  { id: 'guarantor', name: 'Guarantor Clause', preview: 'Payment and performance of all obligations shall be jointly guaranteed by a qualified guarantor.', defaultFor: [] },
  { id: 'noise', name: 'Noise & Nuisance', preview: 'Tenant shall not make or permit any disturbing noise in the building or interfere with occupants of other apartments.', defaultFor: ['condo','coop','rental','stabilized'] },
  { id: 'smoking', name: 'Smoking Prohibition', preview: 'Smoking of tobacco, cannabis, or any other substance is strictly prohibited within the premises and all common areas.', defaultFor: ['condo','coop','townhouse','rental','stabilized'] },
  { id: 'airbnb', name: 'Short-Term Rental Prohibition', preview: 'Tenant is prohibited from listing or offering the premises on any short-term rental platform (including but not limited to Airbnb, VRBO).', defaultFor: ['condo','coop','townhouse','rental','stabilized'] },
  { id: 'keycard', name: 'Key & Access Card Policy', preview: 'Tenant acknowledges receipt of [  ] keys and [  ] access cards. Replacement fees shall be borne by Tenant.', defaultFor: ['condo','coop','rental'] },
  { id: 'storage', name: 'Storage', preview: 'Use of any storage space is a license only and may be revoked by Landlord upon [30] days written notice.', defaultFor: [] },
  { id: 'renewal', name: 'Renewal Option', preview: 'Tenant shall have the option to renew this Lease per the terms specified in Step 2. Configure renewal details in the Renewal Option section above.', defaultFor: ['townhouse','rental'] },
  { id: 'earlyterm', name: 'Early Termination', preview: 'Tenant may terminate this Lease early upon [60] days written notice and payment of an early termination fee equal to [2] months rent.', defaultFor: [] },
  { id: 'concierge', name: 'Concierge / Doorman', preview: 'Tenant shall comply with all building concierge, package, and delivery protocols as established by building management.', defaultFor: ['condo','coop'] },
  { id: 'reno', name: 'Renovation / Construction', preview: 'Tenant acknowledges that renovation or construction may occur in adjacent units or common areas during the lease term.', defaultFor: [] },
  { id: 'hoarder', name: 'Excessive Personal Property', preview: 'Tenant shall not accumulate personal property in a manner that creates a health, safety, or fire hazard or impairs access to the premises.', defaultFor: ['rental','stabilized'] },
];

// ‚ïê‚ïê‚ïê RIDERS DATA ‚ïê‚ïê‚ïê
const ALL_RIDERS = [
  { id: 'xl_rider', name: 'XL Rider', desc: 'Standard company rider with additional terms and conditions. Included by default on all transactions.', required: false, law: false, company: true, defaultFor: ['condo','coop','townhouse','rental','stabilized'] },
  { id: 'leadpaint', name: 'Lead Paint Disclosure', desc: 'Federal disclosure for pre-1978 buildings. Includes EPA pamphlet acknowledgment.', required: true, law: true, defaultFor: ['condo','coop','townhouse','rental','stabilized'] },
  { id: 'bedbug', name: 'Bedbug Disclosure', desc: 'NYC Admin Code ¬ß27-2018.1 ‚Äî required disclosure of prior infestation history.', required: true, law: true, defaultFor: ['condo','coop','townhouse','rental','stabilized'] },
  { id: 'smoke', name: 'Smoke & Carbon Monoxide Detectors', desc: 'Acknowledges functioning detectors and tenant responsibilities under NYC law.', required: true, law: true, defaultFor: ['condo','coop','townhouse','rental','stabilized'] },
  { id: 'windowguard', name: 'Window Guard Notice', desc: 'Required notice for buildings with children under 10. Tenant elects installation preference.', required: false, law: true, defaultFor: ['rental','stabilized'] },
  { id: 'petadd', name: 'Pet Rider', desc: 'Additional terms governing pet ownership including deposit, weight limits, and cleanup obligations.', required: false, law: false, defaultFor: [] },
  { id: 'guarantor_rider', name: 'Guaranty of Lease', desc: 'Full personal guaranty executed by a creditworthy guarantor in favor of Landlord.', required: false, law: false, defaultFor: [] },
  { id: 'homeofc', name: 'Home Office Rider', desc: 'Permits limited professional use and clarifies permitted business activities within the premises.', required: false, law: false, defaultFor: [] },
  { id: 'coop_rules', name: 'House Rules Acknowledgment', desc: 'Tenant acknowledges receipt and agreement to comply with building/co-op house rules.', required: false, law: false, defaultFor: ['coop','condo'] },
  { id: 'moveinfee', name: 'Move-In / Move-Out Procedures', desc: 'Elevator scheduling, moving hours, and deposit requirements for building access during move.', required: false, law: false, defaultFor: ['condo','coop','rental'] },
  { id: 'renewal_rider', name: 'Renewal Lease Rider', desc: 'Rent Stabilization renewal terms including RGB increase percentages and tenant rights notice.', required: false, law: true, defaultFor: ['stabilized'] },
  { id: 'renewal_option_rider', name: 'Renewal Option Rider', desc: 'Tenant renewal option(s) with negotiated term, rent, and notice requirements. Auto-configured from Step 2.', required: false, law: false, defaultFor: [] },
  { id: 'rgtp', name: 'RGTP Notice', desc: 'Notice of Rent Guidelines Board Order applicable to this tenancy.', required: false, law: true, defaultFor: ['stabilized'] },
  { id: 'preferential', name: 'Preferential Rent Rider', desc: 'Discloses legal registered rent vs. preferential (below-market) rent being charged.', required: false, law: false, defaultFor: ['stabilized'] },
  { id: 'rvac', name: 'Right to Cure / RVAC', desc: 'Tenant rights disclosure and notice of cure obligations under NYC law.', required: false, law: false, defaultFor: ['stabilized','rental'] },
  { id: 'furnished',   name: 'Furnished Apartment Rider', desc: 'Itemized furniture inventory, as-is acceptance, Tenant liability for damage, and return condition obligations.', required: false, law: false, company: false, defaultFor: [] },
  { id: 'concessions', name: 'Concession Rider', desc: 'Documents free rent months, amortized rent reductions, or one-time credits. Includes clawback on early termination.', required: false, law: false, company: false, defaultFor: [] },
  { id: 'storage_rider', name: 'Storage License', desc: 'Separate license agreement for storage unit use, revocable by Landlord.', required: false, law: false, defaultFor: [] },
];

// ‚ïê‚ïê‚ïê NAVIGATION ‚ïê‚ïê‚ïê
function goToStep(n) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById('step' + n).classList.add('active');

  document.querySelectorAll('.step-dot').forEach(d => {
    const s = parseInt(d.dataset.step);
    d.classList.remove('active','done');
    if (s === n) d.classList.add('active');
    else if (s < n) d.classList.add('done');
  });

  if (n === 3) buildClauses();
  if (n === 4) buildRiders();
  if (n === 5) {
    buildPreview();
    // Show invoice button only if billing is on
    var d = collectData();
    var invoiceBtn = document.getElementById('invoiceBtn');
    if (invoiceBtn) invoiceBtn.style.display = d.billOwner ? 'inline-flex' : 'none';
  }
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

// ‚ïê‚ïê‚ïê STEP 1 ‚ïê‚ïê‚ïê
function selectType(card) {
  document.querySelectorAll('.type-card').forEach(c => c.classList.remove('selected'));
  card.classList.add('selected');
  state.propertyType = card.dataset.type;

  // Show/hide stabilized fields on step 2
  const isStab = state.propertyType === 'stabilized';
  const isCoop = state.propertyType === 'coop';
  document.getElementById('stabNotice').style.display = isStab ? 'flex' : 'none';
  document.getElementById('stabFields').style.display = isStab ? 'block' : 'none';
  var renewalCard = document.getElementById('renewalCard');
  if (renewalCard) renewalCard.style.display = isStab ? 'none' : 'block';
  document.getElementById('boardApprovalField').style.display = isCoop ? 'flex' : 'none';

  // Stabilized has only one form (RTP) ‚Äî hide REBNY/Blumberg toggle for types that don't use it
  const leaseFormCard = document.getElementById('leaseFormCard');
  const stabFormNotice = document.getElementById('stabFormNotice');
  var showToggle = ['rental', 'condo', 'coop'].indexOf(state.propertyType) !== -1;
  if (isStab) {
    leaseFormCard.style.display = 'none';
    stabFormNotice.style.display = 'block';
    state.leaseForm = 'stabilized';
  } else if (!showToggle) {
    // Townhouse, commercial, office ‚Äî no toggle needed, always REBNY or placeholder
    leaseFormCard.style.display = 'none';
    stabFormNotice.style.display = 'none';
    state.leaseForm = 'rebny';
  } else {
    leaseFormCard.style.display = 'block';
    stabFormNotice.style.display = 'none';
    // Update toggle labels
    var rebnyLbl = document.getElementById('rebnyToggleLabel');
    var blumLbl  = document.getElementById('blumbergToggleLabel');
    if (rebnyLbl && blumLbl) {
      var labelMap = { rental: ['REBNY Apartment', 'Blumberg A-55'], condo: ['REBNY Condo', 'Blumberg 101'], coop: ['REBNY Co-op Sublease', 'Blumberg A-55'] };
      var lbls = labelMap[state.propertyType] || ['REBNY', 'Blumberg'];
      rebnyLbl.textContent = lbls[0];
      blumLbl.textContent  = lbls[1];
    }
    state.leaseForm = 'rebny'; // reset to default
    selectForm('rebny');
  }

  // Show attorney section for REBNY-applicable types
  var rebnyTypes = ['townhouse', 'stabilized', 'rental', 'condo', 'coop'];
  var attyCard = document.getElementById('attorneyCard');
  if (attyCard) attyCard.style.display = rebnyTypes.includes(state.propertyType) ? 'block' : 'none';

  // Building name only for condo
  var bldgField = document.getElementById('buildingNameField');
  if (bldgField) bldgField.style.display = (state.propertyType === 'condo') ? 'flex' : 'none';

  // Apartment Corporation name only for co-op
  var apCorpField = document.getElementById('apartmentCorpField');
  if (apCorpField) apCorpField.style.display = (state.propertyType === 'coop') ? 'flex' : 'none';

  // Board approval only for co-op
  var boardField = document.getElementById('boardApprovalField');
  if (boardField) boardField.style.display = (state.propertyType === 'coop') ? 'flex' : 'none';

  // Condo/Co-op extras card
  var condoCard = document.getElementById('condoCoopFields');
  if (condoCard) condoCard.style.display = (state.propertyType === 'condo' || state.propertyType === 'coop') ? 'block' : 'none';
}

// ‚ïê‚ïê‚ïê STEP 2 ‚Äî Lease Form ‚ïê‚ïê‚ïê
function selectForm(f) {
  state.leaseForm = f;
  document.getElementById('opt-rebny').classList.toggle('selected', f === 'rebny');
  document.getElementById('opt-blumberg').classList.toggle('selected', f === 'blumberg');
}

// ‚ïê‚ïê‚ïê STEP 3 ‚Äî CLAUSES ‚ïê‚ïê‚ïê
function buildClauses() {
  const list = document.getElementById('clauseList');
  list.innerHTML = '';
  ALL_CLAUSES.forEach(c => {
    const defaultIncluded = c.defaultFor.includes(state.propertyType);
    const div = document.createElement('div');
    div.className = 'clause-item ' + (defaultIncluded ? 'included' : '');
    div.id = 'clause-' + c.id;
    div.innerHTML = `
      <div class="clause-check">${defaultIncluded ? '‚úì' : ''}</div>
      <div class="clause-body">
        <div class="clause-name">${c.name}</div>
        <div class="clause-preview">${c.preview}</div>
      </div>
      <div class="clause-controls">
        <button class="ctrl-btn ${defaultIncluded ? 'active-include' : ''}" onclick="clauseAction('${c.id}','include',event)">Include</button>
        <button class="ctrl-btn" onclick="clauseAction('${c.id}','strike',event)">Strike</button>
        <button class="ctrl-btn" onclick="clauseAction('${c.id}','exclude',event)">Exclude</button>
      </div>
    `;
    list.appendChild(div);
  });
}

function clauseAction(id, action, evt) {
  evt.stopPropagation();
  const item = document.getElementById('clause-' + id);
  const check = item.querySelector('.clause-check');
  const btns = item.querySelectorAll('.ctrl-btn');
  btns.forEach(b => b.classList.remove('active-include','active-strike'));

  item.classList.remove('included','struck');
  item.dataset.action = action;

  if (action === 'include') {
    item.classList.add('included');
    check.textContent = '‚úì';
    btns[0].classList.add('active-include');
  } else if (action === 'strike') {
    item.classList.add('struck');
    check.textContent = '‚úï';
    btns[1].classList.add('active-strike');
  } else {
    check.textContent = '';
  }
}

// ‚ïê‚ïê‚ïê STEP 4 ‚Äî RIDERS ‚ïê‚ïê‚ïê
const STABILIZED_ONLY_RIDERS = ['renewal_rider', 'rgtp', 'preferential', 'rvac'];

function buildRiders() {
  // Sync furnished state from form
  var furnInput = document.querySelector('input[name="furnished"]:checked');
  state.furnished = furnInput ? furnInput.value === 'yes' : false;
  const grid = document.getElementById('riderGrid');
  grid.innerHTML = '';
  const isStab = state.propertyType === 'stabilized';

  ALL_RIDERS.forEach(r => {
    // Hide stabilized-only riders in non-stabilized flows
    if (!isStab && STABILIZED_ONLY_RIDERS.includes(r.id)) return;

    const isFurnishedRider = r.id === 'furnished' && state.furnished;

    // Renewal option rider: needed when count > 1 (any REBNY form),
    // OR count >= 1 AND form is Blumberg (no inline article)
    const renewalCount = parseInt((document.getElementById('renewalCount') || {}).value || '0');
    const isBlumberg   = state.leaseForm === 'blumberg';
    const isRenewalRider = r.id === 'renewal_option_rider' &&
      renewalCount > 0 && (renewalCount > 1 || isBlumberg);

    const isDefault = r.defaultFor.includes(state.propertyType) || isFurnishedRider || isRenewalRider;
    const div = document.createElement('div');
    div.className = 'rider-card ' + (r.required ? 'required' : isDefault ? 'checked' : '');
    div.id = 'rider-' + r.id;
    div.onclick = () => toggleRider(div, r.required);
    // Dynamic name for XL rider
    const displayName = r.id === 'xl_rider'
      ? `XL Rider - ${PROPERTY_LABELS[state.propertyType] || 'Residential'}`
      : r.name;

    div.innerHTML = `
      <div class="rider-check">${(r.required || isDefault) ? '‚úì' : ''}</div>
      <div class="rider-info">
        <div class="rider-name">${displayName}</div>
        <div class="rider-desc">${r.desc}</div>
        ${r.company ? '<div class="rider-badge" style="background:#1a2f45;color:#c9a84c;border-color:#c9a84c;">‚òÖ Company</div>' : ''}
        ${r.required ? '<div class="rider-badge req">‚ö† Required</div>' : ''}
        ${r.law ? '<div class="rider-badge law">¬ß NYC Law</div>' : ''}
      </div>
    `;
    grid.appendChild(div);
  });
}

function toggleRider(card, required) {
  if (required) return;
  const isChecked = card.classList.contains('checked');
  const check = card.querySelector('.rider-check');
  card.classList.toggle('checked', !isChecked);
  check.textContent = isChecked ? '' : '‚úì';
}

// ‚ïê‚ïê‚ïê STEP 5 ‚Äî PREVIEW ‚ïê‚ïê‚ïê
function onFurnishedChange() {
  var furnished = document.querySelector('input[name="furnished"]:checked');
  state.furnished = furnished ? furnished.value === 'yes' : false;
  // Pre-check furnished rider in step 4 if it exists
  var card = document.getElementById('rider-furnished');
  if (card) {
    if (state.furnished) {
      card.classList.add('checked');
      card.querySelector('.rider-check').textContent = '‚úì';
    } else {
      card.classList.remove('checked');
      card.querySelector('.rider-check').textContent = '';
    }
  }
}

function collectData() {
  return {
    address: document.getElementById('address').value || '[PROPERTY ADDRESS]',
    unit: document.getElementById('unit').value || '[UNIT]',
    landlord: document.getElementById('landlord').value || '[LANDLORD NAME]',
    landlordAddr: document.getElementById('landlordAddr') ? document.getElementById('landlordAddr').value : 'c/o XL Real Property Management, 80 Fifth Avenue, Suite 1501, New York, NY 10011',
    landlordEmail: document.getElementById('landlordEmail') ? document.getElementById('landlordEmail').value : 'josh@xl-rpm.com',
    landlordType: document.getElementById('landlordType') ? document.getElementById('landlordType').value : '',
    tenant: document.getElementById('tenant').value || '[TENANT NAME]',
    rent: document.getElementById('rent').value || '[MONTHLY RENT]',
    deposit: document.getElementById('deposit').value || '[SECURITY DEPOSIT]',
    startDate: document.getElementById('startDate').value || '[START DATE]',
    endDate: document.getElementById('endDate').value || '[END DATE]',
    broker: document.getElementById('broker').value || 'N/A',
    permittedOccupants: document.getElementById('permittedOccupants') ? document.getElementById('permittedOccupants').value : '',
    borough: document.getElementById('borough') ? document.getElementById('borough').value : 'Manhattan',
    apartmentCorp: document.getElementById('apartmentCorp') ? document.getElementById('apartmentCorp').value : '',
    securityBank: document.getElementById('securityBank') ? document.getElementById('securityBank').value : '',
    securityBankAddr: document.getElementById('securityBankAddr') ? document.getElementById('securityBankAddr').value : '',
    paymentMethod: document.getElementById('paymentMethod') ? document.getElementById('paymentMethod').value : 'Check',
    garageSpace: document.getElementById('garageSpace') ? document.getElementById('garageSpace').value : '',
    garageFee: document.getElementById('garageFee') ? document.getElementById('garageFee').value : '',
    leasePackageDue: document.getElementById('leasePackageDue') ? document.getElementById('leasePackageDue').value : '',
    tenantInsurance: document.getElementById('tenantInsurance') ? document.getElementById('tenantInsurance').value : '',
    tenantCurrentAddr: document.getElementById('tenantCurrentAddr') ? document.getElementById('tenantCurrentAddr').value : '',
    tenantEmail: document.getElementById('tenantEmail') ? document.getElementById('tenantEmail').value : '',
    floor: document.getElementById('floor') ? document.getElementById('floor').value : '',
    buildingName: document.getElementById('buildingName') ? document.getElementById('buildingName').value : '',
    landlordAtty: document.getElementById('landlordAtty') ? document.getElementById('landlordAtty').value : '',
    landlordAttyAddr: document.getElementById('landlordAttyAddr') ? document.getElementById('landlordAttyAddr').value : '',
    tenantAtty: document.getElementById('tenantAtty') ? document.getElementById('tenantAtty').value : '',
    tenantAttyAddr: document.getElementById('tenantAttyAddr') ? document.getElementById('tenantAttyAddr').value : '',
    furnished: document.querySelector('input[name="furnished"]:checked') ? document.querySelector('input[name="furnished"]:checked').value === 'yes' : false,
    legalRent: document.getElementById('legalRent') ? document.getElementById('legalRent').value : '',
    prefRent: document.getElementById('prefRent')?.value || '',
    dhcrNo: document.getElementById('dhcrNo')?.value || '',
    renewalCount:    document.getElementById('renewalCount')    ? parseInt(document.getElementById('renewalCount').value)    : 0,
    renewalTerm:     document.getElementById('renewalTerm')     ? document.getElementById('renewalTerm').value     : '1 year',
    renewalNotice:   document.getElementById('renewalNotice')   ? document.getElementById('renewalNotice').value   : '60',
    renewalRentType: document.getElementById('renewalRentType') ? document.getElementById('renewalRentType').value : 'tbd',
    renewalRentVal:  document.getElementById('renewalRentVal')  ? document.getElementById('renewalRentVal').value  : '',
    billOwner: document.querySelector('input[name="billing"]:checked') ? document.querySelector('input[name="billing"]:checked').value === 'yes' : true,
    billingAmount: document.getElementById('billingAmount') ? document.getElementById('billingAmount').value : '$400.00',
    boardPackage: document.getElementById('boardPackage') ? document.getElementById('boardPackage').checked : false,
    boardPackageAmount: document.getElementById('boardPackageAmount') ? document.getElementById('boardPackageAmount').value : '$600.00',
  };
}

const PROPERTY_LABELS = { condo:'Condominium', coop:'Co-op', townhouse:'Townhouse', rental:'Rental', stabilized:'Rent Stabilized', commercial:'Commercial', office:'Office' };

// ‚îÄ‚îÄ Billing toggle ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleBillingAmount() {
  var yes = document.getElementById('billingYes').checked;
  var amtWrap = document.getElementById('billingAmountWrap');
  var boardWrap = document.getElementById('boardPackageWrap');
  var boardAmtWrap = document.getElementById('boardPackageAmountWrap');
  if (amtWrap) amtWrap.style.display = yes ? 'flex' : 'none';
  if (boardWrap) boardWrap.style.display = yes ? 'flex' : 'none';
  // If billing turned off, also uncheck and hide board package amount
  if (!yes && boardAmtWrap) {
    boardAmtWrap.style.display = 'none';
    var cb = document.getElementById('boardPackage');
    if (cb) cb.checked = false;
  }
}

function toggleBoardPackageAmount() {
  var checked = document.getElementById('boardPackage').checked;
  var wrap = document.getElementById('boardPackageAmountWrap');
  if (wrap) wrap.style.display = checked ? 'flex' : 'none';
}

function toggleRenewalFields() {
  var count = parseInt(document.getElementById('renewalCount').value || '0');
  var show = count > 0;
  ['renewalTermWrap','renewalNoticeWrap','renewalRentTypeWrap','renewalRentValWrap'].forEach(function(id) {
    var el = document.getElementById(id);
    if (el) el.style.display = show ? 'flex' : 'none';
  });
  if (show) toggleRenewalRentField();
}

function toggleRenewalRentField() {
  var type = document.getElementById('renewalRentType') ? document.getElementById('renewalRentType').value : 'tbd';
  var wrap = document.getElementById('renewalRentValWrap');
  var lbl  = document.getElementById('renewalRentValLabel');
  var inp  = document.getElementById('renewalRentVal');
  if (!wrap) return;
  if (type === 'tbd') {
    wrap.style.display = 'none';
  } else {
    wrap.style.display = 'flex';
    if (lbl) lbl.textContent = type === 'pct' ? 'Percentage Increase (e.g. 3%)' : 'Fixed Increase Amount';
    if (inp) inp.placeholder = type === 'pct' ? 'e.g. 3%' : 'e.g. $200.00 / month';
  }
}

// ‚îÄ‚îÄ Shared renewal data helper ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function addYearsToDate(dateStr, years) {
  // dateStr: YYYY-MM-DD or formatted ‚Äî try to parse
  if (!dateStr) return null;
  var d = new Date(dateStr);
  if (isNaN(d.getTime())) return null;
  d.setFullYear(d.getFullYear() + years);
  return d;
}

function formatDate(d) {
  if (!d || isNaN(d.getTime())) return null;
  var m = d.getMonth() + 1, day = d.getDate(), y = d.getFullYear();
  return (m < 10 ? '0' + m : m) + '/' + (day < 10 ? '0' + day : day) + '/' + y;
}

function renewalData(d) {
  var count     = d.renewalCount  || 0;
  var term      = d.renewalTerm   || '1 year';
  var notice    = d.renewalNotice || '90';
  var rentType  = d.renewalRentType || 'tbd';
  var rentVal   = d.renewalRentVal  || '';

  // Parse term length in years (handles "1 year", "2 years", "month-to-month", "same term")
  var termYears = 0;
  var termLabel = term;
  var mtm = term === 'month-to-month';
  var same = term.indexOf('same') !== -1;
  if (!mtm && !same) {
    var m = term.match(/^(\d+)/);
    termYears = m ? parseInt(m[1]) : 1;
  }

  // Compute dates from lease end date
  var leaseEnd = d.endDate ? new Date(d.endDate) : null;
  var rStartDate = null, rEndDate = null;

  if (leaseEnd && !isNaN(leaseEnd.getTime())) {
    // Start = day after lease end
    rStartDate = new Date(leaseEnd.getTime() + 86400000);
    // End = start + term
    if (termYears > 0) {
      rEndDate = new Date(rStartDate);
      rEndDate.setFullYear(rEndDate.getFullYear() + termYears);
      rEndDate.setDate(rEndDate.getDate() - 1); // end on last day of final month
    } else if (mtm) {
      rEndDate = null; // month-to-month has no fixed end
    } else if (same && d.startDate && d.endDate) {
      // same term: compute original term length in ms
      var origStart = new Date(d.startDate);
      var origEnd   = new Date(d.endDate);
      if (!isNaN(origStart.getTime()) && !isNaN(origEnd.getTime())) {
        var diff = origEnd.getTime() - origStart.getTime();
        rEndDate = new Date(rStartDate.getTime() + diff);
      }
    }
  }

  var rStart = rStartDate ? formatDate(rStartDate) : '________________________________';
  var rEnd   = (rEndDate   ? formatDate(rEndDate)   : (mtm ? 'month-to-month' : '________________________________'));

  // Rent display
  var rentDisplay;
  if (rentType === 'pct' && rentVal) {
    rentDisplay = { dollar: '________________________________', sentence: 'an amount equal to ' + rentVal + ' above the Rent in effect at the expiration of the then-current term' };
  } else if (rentType === 'fixed' && rentVal) {
    rentDisplay = { dollar: rentVal, sentence: rentVal + ' per month' };
  } else {
    rentDisplay = { dollar: '________________________________', sentence: 'an amount to be mutually agreed upon in writing by Owner and Tenant prior to commencement of the Extension Term' };
  }

  return { count: count, term: term, termYears: termYears, termLabel: termLabel, mtm: mtm, notice: notice, rentType: rentType, rentVal: rentVal, rStart: rStart, rEnd: rEnd, rentDisplay: rentDisplay };
}

// ‚îÄ‚îÄ Inline article for REBNY forms ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Single option: populate full article inline
// Multiple options: stub article pointing to rider
function buildRenewalArticle(d, articleNum, tenantLabel) {
  tenantLabel = tenantLabel || 'Tenant';
  var T = tenantLabel;
  var rd = renewalData(d);
  if (rd.count === 0) return '';

  var rows = [];

  if (rd.count === 1) {
    // Full inline article
    var termStr = rd.termYears > 0 ? String(rd.termYears) : (rd.mtm ? 'month-to-month' : '____');
    rows.push(p('<strong>' + articleNum + '. ' + T.toUpperCase() + '&rsquo;S OPTION TO RENEW</strong>'));
    rows.push(p('A. ' + T + ' shall have the right to extend the term of this Lease for ' + blank(termStr) + ' year(s) commencing ' + blank(rd.rStart) + ' and ending on ' + blank(rd.rEnd) + ' (the &ldquo;Extension Term&rdquo;) provided: (i) ' + T + ' gives Owner notice (the &ldquo;Extension Notice&rdquo;) of ' + T + '&rsquo;s election to extend the term; (ii) the Extension Notice must be given to Owner at least ' + rd.notice + ' days prior to the ending date of this Lease, <strong>TIME BEING OF THE ESSENCE</strong>; (iii) ' + T + ' has been timely in payment of Rent and Additional Rent and is not in default of any provision of this Lease when the Extension Notice is given or on the commencement date of the Extension Term; and (iv) ' + T + ' is occupying the Apartment and has not assigned this Lease nor sublet the Apartment. If Owner fails to receive the Extension Notice by the date required, <strong>TIME BEING OF THE ESSENCE</strong>, this Article ' + articleNum + ' shall be of no further force and effect.'));
    rows.push(p('B. The monthly Rent during the Extension Term shall be ' + blank(rd.rentDisplay.dollar) + (rd.rentType !== 'fixed' ? ' <span style="font-size:0.82rem;color:var(--text-muted);">[' + rd.rentDisplay.sentence + ']</span>' : '') + '.'));
    rows.push(p('C. All provisions of this Lease, except as modified by this Article ' + articleNum + ', shall remain in full force and effect during the Extension Term.'));
  } else {
    // Multiple options ‚Äî stub pointing to rider
    rows.push(p('<strong>' + articleNum + '. ' + T.toUpperCase() + '&rsquo;S OPTION TO RENEW</strong>'));
    rows.push(p('<em>See Renewal Option Rider attached hereto and made a part of this Lease. ' + T + ' has ' + rd.count + ' renewal options as more fully described therein.</em>'));
  }

  return rows.join('\n');
}

// ‚îÄ‚îÄ Clause text for Blumberg forms / generic inline clause ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function buildRenewalClause(d) {
  var rd = renewalData(d);
  if (rd.count === 0) return null;
  var optWord   = rd.count === 1 ? 'one (1) option' : rd.count + ' consecutive options';
  var optClause = rd.count > 1 ? ', each for a period of ' + rd.term + ',' : ' for a period of ' + rd.term;
  return 'Provided Tenant is not in default under any term of this Lease, Tenant shall have ' + optWord + optClause + ' to renew this Lease upon the same terms and conditions as the then-current term, except that the monthly rent shall be ' + rd.rentDisplay.sentence + '. To exercise, Tenant must deliver written notice to Owner not less than ' + rd.notice + ' days prior to the expiration of the then-current term, <strong>TIME BEING OF THE ESSENCE</strong>. Each renewal option is personal to Tenant and may not be exercised by or assigned to any subtenant or assignee.';
}

function buildPreview() {
  const d = collectData();
  state.data = d;
  const pt = PROPERTY_LABELS[state.propertyType] || '';
  const lf = state.leaseForm === 'stabilized' ? 'DHCR Stabilized Form (RTP-8)' :
             state.leaseForm === 'rebny' ? 'REBNY Form' : 'Blumberg Form';

  // Meta chips
  document.getElementById('previewMeta').innerHTML = `
    <div class="meta-chip"><div class="m-label">Property Type</div><div class="m-val">${pt}</div></div>
    <div class="meta-chip"><div class="m-label">Lease Form</div><div class="m-val">${lf}</div></div>
    <div class="meta-chip"><div class="m-label">Monthly Rent</div><div class="m-val">${d.rent}</div></div>
  `;

  document.getElementById('docSubtitle').textContent = `${d.address}, ${d.unit} ¬∑ ${pt} ¬∑ ${lf}`;

  // Build sidebar
  const sidebar = document.getElementById('docSidebar');
  const activeRiders = getActiveRiders();
  let sideHTML = `
    <div class="sidebar-section">
      <div class="sidebar-section-title">Main Lease</div>
      <div class="sidebar-item active" onclick="showDoc('main',this)"><span class="item-icon">üìã</span> Lease Agreement</div>
    </div>
    <div class="sidebar-divider"></div>
    <div class="sidebar-section">
      <div class="sidebar-section-title">Riders (${activeRiders.length})</div>
  `;
  activeRiders.forEach(r => {
    sideHTML += `<div class="sidebar-item" onclick="showDoc('${r.id}',this)"><span class="item-icon">üìÑ</span> ${r.name}</div>`;
  });
  sideHTML += `</div>`;
  sidebar.innerHTML = sideHTML;

  showDoc('main', sidebar.querySelector('.sidebar-item'));
}

function getActiveRiders() {
  return ALL_RIDERS.filter(r => {
    const card = document.getElementById('rider-' + r.id);
    return card && (card.classList.contains('checked') || card.classList.contains('required'));
  });
}

function showDoc(docId, clickedEl) {
  document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active'));
  if (clickedEl) clickedEl.classList.add('active');

  const d = state.data;
  const content = document.getElementById('docContent');
  const title = document.getElementById('docTitle');

  if (docId === 'main') {
    const formLabel = state.leaseForm === 'stabilized' ? 'DHCR RTP-8' : state.leaseForm.toUpperCase();
    title.textContent = `${formLabel} RESIDENTIAL LEASE AGREEMENT`;
    content.innerHTML = buildMainLease(d);
  } else {
    const rider = ALL_RIDERS.find(r => r.id === docId);
    title.textContent = (rider?.name || 'Rider').toUpperCase() + ' ‚Äî RIDER';
    content.innerHTML = buildRiderContent(docId, d);
  }
}

function blank(val, fallback) {
  const v = val && val !== '[PROPERTY ADDRESS]' && val !== '[UNIT]' && val !== '[LANDLORD NAME]' && val !== '[TENANT NAME]' && val !== '[MONTHLY RENT]' && val !== '[SECURITY DEPOSIT]' && val !== '[START DATE]' && val !== '[END DATE]' ? val : null;
  return `<span class="blank">${v || fallback || '________________'}</span>`;
}

function clauseHTML(id, text) {
  const el = document.getElementById('clause-' + id);
  const action = el ? el.dataset.action : (el?.classList.contains('included') ? 'include' : 'include');
  const isStruck = el?.classList.contains('struck');
  const isExcluded = el?.dataset.action === 'exclude';
  if (isExcluded) return '';
  if (isStruck) return `<p class="struck-text">${text}</p>`;
  return `<p>${text}</p>`;
}

function p(text) { return '<p>' + text + '</p>'; }
function ph(text) { return '<div class="doc-section-heading">' + text + '</div>'; }
function ps(text) { return '<p class="struck-text">' + text + '</p>'; }

function clauseBlock(id, label, text) {
  var el = document.getElementById('clause-' + id);
  if (!el) return p('<strong>' + label + '</strong> ' + text);
  if (el.dataset.action === 'exclude') return '';
  if (el.classList.contains('struck')) return ps('<strong>' + label + '</strong> ' + text);
  return p('<strong>' + label + '</strong> ' + text);
}



// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SHARED REBNY HEADER TABLE ‚Äî used by all three REBNY non-stab forms
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function rebnyHeaderTable(d, formTitle, formVersion, extraLeftRows, extraRightRows) {
  var rows = [];
  rows.push('<div style="text-align:center;margin-bottom:12px;">');
  rows.push('<div style="font-size:0.75rem;color:#888;">' + formVersion + '</div>');
  rows.push('<div style="font-size:0.7rem;color:#aaa;">&copy; Copyright 2019 The Real Estate Board of New York, Inc. All Rights Reserved.</div>');
  rows.push('</div>');
  rows.push(ph(formTitle));
  rows.push('<p style="text-align:center;font-style:italic;">THE REAL ESTATE BOARD OF NEW YORK, INC.</p>');
  rows.push('<p><strong>PREAMBLE:</strong> This Lease contains the agreements between Tenant and Owner concerning the rights and obligations of each party. Tenant and Owner have other rights and obligations which are set forth in government laws and regulations. Tenant should read this Lease carefully and obtain clarification from an attorney on any questions.</p>');
  return rows.join('\n');
}

function rebnyPartyBlock(d, tenantLabel, ownerLabel) {
  tenantLabel = tenantLabel || 'Tenant';
  ownerLabel  = ownerLabel  || 'Owner';
  var rows = [];
  rows.push('<p>THIS LEASE is made as of ' + blank(d.startDate) + ' between ' + ownerLabel + ' <strong>' + blank(d.landlord) + '</strong>, whose address is c/o XL Real Property Management, 80 Fifth Avenue, Suite 1501, New York, NY 10011' + (d.landlordEmail ? '; Email: ' + blank(d.landlordEmail) : '') + ' and ' + tenantLabel + ' <strong>' + blank(d.tenant) + '</strong>, whose address is ' + blank(d.tenantCurrentAddr, '________________________________') + (d.tenantEmail ? '; Email: ' + blank(d.tenantEmail) : '') + '.</p>');
  if (d.landlordAtty || d.tenantAtty) {
    rows.push('<p><strong>' + ownerLabel + '&rsquo;s Attorney:</strong> ' + blank(d.landlordAtty, '________________________________') + (d.landlordAttyAddr ? ', ' + blank(d.landlordAttyAddr) : '') + '<br>');
    rows.push('<strong>' + tenantLabel + '&rsquo;s Attorney:</strong> ' + blank(d.tenantAtty, '________________________________') + (d.tenantAttyAddr ? ', ' + blank(d.tenantAttyAddr) : '') + '</p>');
  }
  return rows.join('\n');
}

function rebnySignatureBlock(d, tenantLabel, ownerLabel) {
  tenantLabel = tenantLabel || 'Tenant';
  ownerLabel  = ownerLabel  || 'Owner';
  var rows = [];
  rows.push(ph('Signatures'));
  rows.push('<p>' + ownerLabel + ' and ' + tenantLabel + ' have signed this Lease as of the date written above. This Lease is effective when ' + ownerLabel + ' delivers to ' + tenantLabel + ' a copy signed by all parties.</p>');
  rows.push('<table style="width:100%;border-collapse:collapse;margin-top:16px;">');
  rows.push('<tr>');
  rows.push('<td style="width:50%;padding-right:20px;vertical-align:top;">');
  rows.push('<p><strong>' + ownerLabel.toUpperCase() + ':</strong></p>');
  rows.push('<p style="border-bottom:1px solid #333;margin-top:24px;padding-bottom:2px;">' + blank(d.landlord) + '</p>');
  rows.push('<p style="margin-top:4px;font-size:0.8rem;">Address: c/o XL Real Property Management, 80 Fifth Avenue, Suite 1501, New York, NY 10011' + (d.landlordEmail ? '<br>Email: ' + blank(d.landlordEmail) : '') + '</p>');
  if (d.landlordAtty) rows.push('<p style="font-size:0.8rem;margin-top:8px;">Attorney: ' + blank(d.landlordAtty) + '</p>');
  rows.push('</td>');
  rows.push('<td style="width:50%;padding-left:20px;vertical-align:top;">');
  rows.push('<p><strong>' + tenantLabel.toUpperCase() + ':</strong></p>');
  rows.push('<p style="border-bottom:1px solid #333;margin-top:24px;padding-bottom:2px;">' + blank(d.tenant) + '</p>');
  rows.push('<p style="margin-top:4px;font-size:0.8rem;">Address: ' + blank(d.address) + (d.unit ? ', ' + blank(d.unit) : '') + '</p>');
  if (d.tenantAtty) rows.push('<p style="font-size:0.8rem;margin-top:8px;">Attorney: ' + blank(d.tenantAtty) + '</p>');
  rows.push('</td>');
  rows.push('</tr>');
  rows.push('</table>');
  rows.push(ph('GUARANTY OF PAYMENT'));
  rows.push('<p style="font-size:0.85rem;">I know that ' + ownerLabel + ' would not rent the Apartment to ' + tenantLabel + ' unless I guarantee ' + tenantLabel + '&rsquo;s performance. I guaranty the full performance of the Lease. This Guaranty is absolute and without any condition, including the payment of rent and all other money charges.</p>');
  rows.push('<table style="width:100%;border-collapse:collapse;margin-top:12px;font-size:0.85rem;">');
  rows.push('<tr>');
  rows.push('<td style="width:50%;padding-right:20px;vertical-align:top;"><p><strong>GUARANTOR:</strong> ________________________________</p><p>Address: ________________________________</p></td>');
  rows.push('<td style="width:50%;padding-left:20px;vertical-align:top;"><p><strong>Date of Guaranty:</strong> ________________________________</p><p><strong>WITNESS:</strong> ________________________________</p></td>');
  rows.push('</tr>');
  rows.push('</table>');
  return rows.join('\n');
}

function rebnyCommonArticles(d, unitLabel, tenantLabel, ownerLabel) {
  unitLabel   = unitLabel   || 'Apartment';
  tenantLabel = tenantLabel || 'Tenant';
  ownerLabel  = ownerLabel  || 'Owner';
  var T = tenantLabel; var O = ownerLabel; var U = unitLabel;
  var payMethod = d.paymentMethod || 'check';
  var bankLine  = (d.securityBank ? blank(d.securityBank) : '________________________________') + ' bank at ' + (d.securityBankAddr ? blank(d.securityBankAddr) : '________________________________');
  var permOcc   = d.permittedOccupants || '';
  var rows = [];

  rows.push(p('<strong>1. ' + U + ' and Use</strong> &nbsp; ' + O + ' agrees to lease to ' + T + ' the ' + U + ' ' + blank(d.unit) + ' on the ' + blank(d.floor, '____') + ' floor in the building at ' + blank(d.address) + ' (the &ldquo;Building&rdquo;), Borough of ' + blank(d.borough || 'Manhattan') + ', City and State of New York. ' + T + ' shall use the ' + U + ' for living purposes only. The ' + U + ' may only be occupied by ' + T + ' and the following Permitted Occupants: ' + blank(permOcc || 'None beyond named Tenant(s)') + '. ' + T + ' acknowledges that no other person may reside in the ' + U + ' without the prior written consent of ' + O + '.'));

  rows.push(p('<strong>2. Lease Commencement Date; Length of Lease</strong> &nbsp; The &ldquo;Lease Commencement Date&rdquo; is ' + blank(d.startDate) + '. The term of this Lease will begin on the Lease Commencement Date and will end on ' + blank(d.endDate) + ' (the &ldquo;Term&rdquo;). The Term shall consist of the period beginning with the Lease Commencement Date through and including the last day of the month in which the applicable anniversary of the Lease Commencement Date occurs.'));

  rows.push(p('<strong>3. Rent</strong> &nbsp; ' + T + '&rsquo;s monthly Rent for the ' + U + ' is ' + blank(d.rent) + ' per month. ' + T + ' must pay ' + O + ' the Rent, in equal monthly installments, on the first day of each month. When ' + T + ' signs this Lease, ' + T + ' must pay by bank or cashier&rsquo;s check (or by electronic fund transfer if instructed) (i) one (1) month&rsquo;s Rent (' + blank(d.rent) + '); (ii) the Security Deposit; and (iii) any broker commission. ' + T + ' shall be entitled to a five (5) day grace period for the payment of Rent. Any sum not paid within five (5) days shall be subject to a late fee of the lesser of $50.00 or five percent (5%) of the unpaid amount. All Rent and Additional Rent shall be payable by ' + blank(payMethod) + ' only.'));

  rows.push(p('<strong>4. Memorandum Confirming Term</strong> &nbsp; Within five (5) business days after the request of ' + O + ', ' + T + ' shall return the Memorandum Confirming Term (Exhibit A) confirming the Lease Commencement Date, the Rent Commencement Date (if different), the Lease expiration date, and certifying that ' + T + ' has accepted delivery of the ' + U + '.'));

  return rows.join('\n');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// REBNY APARTMENT ‚Äî NON-STABILIZED (REBNY Apt non-stab 2019 Rev 7.19)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildREBNYApt(d) {
  var bankLine = (d.securityBank ? blank(d.securityBank) : '________________________________') + ' bank at ' + (d.securityBankAddr ? blank(d.securityBankAddr) : '________________________________');
  var rows = [];

  rows.push(rebnyHeaderTable(d, 'STANDARD FORM OF APARTMENT LEASE', 'REBNY Apt non-stab 2019 Rev 7.19 &mdash; For Apartments Not Subject to the Rent Stabilization Law'));
  rows.push(rebnyPartyBlock(d));
  rows.push('<p><em>Please note the following paragraphs that require a selection among alternative wording: 2, 3E, 34. Please note the following paragraphs that require the insertion of terms (and/or delete if inapplicable): 1, 2, 3A, 3B, 4, 9D, 12B, 12C, 25, 32C, 34A, 35, 38B, Exhibit A, Exhibit C, Exhibit D.</em></p>');

  rows.push(rebnyCommonArticles(d));

  rows.push(p('<strong>5. Security Deposit</strong> &nbsp; Tenant is required to give Owner the sum of ' + blank(d.deposit) + ' (not to exceed one (1) month&rsquo;s Rent pursuant to The Housing Stability and Tenant Protection Act of 2019) when Tenant signs this Lease as a security deposit. Owner will deposit the Security Deposit in ' + bankLine + '. This Security Deposit shall not bear interest unless required by applicable law. Owner will return the full Security Deposit within fourteen (14) days after the later of (i) the date this Lease ends, or (ii) the date Tenant vacates the Apartment, provided Tenant has carried out all agreements in this Lease and returned the Apartment in the same condition, except for ordinary wear and tear. TENANT ACKNOWLEDGES AND AGREES THAT THE SECURITY DEPOSIT CANNOT BE USED TOWARDS RENT OR ADDITIONAL RENT BY TENANT.'));

  rows.push(p('<strong>6. If Tenant Is Unable to Move In</strong> &nbsp; Except as otherwise provided herein, Owner shall not be liable for failure to give Tenant possession of the Apartment on the Lease Commencement Date. If this happens for reasons beyond Owner&rsquo;s reasonable control, Owner will not be responsible for Tenant&rsquo;s damages or expenses and this Lease will remain in effect. If Owner does not give Tenant notice that possession is available within thirty (30) days after the Lease Commencement Date, Tenant may send a fifteen (15) day written Termination Notice to Owner.'));

  rows.push(p('<strong>7. Captions</strong> &nbsp; In any dispute arising under this Lease, in the event of a conflict between the text and a caption, the text controls.'));

  rows.push(p('<strong>8. Warranty of Habitability</strong> &nbsp; All sections of this Lease are subject to the Warranty of Habitability Law. Owner agrees that the Apartment and the Building are fit for human habitation and that there will be no conditions detrimental to life, health or safety. Tenant will do nothing to interfere with or make more difficult Owner&rsquo;s efforts to provide required facilities and services.'));

  rows.push(clauseBlock('alterations', '9. Care of Apartment; Changes and Alterations', 'Tenant will take good care of the Apartment and will not permit or do any damage to it, except through ordinary wear and tear. Tenant cannot build in, add to, change or alter the Apartment in any way without Owner&rsquo;s prior written consent, which may be withheld in Owner&rsquo;s sole discretion. If Owner&rsquo;s consent is given, alterations shall become the property of Owner when completed and paid for. Tenant must remove all installations at end of Term and restore the Apartment to its original condition.'));

  rows.push(p('<strong>10. Tenant&rsquo;s Duty to Obey and Comply with Laws</strong> &nbsp; Tenant will obey and comply with all present and future city, state and federal laws, rules, regulations and codes of any governmental or quasi-governmental entity or body which affect the Building or the Apartment, and with all orders and regulations of insurance rating organizations.'));

  rows.push(p('<strong>11. Objectionable Conduct</strong> &nbsp; Tenant, the Permitted Occupants, and any other people visiting the Apartment will not engage in objectionable conduct. Objectionable Conduct means behavior which makes or will make the Apartment or the Building less fit to live in for Tenant or other occupants, or causes conditions that are dangerous, hazardous, unsanitary or detrimental to other occupants. Objectionable Conduct gives Owner the right to end this Lease on six (6) days&rsquo; written notice.'));

  rows.push(p('<strong>12. Services and Facilities</strong> &nbsp; Owner will provide (i) cold and hot water and heat as required by law, (ii) repairs to the Apartment not caused by Tenant as required by law, (iii) elevator service if the Building has elevator equipment, and (iv) the utilities included in the Rent. The following utilities are included in the Rent: ________________________________. Tenant shall be responsible for securing all other utilities and services at Tenant&rsquo;s sole cost. Stopping or reducing services will not be reason for Tenant to stop paying Rent or claim constructive eviction.'));

  rows.push(p('<strong>13. Inability to Provide Services</strong> &nbsp; Because of a strike, labor trouble, national emergency, repairs, or any other cause beyond Owner&rsquo;s reasonable control, Owner may not be able to provide or may be delayed in providing services or making repairs. In any of these events, any rights Tenant may have against Owner are only those rights allowed by law.'));

  rows.push(p('<strong>14. Entry to Apartment</strong> &nbsp; During reasonable hours and with reasonable notice, except in emergencies, Owner and Owner&rsquo;s representatives may enter the Apartment to: inspect; erect, use and maintain pipes and conduits; exterminate; install or work on systems or equipment; perform any repairs, alterations, or changes Owner decides are necessary; show the Apartment to potential buyers or lenders; and for ninety (90) days before the end of the Lease Term, show the Apartment to persons who wish to lease it.'));

  rows.push(clauseBlock('sublet', '15. Assigning; Subletting; Abandonment', 'Tenant cannot assign this Lease or sublet all or part of the Apartment or permit any other person to use the Apartment without Owner&rsquo;s advance written consent in each instance, which Owner may withhold in its sole and absolute discretion. If Tenant moves out before the end of this Lease without consent (abandonment), this Lease will not be ended. Tenant will remain responsible for each monthly payment of rent until the end of this Lease, subject to Real Property Law &sect;227-e.'));

  rows.push(p('<strong>16. Default</strong> &nbsp; Tenant defaults under the Lease if Tenant: (A) fails to carry out any agreement or provision of this Lease; (B) does not take possession or move into the Apartment 15 days after the beginning of this Lease; or (C) engages in Objectionable Conduct. If Tenant defaults (other than failure to pay rent), Owner may serve Tenant with a written notice to stop or correct the specified default within ten (10) days.'));

  rows.push(p('<strong>17. Remedies of Owner and Tenant&rsquo;s Liability</strong> &nbsp; If this Lease is ended by Owner because of Tenant&rsquo;s default, Tenant must pay rent until this Lease has ended. Thereafter, Tenant must pay an equal amount for use and occupancy until Tenant actually moves out. Tenant must also pay Owner: (1) the difference between the rent in this Lease and the amount, if any, of rents collected in any later lease for the remaining period; (2) Owner&rsquo;s expenses for advertisements, broker&rsquo;s fees, and the cost of putting the Apartment in good condition; and (3) Owner&rsquo;s reasonable attorney&rsquo;s fees.'));

  rows.push(p('<strong>18. Additional Owner Remedies</strong> &nbsp; If Tenant does not do everything Tenant has agreed to do, Owner has the right to ask a court to make Tenant carry out Tenant&rsquo;s agreement or to give Owner such other relief as the Court can provide. This is in addition to the remedies in Articles 16 and 17.'));

  rows.push(p('<strong>19. Fees and Expenses</strong> &nbsp; Tenant must reimburse Owner for any fees and expenses incurred by Owner in making repairs to the Apartment which result from misuse or negligence by Tenant or the Tenant Parties, correcting any violations of laws caused by Tenant, or bringing any legal proceedings against Tenant.'));

  rows.push(p('<strong>20. Jury Trial Waiver</strong> &nbsp; Owner and Tenant each waive the right to a jury trial in any action or proceeding between Owner and Tenant relating to this Lease or the Apartment.'));

  rows.push(p('<strong>21. No Waiver</strong> &nbsp; Owner&rsquo;s acceptance of rent or failure to enforce any term in this Lease is not a waiver of Owner&rsquo;s rights. If a term in this Lease is illegal, the rest of this Lease remains in full force.'));

  rows.push(p('<strong>22. Subordination</strong> &nbsp; This Lease and Tenant&rsquo;s rights are subject and subordinate to all present and future mortgages on the Building or the land on which it stands, and agreements securing money paid or to be paid by a lender.'));

  rows.push(p('<strong>23. Condemnation</strong> &nbsp; If all of the Apartment or Building is taken or condemned by a legal authority, the Term and Tenant&rsquo;s rights shall end as of the date the authority takes title. If any part of the Apartment or Building is taken, Owner may cancel this Lease on notice to Tenant.'));

  rows.push(p('<strong>24. Non-Disturbance</strong> &nbsp; If this Lease is subject and subordinate to a mortgage, Owner will obtain a non-disturbance agreement for Tenant from any mortgage lender if requested by Tenant, provided Tenant is not in default under this Lease.'));

  rows.push(clauseBlock('noise', '25. Rules and Regulations', 'Tenant must comply with all Owner&rsquo;s rules annexed hereto and all future reasonable rules of Owner or Owner&rsquo;s agent. Tenant shall not make or permit any disturbing noise in the Building or interfere with occupants of other Apartments. Notice of new Rules will be given to Tenant in writing.'));

  rows.push(p('<strong>26. Representations</strong> &nbsp; Tenant has read this Lease. All promises made by Owner are in this Lease. There are no others. This Lease may be changed only by a written agreement signed by and delivered to each party.'));

  rows.push(p('<strong>27. Landlord Unable to Perform</strong> &nbsp; If due to labor trouble, government order, lack of supply, Tenant&rsquo;s act or neglect, or any other cause not fully within Owner&rsquo;s reasonable control, Owner is delayed or unable to carry out any of Owner&rsquo;s promises, this Lease shall not be ended or Tenant&rsquo;s obligations affected.'));

  rows.push(p('<strong>28. End of Term</strong> &nbsp; At the end of the Term, Tenant must leave the Apartment clean and in good condition, subject to ordinary wear and tear; remove all of Tenant&rsquo;s property and installations; repair all damages caused by moving; and restore the Apartment to its condition at the beginning of the Term. The Apartment has not been vacated until all persons, furniture and other property of Tenant are also out of the Apartment.'));

  rows.push(p('<strong>29. Space &ldquo;As Is&rdquo;</strong> &nbsp; Tenant has inspected the Apartment and Building. Tenant states they are in good order and repair and takes the Apartment as is, except for latent defects and Owner&rsquo;s Work set forth in Exhibit C attached hereto.'));

  rows.push(p('<strong>30. Non-Disturbance / Estoppel Certificate</strong> &nbsp; Upon request by Owner, Tenant shall sign a certificate stating: (1) this Lease is in full force and unchanged; (2) Owner has fully performed all terms of this Lease; (3) Tenant is fully performing all terms; and (4) rent and additional rent have been paid to date.'));

  rows.push(p('<strong>31. Holdover</strong> &nbsp; If Tenant holds over after the expiration of the Term without Owner&rsquo;s written consent, Tenant shall pay Owner 150% of the monthly Rent in effect at the expiration of the Term for each month or part thereof of such holdover. Such holdover shall be on a month-to-month basis and subject to all terms of this Lease.'));

  rows.push(p('<strong>32. Non-Renewal Notice</strong> &nbsp; In the event Owner intends to offer to renew this Lease with a Rent increase of 5% or more, or does not intend to renew, Owner shall provide: (i) at least 30 days&rsquo; notice if Tenant has occupied the Apartment less than one year; (ii) at least 60 days&rsquo; notice if more than one year but less than two years; or (iii) at least 90 days&rsquo; notice if more than two years.'));

  rows.push(clauseBlock('smoking', '33. Smoking Policy', 'Smoking of tobacco or any substance is prohibited in the Apartment, on terraces or balconies, and in all common areas of the Building including hallways, stairwells, lobbies, laundry rooms, and any shared amenity spaces.'));

  rows.push(clauseBlock('airbnb', '34. No Short-Term Rental', 'Tenant shall not list or offer the Apartment on Airbnb, VRBO, or any short-term rental platform. Any violation shall constitute an immediate material default and grounds for termination of this Lease and may subject Tenant to penalties under applicable law.'));

  rows.push(clauseBlock('keycard', '35. Keys and Access Devices', 'Tenant acknowledges receipt of _______ key(s) and _______ access card(s). Lost or additional keys and access devices shall be replaced at Tenant&rsquo;s sole expense. All keys and access devices must be returned to Owner on the last day of the Term.'));

  rows.push(clauseBlock('concierge', '36. Building Procedures', 'Tenant and all occupants shall comply with all building concierge, delivery, visitor, and move-in/move-out procedures established by Owner or building management, as may be amended from time to time upon reasonable written notice to Tenant.'));

  rows.push(clauseBlock('reno', '37. Renovation Notice', 'Tenant acknowledges that construction or renovation work may be performed in or near the Building or in adjacent units. Such work shall not constitute a constructive eviction or entitle Tenant to any abatement of rent.'));

  rows.push(clauseBlock('hoarder', '38. Excessive Property', 'Tenant shall not accumulate personal property in the Apartment or Building common areas in such a manner as to create a health, safety, fire, or structural hazard. Owner shall have the right to require removal of such property upon written notice.'));

  rows.push(clauseBlock('earlyterm', '39. Early Termination', 'Tenant may terminate this Lease prior to the expiration of the Term upon not less than sixty (60) days&rsquo; prior written notice to Owner and payment of an early termination fee equal to two (2) months&rsquo; Rent, which shall be deemed liquidated damages and not a penalty.'));

  rows.push(clauseBlock('guarantor', '40. Guaranty', 'Any guaranty of this Lease by a Guarantor shall be executed simultaneously with this Lease. The Guarantor unconditionally guarantees the full performance of all of Tenant&rsquo;s obligations under this Lease, including the payment of all Rent and Additional Rent.'));

  // Renewal Option Article 35
  if (d.renewalCount > 0) rows.push(buildRenewalArticle(d, '35', 'Tenant'));

    rows.push(p('<strong>41. Broker</strong> &nbsp; Tenant represents that Tenant has not dealt with any real estate broker in connection with this Lease except: ' + blank(d.broker, '________________________________') + '. Tenant shall indemnify Owner against any claims arising from any breach of this representation.'));

  rows.push(p('<strong>42. Exhibit D &mdash; Apartment Furniture</strong> &nbsp; ' + (d.furnished ? 'The Apartment is leased in its furnished condition. A complete inventory of the Furniture is set forth in Exhibit D attached hereto. See also Furnished Apartment Rider.' : 'The Apartment is leased unfurnished. No furniture or personal property of Owner is included in this Lease unless specifically set forth in Exhibit D attached hereto.')));

  rows.push(rebnySignatureBlock(d));
  return rows.join('\n');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// REBNY CONDOMINIUM APARTMENT LEASE (REBNY Condo 2019 Rev 7.19)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildREBNYCondo(d) {
  var bankLine = (d.securityBank ? blank(d.securityBank) : '________________________________') + ' bank at ' + (d.securityBankAddr ? blank(d.securityBankAddr) : '________________________________');
  var pkgDue   = d.leasePackageDue ? blank(d.leasePackageDue) : '________________________________';
  var rows = [];

  rows.push(rebnyHeaderTable(d, 'STANDARD FORM OF CONDOMINIUM APARTMENT LEASE', 'REBNY Condo 2019 Rev 7.19'));
  rows.push(rebnyPartyBlock(d));
  rows.push('<p><em>Please note the following paragraphs that require a selection among alternative wording: 2, 3E, 36. Please note paragraphs that require insertion of terms (and/or delete if inapplicable): 1, 2, 3A, 3B, 5, 10D, 13, 26, 33, 36, 37, 40, Exhibit A, Exhibit B, Exhibit C.</em></p>');

  rows.push(rebnyCommonArticles(d, 'Apartment'));

  rows.push(p('<strong>3B. Lease Package</strong> &nbsp; Tenant acknowledges and agrees that at Owner&rsquo;s request, a copy of all bank or cashier&rsquo;s checks and the lease package required by the Condominium (the &ldquo;Lease Package&rdquo;) must be submitted with the signed Lease to Owner&rsquo;s Attorney and/or Broker. Tenant shall complete the Lease Package in good faith and with reasonable diligence (and in any event no later than ' + pkgDue + ').'));

  rows.push(p('<strong>4. Condominium Documents</strong> &nbsp; Tenant understands that the Apartment is part of a condominium apartment building (' + blank(d.buildingName || 'the Condominium') + ') and that this Lease shall be subject and subordinate to: (i) the Declaration of Condominium; (ii) the Rules and Regulations of the Condominium; and (iii) the By-Laws of the Condominium (collectively the &ldquo;Condominium Documents&rdquo;). Tenant and Permitted Occupants shall faithfully observe and comply with the Condominium Documents. A violation of the Condominium Documents by Tenant shall be a default under this Lease. Tenant acknowledges that Tenant has reviewed the Condominium Documents or waived their examination. This Lease may not commence until the Condominium has waived any first refusal rights it may have with respect to this Lease.'));

  rows.push(p('<strong>5. Security Deposit</strong> &nbsp; Tenant is required to give Owner the sum of ' + blank(d.deposit) + ' (not to exceed one (1) month&rsquo;s Rent pursuant to The Housing Stability and Tenant Protection Act of 2019) when Tenant signs this Lease as a security deposit. Owner will deposit the Security Deposit in ' + bankLine + '. This Security Deposit shall not bear interest unless required by applicable law. Owner will return the full Security Deposit within fourteen (14) days after the later of (i) the date this Lease ends, or (ii) the date Tenant vacates the Apartment, provided Tenant has carried out all agreements in this Lease and returned the Apartment in the same condition, except for ordinary wear and tear. TENANT ACKNOWLEDGES AND AGREES THAT THE SECURITY DEPOSIT CANNOT BE USED TOWARDS RENT OR ADDITIONAL RENT BY TENANT.'));

  rows.push(p('<strong>6. If Tenant Is Unable to Move In</strong> &nbsp; Except as otherwise provided herein, Owner shall not be liable for failure to give Tenant possession of the Apartment on the Lease Commencement Date. If this happens for reasons beyond Owner&rsquo;s reasonable control, Owner will not be responsible for Tenant&rsquo;s damages or expenses and this Lease will remain in effect. If Owner does not give Tenant notice that possession is available within thirty (30) days after the Lease Commencement Date, Tenant may send a fifteen (15) day written Termination Notice to Owner.'));

  rows.push(p('<strong>7. Captions</strong> &nbsp; In any dispute arising under this Lease, in the event of a conflict between the text and a caption, the text controls.'));

  rows.push(p('<strong>8. Warranty of Habitability</strong> &nbsp; All sections of this Lease are subject to the Warranty of Habitability Law. Owner agrees that the Apartment is fit for human habitation and that there will be no conditions detrimental to life, health or safety.'));

  rows.push(clauseBlock('alterations', '9. Care of Apartment; Changes and Alterations', 'Tenant will take good care of the Apartment and will not permit or do any damage to it, except through ordinary wear and tear. Tenant cannot build in, add to, change or alter the Apartment in any way without Owner&rsquo;s prior written consent and, where required, the prior written consent of the Condominium, which may be withheld in Owner&rsquo;s and the Condominium&rsquo;s sole discretion. If consent is given, alterations shall become the property of Owner when completed and paid for.'));

  rows.push(p('<strong>10. Tenant&rsquo;s Duty to Obey and Comply with Laws</strong> &nbsp; Tenant will obey and comply with all present and future laws, rules, regulations and codes of any governmental or quasi-governmental entity which affect the Building or the Apartment, and with the Condominium Documents. Tenant will not allow any windows in the Apartment to be cleaned from the outside unless Owner&rsquo;s prior written consent is obtained.'));

  rows.push(p('<strong>11. Objectionable Conduct</strong> &nbsp; Tenant, the Permitted Occupants, and any other people visiting the Apartment will not engage in objectionable conduct at the Apartment or the Building. Objectionable Conduct gives Owner the right to end this Lease on six (6) days&rsquo; written notice.'));

  rows.push(p('<strong>12. Services and Facilities</strong> &nbsp; Owner will provide cold and hot water and heat as required by law, repairs to the Apartment not caused by Tenant, elevator service if the Building has elevator equipment, and the utilities, if any, included in the Rent. The following utilities are included in the Rent: ________________________________. Tenant is not entitled to any Rent reduction because of a stoppage or reduction of services unless provided by law.'));

  rows.push(p('<strong>13. Inability to Provide Services</strong> &nbsp; Because of a strike, labor trouble, national emergency, repairs, or any other cause beyond Owner&rsquo;s reasonable control, Owner may not be able to provide or may be delayed in providing services or making repairs. In any of these events, any rights Tenant may have against Owner are only those rights allowed by law.'));

  rows.push(p('<strong>14. Entry to Apartment</strong> &nbsp; During reasonable hours and with reasonable notice, except in emergencies, Owner and Owner&rsquo;s representatives may enter the Apartment to inspect, make repairs, show the Apartment to potential buyers or lenders, and for ninety (90) days before the end of the Lease Term, show the Apartment to persons who wish to lease it.'));

  rows.push(clauseBlock('sublet', '15. Assigning; Subletting; Abandonment', 'Tenant cannot assign this Lease or sublet all or part of the Apartment or permit any other person to use the Apartment without Owner&rsquo;s advance written consent in each instance, which Owner may withhold in its sole and absolute discretion. In addition, any assignment or subletting requires the prior consent of the Condominium to the extent required by the Condominium Documents. If Tenant moves out before the end of this Lease without consent (abandonment), Tenant will remain responsible for each monthly payment of rent until the end of this Lease.'));

  rows.push(p('<strong>16. Insurance</strong> &nbsp; Tenant shall, at Tenant&rsquo;s sole cost and expense, obtain and maintain throughout the Term a renter&rsquo;s or Tenant&rsquo;s Homeowners Insurance Policy with limits of not less than ' + blank(d.tenantInsurance || '$300,000') + ' per occurrence. Tenant shall deliver a copy of the binder to Owner prior to taking possession of the Apartment. All policies shall name Owner as an additional insured.'));

  rows.push(p('<strong>17. Default</strong> &nbsp; Tenant defaults under the Lease if Tenant: (A) fails to carry out any agreement or provision of this Lease; (B) does not take possession or move into the Apartment 15 days after the beginning of this Lease; (C) violates the Condominium Documents; or (D) engages in Objectionable Conduct. If Tenant defaults (other than failure to pay rent), Owner may serve Tenant with a written notice to stop or correct the specified default within ten (10) days.'));

  rows.push(p('<strong>18. Remedies of Owner and Tenant&rsquo;s Liability</strong> &nbsp; If this Lease is ended by Owner because of Tenant&rsquo;s default, Tenant must pay rent until this Lease has ended, then an equal amount for use and occupancy until Tenant actually moves out. Tenant must also pay Owner: (1) the difference between the rent in this Lease and rents collected in any later lease for the remaining period; (2) Owner&rsquo;s expenses for advertisements, broker&rsquo;s fees, and the cost of putting the Apartment in good condition; and (3) Owner&rsquo;s reasonable attorney&rsquo;s fees.'));

  rows.push(p('<strong>19. Additional Owner Remedies; Fees</strong> &nbsp; If Tenant does not do everything Tenant has agreed to do, Owner has the right to ask a court to make Tenant carry out Tenant&rsquo;s agreement or to give Owner such other relief as the Court can provide. Tenant must also reimburse Owner for fees and expenses incurred in connection with defaults by Tenant.'));

  rows.push(p('<strong>20. Jury Trial Waiver</strong> &nbsp; Owner and Tenant each waive the right to a jury trial in any action or proceeding between Owner and Tenant relating to this Lease or the Apartment.'));

  rows.push(p('<strong>21. No Waiver</strong> &nbsp; Owner&rsquo;s acceptance of rent or failure to enforce any term in this Lease is not a waiver of Owner&rsquo;s rights. If a term in this Lease is illegal, the rest of this Lease remains in full force.'));

  rows.push(p('<strong>22. Subordination</strong> &nbsp; This Lease and Tenant&rsquo;s rights are subject and subordinate to all present and future mortgages on the Building or the Apartment, and to the Condominium Documents.'));

  rows.push(p('<strong>23. Condemnation</strong> &nbsp; If all of the Apartment or Building is taken or condemned by a legal authority, the Term and Tenant&rsquo;s rights shall end as of the date the authority takes title. If any part is taken, Owner may cancel this Lease on notice to Tenant.'));

  rows.push(clauseBlock('noise', '24. Rules and Regulations', 'Tenant must comply with all Owner&rsquo;s rules and the Condominium&rsquo;s Rules and Regulations. Tenant shall not make or permit any disturbing noise in the Building or interfere with other occupants or the Condominium.'));

  rows.push(p('<strong>25. Common Charges and Real Estate Taxes</strong> &nbsp; Tenant shall pay to Owner, as Additional Rent, all increases in Common Charges, Common Expenses and Association dues related to the Apartment which exceed those charges payable on the date of this Lease, and any increase in Real Estate Taxes above those assessed on the commencement date of the Term.'));

  rows.push(p('<strong>26. No Affirmative Obligations of Owner</strong> &nbsp; Owner is not obligated to provide or render any services whatsoever to Tenant or perform any affirmative obligations under the terms of this Lease. Owner shall not be liable to Tenant for any act or omission of the Condominium, Board of Managers, or any other party. Tenant must continue to pay all Rent and Additional Rent as required under the terms of this Lease in spite of any failure of performance.'));

  rows.push(p('<strong>27. Non-Renewal Notice</strong> &nbsp; In the event Owner intends to offer to renew this Lease with a Rent increase of 5% or more, or does not intend to renew, Owner shall provide: (i) at least 30 days&rsquo; notice if Tenant has occupied the Apartment less than one year; (ii) at least 60 days&rsquo; notice if more than one year but less than two years; or (iii) at least 90 days&rsquo; notice if more than two years.'));

  rows.push(p('<strong>28. Holdover</strong> &nbsp; If Tenant holds over after the expiration of the Term without Owner&rsquo;s written consent, Tenant shall pay Owner 150% of the monthly Rent in effect at the expiration of the Term for each month or part thereof of such holdover.'));

  rows.push(clauseBlock('smoking', '29. Smoking Policy', 'Smoking of tobacco or any substance is prohibited in the Apartment, on terraces or balconies, and in all common areas of the Building.'));
  rows.push(clauseBlock('airbnb', '30. No Short-Term Rental', 'Tenant shall not list or offer the Apartment on Airbnb, VRBO, or any short-term rental platform. Any violation shall constitute an immediate material default and grounds for termination of this Lease.'));
  rows.push(clauseBlock('keycard', '31. Keys and Access Devices', 'Tenant acknowledges receipt of _______ key(s) and _______ access card(s). Lost or additional keys and access devices shall be replaced at Tenant&rsquo;s sole expense. All keys and access devices must be returned to Owner on the last day of the Term.'));
  rows.push(clauseBlock('reno', '32. Renovation Notice', 'Tenant acknowledges that construction or renovation work may be performed in or near the Building or in adjacent units. Such work shall not constitute a constructive eviction or entitle Tenant to any abatement of rent.'));
  rows.push(clauseBlock('hoarder', '33. Excessive Property', 'Tenant shall not accumulate personal property in the Apartment or Building common areas in such a manner as to create a health, safety, fire, or structural hazard. Owner shall have the right to require removal of such property upon written notice.'));
  rows.push(clauseBlock('earlyterm', '34. Early Termination', 'Tenant may terminate this Lease prior to the expiration of the Term upon not less than sixty (60) days&rsquo; prior written notice to Owner and payment of an early termination fee equal to two (2) months&rsquo; Rent.'));
  rows.push(clauseBlock('guarantor', '35. Guaranty', 'Any guaranty of this Lease by a Guarantor shall be executed simultaneously with this Lease. The Guarantor unconditionally guarantees the full performance of all of Tenant&rsquo;s obligations under this Lease.'));

  // Renewal Option Article 37
  if (d.renewalCount > 0) rows.push(buildRenewalArticle(d, '37', 'Tenant'));

    rows.push(p('<strong>36. Broker</strong> &nbsp; Tenant represents that Tenant has not dealt with any real estate broker in connection with this Lease except: ' + blank(d.broker, '________________________________') + '. Tenant shall indemnify Owner against any claims arising from any breach of this representation.'));

  rows.push(p('<strong>37. Exhibit C &mdash; Apartment Furniture</strong> &nbsp; ' + (d.furnished ? 'The Apartment is leased in its furnished condition. A complete inventory of the Furniture is set forth in Exhibit C attached hereto. See also Furnished Apartment Rider.' : 'The Apartment is leased unfurnished. No furniture or personal property of Owner is included in this Lease unless specifically set forth in Exhibit C attached hereto.')));

  rows.push(rebnySignatureBlock(d));
  return rows.join('\n');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// REBNY COOPERATIVE APARTMENT SUBLEASE (REBNY Coop 2019 Rev 7.19)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildREBNYCoop(d) {
  var bankLine  = (d.securityBank ? blank(d.securityBank) : '________________________________') + ' bank at ' + (d.securityBankAddr ? blank(d.securityBankAddr) : '________________________________');
  var pkgDue    = d.leasePackageDue ? blank(d.leasePackageDue) : '________________________________';
  var apCorp    = d.apartmentCorp ? blank(d.apartmentCorp) : '________________________________';
  var rows = [];

  rows.push(rebnyHeaderTable(d, 'STANDARD FORM OF COOPERATIVE APARTMENT SUBLEASE', 'REBNY Coop 2019 Rev 7.19'));
  rows.push(rebnyPartyBlock(d, 'Subtenant', 'Owner'));
  rows.push('<p><em>Please note the following paragraphs that require a selection among alternative wording: 2, 3E, 37. Please note paragraphs that require insertion of terms (and/or delete if inapplicable): 1, 2, 3A, 3B, 5, 10D, 13, 26, 34C, 37, 38, 41, Exhibit A, Exhibit B, Exhibit C.</em></p>');

  rows.push(rebnyCommonArticles(d, 'Apartment', 'Subtenant', 'Owner'));

  rows.push(p('<strong>1A. Cooperative Documents</strong> &nbsp; Owner agrees to sublease to Subtenant Apartment ' + blank(d.unit) + ' on the ' + blank(d.floor, '____') + ' floor in the cooperative apartment building at ' + blank(d.address) + ' (the &ldquo;Building&rdquo;), Borough of ' + blank(d.borough || 'Manhattan') + ', City and State of New York. Subtenant acknowledges that: (i) this Sublease may not commence until the occupancy of the Apartment by Subtenant and the Permitted Occupants has been approved by the Board of Directors of ' + apCorp + ' (the &ldquo;Apartment Corporation&rdquo;), which also waives any first refusal rights; and (ii) no other person may reside in the Apartment without the prior written consent of Owner and the Apartment Corporation.'));

  rows.push(p('<strong>3B. Sublease Package</strong> &nbsp; Subtenant acknowledges and agrees that at Owner&rsquo;s request, a copy of all bank or cashier&rsquo;s checks and the sublease package required by the Apartment Corporation (the &ldquo;Sublease Package&rdquo;) must be submitted with the signed Sublease to Owner&rsquo;s Attorney and/or Broker. Subtenant shall complete the Sublease Package in good faith and with reasonable diligence (and in any event no later than ' + pkgDue + ').'));

  rows.push(p('<strong>4. Cooperative Documents</strong> &nbsp; Subtenant understands that the Apartment is part of a cooperative apartment building and that this Sublease shall be subject and subordinate to: (i) the Proprietary Lease and House Rules; (ii) the By-Laws of ' + apCorp + '; and (iii) all rules, regulations and policies of the Apartment Corporation (collectively the &ldquo;Cooperative Documents&rdquo;). Subtenant and Permitted Occupants shall faithfully observe and comply with the Cooperative Documents. A violation of the Cooperative Documents by Subtenant shall be a default under this Sublease. Subtenant acknowledges reviewing or waiving examination of the Cooperative Documents.'));

  rows.push(p('<strong>5. Security Deposit</strong> &nbsp; Subtenant is required to give Owner the sum of ' + blank(d.deposit) + ' (not to exceed one (1) month&rsquo;s Rent pursuant to The Housing Stability and Tenant Protection Act of 2019) when Subtenant signs this Sublease as a security deposit. Owner will deposit the Security Deposit in ' + bankLine + '. Owner will return the full Security Deposit within fourteen (14) days after the later of (i) the date this Sublease ends, or (ii) the date Subtenant vacates the Apartment, provided Subtenant has carried out all agreements in this Sublease and returned the Apartment in the same condition, except for ordinary wear and tear. SUBTENANT ACKNOWLEDGES AND AGREES THAT THE SECURITY DEPOSIT CANNOT BE USED TOWARDS RENT OR ADDITIONAL RENT BY SUBTENANT.'));

  rows.push(p('<strong>6. If Subtenant Is Unable to Move In</strong> &nbsp; Owner shall not be liable for failure to give Subtenant possession of the Apartment on the Sublease Commencement Date. If this happens for reasons beyond Owner&rsquo;s reasonable control, Owner will not be responsible for Subtenant&rsquo;s damages or expenses and this Sublease will remain in effect. If Owner does not give Subtenant notice that possession is available within thirty (30) days after the Sublease Commencement Date, Subtenant may send a fifteen (15) day written Termination Notice to Owner.'));

  rows.push(p('<strong>7. Captions</strong> &nbsp; In any dispute arising under this Sublease, in the event of a conflict between the text and a caption, the text controls.'));

  rows.push(p('<strong>8. Warranty of Habitability</strong> &nbsp; All sections of this Sublease are subject to the Warranty of Habitability Law. Owner agrees that the Apartment is fit for human habitation and that there will be no conditions detrimental to life, health or safety.'));

  rows.push(clauseBlock('alterations', '9. Care of Apartment; Changes and Alterations', 'Subtenant will take good care of the Apartment and will not permit or do any damage to it, except through ordinary wear and tear. Subtenant cannot build in, add to, change or alter the Apartment in any way without Owner&rsquo;s prior written consent and, where required, the prior written consent of the Apartment Corporation. If consent is given, alterations shall become the property of Owner when completed and paid for. Subtenant must remove all installations at end of Term and restore the Apartment to its original condition.'));

  rows.push(p('<strong>10. Subtenant&rsquo;s Duty to Obey and Comply with Laws</strong> &nbsp; Subtenant will obey and comply with all present and future laws, rules, regulations and codes of any governmental or quasi-governmental entity which affect the Building or the Apartment, with all orders and regulations of insurance rating organizations, and with the Cooperative Documents. Subtenant is responsible for the behavior of Subtenant, Permitted Occupants and all other persons visiting the Apartment.'));

  rows.push(p('<strong>11. Objectionable Conduct</strong> &nbsp; Subtenant, the Permitted Occupants, and any other people visiting the Apartment will not engage in objectionable conduct at the Apartment or the Building. Objectionable Conduct gives Owner the right to end this Sublease on six (6) days&rsquo; written notice.'));

  rows.push(p('<strong>12. Services and Facilities</strong> &nbsp; Owner will provide cold and hot water and heat as required by law, repairs to the Apartment not caused by Subtenant, elevator service if the Building has elevator equipment, and the utilities, if any, included in the Rent. The following utilities are included in the Rent: ________________________________. Subtenant is not entitled to any Rent reduction because of a stoppage or reduction of services unless provided by law.'));

  rows.push(p('<strong>13. Entry to Apartment</strong> &nbsp; During reasonable hours and with reasonable notice, except in emergencies, Owner and Owner&rsquo;s representatives, and authorized representatives of the Apartment Corporation may enter the Apartment to inspect, make repairs, show the Apartment to potential buyers or lenders, and for ninety (90) days before the end of the Sublease Term, show the Apartment to persons who wish to sublease it.'));

  rows.push(clauseBlock('sublet', '14. Assigning; Subletting; Abandonment', 'Subtenant cannot assign this Sublease or further sublet all or part of the Apartment or permit any other person to use the Apartment without Owner&rsquo;s advance written consent and the prior written consent of the Apartment Corporation, each of which may be withheld in its sole discretion. If Subtenant moves out before the end of this Sublease without consent (abandonment), Subtenant will remain responsible for each monthly payment of rent until the end of this Sublease.'));

  rows.push(p('<strong>15. Insurance</strong> &nbsp; Subtenant shall, at Subtenant&rsquo;s sole cost and expense, obtain and maintain throughout the Term a renter&rsquo;s or Subtenant&rsquo;s Homeowners Insurance Policy with limits of not less than ' + blank(d.tenantInsurance || '$300,000') + ' per occurrence. Subtenant shall deliver a copy of the binder to Owner prior to taking possession of the Apartment. All policies shall name Owner as an additional insured.'));

  rows.push(p('<strong>16. Default</strong> &nbsp; Subtenant defaults under the Sublease if Subtenant: (A) fails to carry out any agreement or provision of this Sublease; (B) does not take possession or move into the Apartment 15 days after the beginning of this Sublease; (C) violates the Cooperative Documents; or (D) engages in Objectionable Conduct. If Subtenant defaults (other than failure to pay rent), Owner may serve Subtenant with a written notice to stop or correct the specified default within ten (10) days.'));

  rows.push(p('<strong>17. Remedies of Owner and Subtenant&rsquo;s Liability</strong> &nbsp; If this Sublease is ended by Owner because of Subtenant&rsquo;s default, Subtenant must pay rent until this Sublease has ended, then an equal amount for use and occupancy until Subtenant actually moves out. Subtenant must also pay Owner: (1) the difference between the rent in this Sublease and rents collected in any later lease for the remaining period; (2) Owner&rsquo;s expenses for advertisements, broker&rsquo;s fees, and the cost of putting the Apartment in good condition; and (3) Owner&rsquo;s reasonable attorney&rsquo;s fees.'));

  rows.push(p('<strong>18. Additional Owner Remedies; Fees and Expenses</strong> &nbsp; If Subtenant does not do everything Subtenant has agreed to do, Owner has the right to ask a court to make Subtenant carry out Subtenant&rsquo;s agreement or to give Owner such other relief as the Court can provide. Subtenant must also reimburse Owner for fees and expenses incurred in connection with defaults by Subtenant.'));

  rows.push(p('<strong>19. Jury Trial Waiver</strong> &nbsp; Owner and Subtenant each waive the right to a jury trial in any action or proceeding between Owner and Subtenant relating to this Sublease or the Apartment.'));

  rows.push(p('<strong>20. No Waiver; Illegality</strong> &nbsp; Owner&rsquo;s acceptance of rent or failure to enforce any term in this Sublease is not a waiver of Owner&rsquo;s rights. If a term in this Sublease is illegal, the rest of this Sublease remains in full force.'));

  rows.push(p('<strong>21. Subordination</strong> &nbsp; This Sublease and Subtenant&rsquo;s rights are subject and subordinate to all present and future mortgages on the Building or the land on which it stands, and to the Cooperative Documents including the Proprietary Lease.'));

  rows.push(clauseBlock('noise', '22. Rules and Regulations', 'Subtenant must comply with all Owner&rsquo;s rules and the Apartment Corporation&rsquo;s House Rules and Regulations. Subtenant shall not make or permit any disturbing noise in the Building or interfere with other occupants.'));

  rows.push(p('<strong>23. Maintenance Pass-Through</strong> &nbsp; Subtenant shall pay to Owner, as Additional Rent, any increases in the monthly maintenance charges, assessments, or other fees imposed on Owner&rsquo;s Apartment by the Apartment Corporation during the Term of this Sublease which exceed those charges in effect on the Sublease Commencement Date.'));

  rows.push(p('<strong>24. Non-Renewal Notice</strong> &nbsp; In the event Owner intends to offer to renew this Sublease with a Rent increase of 5% or more, or does not intend to renew, Owner shall provide: (i) at least 30 days&rsquo; notice if Subtenant has occupied the Apartment less than one year; (ii) at least 60 days&rsquo; notice if more than one year but less than two years; or (iii) at least 90 days&rsquo; notice if more than two years.'));

  rows.push(p('<strong>25. Holdover</strong> &nbsp; If Subtenant holds over after the expiration of the Term without Owner&rsquo;s written consent, Subtenant shall pay Owner 150% of the monthly Rent in effect at the expiration of the Term for each month or part thereof of such holdover.'));

  rows.push(clauseBlock('smoking', '26. Smoking Policy', 'Smoking of tobacco or any substance is prohibited in the Apartment, on terraces or balconies, and in all common areas of the Building.'));
  rows.push(clauseBlock('airbnb', '27. No Short-Term Rental', 'Subtenant shall not list or offer the Apartment on Airbnb, VRBO, or any short-term rental platform. Any violation shall constitute an immediate material default and grounds for termination of this Sublease.'));
  rows.push(clauseBlock('keycard', '28. Keys and Access Devices', 'Subtenant acknowledges receipt of _______ key(s) and _______ access card(s). Lost or additional keys and access devices shall be replaced at Subtenant&rsquo;s sole expense. All keys and access devices must be returned to Owner on the last day of the Term.'));
  rows.push(clauseBlock('reno', '29. Renovation Notice', 'Subtenant acknowledges that construction or renovation work may be performed in or near the Building or in adjacent units. Such work shall not constitute a constructive eviction or entitle Subtenant to any abatement of rent.'));
  rows.push(clauseBlock('hoarder', '30. Excessive Property', 'Subtenant shall not accumulate personal property in the Apartment or Building common areas in such a manner as to create a health, safety, fire, or structural hazard. Owner shall have the right to require removal of such property upon written notice.'));
  rows.push(clauseBlock('earlyterm', '31. Early Termination', 'Subtenant may terminate this Sublease prior to the expiration of the Term upon not less than sixty (60) days&rsquo; prior written notice to Owner and payment of an early termination fee equal to two (2) months&rsquo; Rent.'));
  rows.push(clauseBlock('guarantor', '32. Guaranty', 'Any guaranty of this Sublease by a Guarantor shall be executed simultaneously with this Sublease. The Guarantor unconditionally guarantees the full performance of all of Subtenant&rsquo;s obligations under this Sublease.'));

  // Renewal Option Article 38
  if (d.renewalCount > 0) rows.push(buildRenewalArticle(d, '38', 'Subtenant'));

    rows.push(p('<strong>33. Broker</strong> &nbsp; Subtenant represents that Subtenant has not dealt with any real estate broker in connection with this Sublease except: ' + blank(d.broker, '________________________________') + '. Subtenant shall indemnify Owner against any claims arising from any breach of this representation.'));

  rows.push(p('<strong>34. Exhibit C &mdash; Apartment Furniture</strong> &nbsp; ' + (d.furnished ? 'The Apartment is subleased in its furnished condition. A complete inventory of the Furniture is set forth in Exhibit C attached hereto. See also Furnished Apartment Rider.' : 'The Apartment is subleased unfurnished. No furniture or personal property of Owner is included in this Sublease unless specifically set forth in Exhibit C attached hereto.')));

  rows.push(rebnySignatureBlock(d, 'Subtenant', 'Owner'));
  return rows.join('\n');
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BLUMBERG 101 ‚Äî Condominium Unit Lease (12-96)
// Also used for Co-op (isCoop=true adds board-approval language)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildBlumberg101(d, isCoop) {
  var yr = '';
  if (d.rent) {
    var rn = parseFloat(d.rent.replace(/[^0-9.]/g, ''));
    if (!isNaN(rn)) yr = '$' + (rn * 12).toLocaleString();
  }
  var formLabel = isCoop ? 'Blumberg A-55 &mdash; Co-op Sublease' : '101 &mdash; Lease of a Condominium Unit, 12-96';
  var unitLabel = isCoop ? 'Apartment' : 'Unit';
  var boardLine = isCoop ? '<br><strong>Board Approval:</strong> ' + blank(d.boardApproval || 'Required') : '';
  var bldgLine  = d.buildingName ? '<br><strong>Name of ' + (isCoop ? 'Co-op' : 'Condominium') + ':</strong> ' + blank(d.buildingName) : '';
  var typeLabel = isCoop ? 'CO-OP APARTMENT SUBLEASE' : 'LEASE OF A CONDOMINIUM UNIT';

  var rows = [];
  rows.push('<div style="text-align:center;margin-bottom:18px;">');
  rows.push('<div style="font-size:0.75rem;color:#888;margin-bottom:4px;">' + formLabel + '</div>');
  rows.push('<div style="font-size:0.7rem;color:#aaa;">&copy; BlumbergExcelsior, Inc. | PREPARED BY ARNOLD MANDELL, L.L.B.</div>');
  rows.push('</div>');
  rows.push(ph(typeLabel));
  rows.push('<p style="text-align:center;font-style:italic;">The Landlord and Tenant agree to lease the ' + unitLabel + ' and Landlord&rsquo;s interest in the Common Elements located in the ' + (isCoop ? 'Building' : 'Condominium') + ' at:</p>');

  // Header table
  rows.push('<table style="width:100%;border-collapse:collapse;margin:16px 0;font-size:0.88rem;border:1px solid #ccc;">');
  rows.push('<tr>');
  rows.push('<td style="padding:8px;border:1px solid #ccc;width:50%;vertical-align:top;">');
  rows.push('<strong>LANDLORD:</strong><br>' + blank(d.landlord) + '<br><br>');
  rows.push('Address for Notices: ' + blank(d.landlordAddr, 'c/o XL Real Property Management, 80 Fifth Avenue, Suite 1501, New York, NY 10011') + (d.landlordEmail ? '<br>Email: ' + blank(d.landlordEmail) : '') + '<br>');
  rows.push(unitLabel + ': ' + blank(d.unit) + (d.floor ? ', Floor: ' + blank(d.floor) : '') + '<br>');
  rows.push('Address: ' + blank(d.address) + bldgLine + boardLine);
  rows.push('</td>');
  rows.push('<td style="padding:8px;border:1px solid #ccc;width:50%;vertical-align:top;">');
  rows.push('<strong>TENANT:</strong><br>' + blank(d.tenant) + '<br><br>');
  rows.push('Current Address: ' + blank(d.tenantCurrentAddr, '________________________________') + '<br>');
  rows.push('Email: ' + blank(d.tenantEmail, '________________________________'));
  rows.push('</td>');
  rows.push('</tr>');
  rows.push('<tr><td colspan="2" style="padding:0;border:1px solid #ccc;">');
  rows.push('<table style="width:100%;border-collapse:collapse;">');
  rows.push('<tr>');
  rows.push('<td style="padding:8px;border-right:1px solid #ccc;width:40%;vertical-align:top;">');
  rows.push('<strong>Lease date:</strong> ' + blank(d.startDate) + '<br><br>');
  rows.push('<strong>Term</strong> beginning ' + blank(d.startDate) + '<br>');
  rows.push('&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ending ' + blank(d.endDate));
  rows.push('</td>');
  rows.push('<td style="padding:8px;vertical-align:top;">');
  rows.push('<strong>Yearly Rent</strong> &nbsp;' + blank(yr) + '<br>');
  rows.push('<strong>Monthly Rent</strong> ' + blank(d.rent) + '<br>');
  rows.push('<strong>Security</strong> &nbsp;&nbsp;&nbsp;&nbsp;' + blank(d.deposit) + '<br>');
  if (!isCoop) rows.push('<strong>Garage Fee</strong> &nbsp;$________________________________');
  rows.push('</td>');
  rows.push('</tr>');
  rows.push('<tr><td colspan="2" style="padding:6px 8px;border-top:1px solid #ccc;">');
  rows.push('<strong>Broker*</strong> ' + blank(d.broker) + (isCoop ? '' : ' &nbsp;&nbsp; <strong>Declarant:</strong> ________________________________ &nbsp;&nbsp; <strong>Tenant&rsquo;s Insurance:</strong> $________________'));
  rows.push('</td></tr>');
  rows.push('</table>');
  rows.push('</td></tr>');
  rows.push('</table>');

  rows.push('<p style="font-size:0.82rem;color:#555;margin-bottom:16px;"><strong>Rider</strong> &nbsp; Additional terms on _______ page(s) initialed at the end by the parties is attached and made a part of this Lease.</p>');

  // Sections
  rows.push(p('<strong>1. Lease is subject and subordinate</strong> &nbsp; This Lease is subject and subordinate to (A) the By-Laws, Rules and Regulations and Provisions of the Declaration Establishing a Plan for ' + (isCoop ? 'Co-operative Ownership' : 'Condominium Ownership') + ' of the Premises and (B) Powers of Attorney granted to the Board of ' + (isCoop ? 'Directors' : 'Managers') + ', leases, agreements, mortgages, renewals, modifications, consolidations, replacements and extensions to which the Declaration or the ' + unitLabel + ' are presently or may in the future be subject. Tenant shall not perform any act, or fail to perform an act, that would be a violation of or default in the Declaration or any related document. Tenant acknowledges having had the opportunity to read the Declaration and agrees to observe and be bound by all applicable terms.'));
  rows.push(p('<strong>2. Lender changes</strong> &nbsp; Landlord may borrow money from a lender who may request an agreement for changes in this Lease. Tenant shall sign the agreement if it does not change the rent or the Term, and does not alter the ' + unitLabel + '.'));
  rows.push(p('<strong>3. Use</strong> &nbsp; The ' + unitLabel + ' must be used only as a private residence and for no other reason. Only a party signing this Lease and the spouse and children of that party may use the ' + unitLabel + '.'));
  rows.push(p('<strong>4. Rent, added rent</strong> &nbsp; The rent payment for each month must be made on the first day of that month at Landlord&rsquo;s address. Landlord need not give notice to pay the rent. Rent must be paid in full without deduction. The first month&rsquo;s rent is to be paid when Tenant signs this Lease. Tenant may be required to pay other charges to Landlord under the terms of this Lease, called &ldquo;added rent,&rdquo; payable as rent together with the next monthly rent due.'));
  rows.push(p('<strong>5. Failure to give possession</strong> &nbsp; Landlord shall not be liable for failure to give Tenant possession of the ' + unitLabel + ' on the beginning date of the Term. Rent shall be payable as of the beginning of the Term unless Landlord is unable to give possession. The ending date of the Term will not change.'));
  rows.push(p('<strong>6. Security</strong> &nbsp; Tenant has given security to Landlord in the amount of ' + blank(d.deposit) + '. The security has been deposited in the Bank named above and delivery of this Lease is notice of the deposit. If Tenant fully performs all terms of this Lease and leaves the ' + unitLabel + ' in good condition on the last day of the Term, Landlord will return the security being held.'));

  rows.push(clauseBlock('alterations', '7. Alterations', 'Tenant must obtain Landlord&rsquo;s prior written consent to install any panelling, flooring, built-in decorations, partitions, railings or make alterations or to paint or wallpaper the ' + unitLabel + '. Tenant must not change the plumbing, ventilating, air conditioning, electric or heating systems. If consent is given the alterations and installations shall become the property of Landlord when completed and paid for.'));

  rows.push(p('<strong>8. Repairs</strong> &nbsp; Tenant must take good care of the ' + unitLabel + ' and all equipment and fixtures in it. Tenant must, at Tenant&rsquo;s cost, make all repairs and replacements whenever the need results from Tenant&rsquo;s act or neglect. Subject to Tenant&rsquo;s obligations under this Lease, Landlord will require the ' + (isCoop ? 'Building management' : 'Association') + ' (to the extent obligated under the terms of the Declaration or other agreement) to maintain the ' + unitLabel + ', or repair any damage to it, except where caused in whole or in part by Tenant.'));
  rows.push(p('<strong>9. Fire, accident, defects, damage</strong> &nbsp; Tenant must give Landlord prompt notice of fire, accident, damage or dangerous or defective condition. If the ' + unitLabel + ' cannot be used because of fire or other casualty, Tenant is not required to pay rent for the time it is unusable. If part of the ' + unitLabel + ' cannot be used, Tenant must pay rent for the usable part. Landlord is not responsible for delays due to settling insurance claims, obtaining estimates, labor and supply problems or any other cause not fully under Landlord&rsquo;s control.'));
  rows.push(p('<strong>10. Liability</strong> &nbsp; Landlord is not liable for loss, expense, or damage to any person or property, unless due to Landlord&rsquo;s negligence. Landlord is not liable to Tenant if anyone is not permitted or is refused entry into the Building. Tenant must pay for damages suffered and money spent by Landlord relating to any claim arising from any act or neglect of Tenant.'));
  rows.push(p('<strong>11. Entry by Landlord</strong> &nbsp; Landlord or parties authorized by Landlord may enter the ' + unitLabel + ' at reasonable hours to: repair, inspect, exterminate, install or work on systems and cause performance of other work that Landlord decides is necessary. At reasonable hours Landlord may show the ' + unitLabel + ' to possible buyers, lenders or tenants. Landlord&rsquo;s or the ' + (isCoop ? 'Building&rsquo;s' : 'Association&rsquo;s') + ' use of the ' + unitLabel + ' does not give Tenant a claim of eviction.'));
  rows.push(p('<strong>12. Construction or demolition</strong> &nbsp; Construction or demolition may be performed in or near the Building. Even if it interferes with Tenant&rsquo;s ventilation, view or enjoyment of the ' + unitLabel + ' it shall not affect Tenant&rsquo;s obligations in this Lease.'));

  rows.push(clauseBlock('sublet', '13. Assignment and sublease', 'Tenant must not assign this Lease or sublet all or part of the ' + unitLabel + ' or permit any other person to use the ' + unitLabel + '. If Tenant does, Landlord has the right to cancel the Lease. Tenant must get Landlord&rsquo;s written permission each time Tenant wants to assign or sublet.'));

  rows.push(p('<strong>14. Tenant&rsquo;s certificate</strong> &nbsp; Upon request by Landlord, Tenant shall sign a certificate stating: (1) This Lease is in full force and unchanged; (2) Landlord has fully performed all terms of this Lease; (3) Tenant is fully performing all terms and will continue to do so; (4) rent and added rent have been paid to date.'));
  rows.push(p('<strong>15. Condemnation</strong> &nbsp; If all or a part of the Building or ' + unitLabel + ' is taken or condemned by a legal authority, Landlord may, on notice to Tenant, cancel the Term. The entire award for any taking belongs to Landlord. Tenant gives Landlord any interest Tenant may have in any part of the award.'));
  rows.push(p('<strong>16. Tenant&rsquo;s duty to obey laws and regulations</strong> &nbsp; Tenant must, at Tenant&rsquo;s expense, promptly comply with all laws, orders, rules, requests, and directions of all governmental authorities, Landlord&rsquo;s insurers, and the Board of Fire Underwriters. Tenant will not do anything which may increase Landlord&rsquo;s insurance premiums.'));
  rows.push(p('<strong>17. Sale of ' + unitLabel + '</strong> &nbsp; If the Landlord wants to sell the ' + unitLabel + ' Landlord shall have the right to end this Lease by giving 30 days notice to Tenant.'));
  rows.push(p('<strong>18. No liability for property</strong> &nbsp; Neither Landlord, the ' + (isCoop ? 'Corporation' : 'Association') + ' nor Board of ' + (isCoop ? 'Directors' : 'Managers') + ' is liable for (a) loss, theft, misappropriation or damage to personal property, or (b) injury caused by the property or its use.'));
  rows.push(p('<strong>19. Playground, pool, parking and recreation areas</strong> &nbsp; If there is a playground, pool, parking or recreation area, or other common areas, Landlord may give Tenant permission to use it. If Landlord gives permission, Tenant will use the area at Tenant&rsquo;s own risk and must pay all fees Landlord or the ' + (isCoop ? 'Corporation' : 'Association') + ' charges.'));
  rows.push(p('<strong>20. Terraces and balconies</strong> &nbsp; The ' + unitLabel + ' may have a terrace or balcony. The terms of this Lease apply to the terrace or balcony as if part of the ' + unitLabel + '. Tenant must keep the terrace or balcony clean and free from snow, ice, leaves and garbage.'));

  rows.push(clauseBlock('noise', '21. Rules', 'Tenant shall observe and comply with all Rules and Regulations of the ' + (isCoop ? 'Corporation' : 'Association') + ' and Board of ' + (isCoop ? 'Directors' : 'Managers') + '. Tenant shall not make or permit any disturbing noise in the Building or interfere with other occupants or owners.'));

  rows.push(p('<strong>22. Representations, changes in Lease</strong> &nbsp; Tenant has read this Lease. All promises made by the Landlord are in this Lease. There are no others. This Lease may be changed only by an agreement in writing signed by and delivered to each party.'));
  rows.push(p('<strong>23. Landlord unable to perform</strong> &nbsp; If due to labor trouble, government order, lack of supply, Tenant&rsquo;s act or neglect, or any other cause not fully within Landlord&rsquo;s reasonable control, Landlord is delayed or unable to carry out any of Landlord&rsquo;s promises, this Lease shall not be ended or Tenant&rsquo;s obligations affected.'));
  rows.push(p('<strong>24. End of term</strong> &nbsp; At the end of the Term, Tenant must leave the ' + unitLabel + ' clean and in good condition, subject to ordinary wear and tear; remove all of Tenant&rsquo;s property and installations; repair all damages caused by moving; and restore the ' + unitLabel + ' to its condition at the beginning of the Term.'));
  rows.push(p('<strong>25. Space &ldquo;as is&rdquo;</strong> &nbsp; Tenant has inspected the ' + unitLabel + ' and Building. Tenant states they are in good order and repair and takes the ' + unitLabel + ' as is, except for latent defects.'));

  rows.push(clauseBlock('guarantor', '26. Guaranty', 'Any guaranty of this Lease by a Guarantor shall be executed simultaneously with this Lease. The Guarantor unconditionally guarantees the full performance of all of Tenant&rsquo;s obligations under this Lease.'));
  rows.push(clauseBlock('smoking', '27. Smoking Policy', 'Smoking of tobacco or any substance is prohibited in the ' + unitLabel + ', on terraces or balconies, and in all common areas of the Building.'));
  rows.push(clauseBlock('airbnb', '28. No Short-Term Rental', 'Tenant shall not list or offer the ' + unitLabel + ' on Airbnb, VRBO, or any short-term rental platform. Any violation shall constitute an immediate default and grounds for termination of this Lease.'));
  rows.push(clauseBlock('keycard', '29. Keys and Access Devices', 'Tenant acknowledges receipt of _______ key(s) and _______ access card(s). Lost or additional keys and access devices shall be replaced at Tenant&rsquo;s sole expense. All keys and access devices must be returned to Landlord on the last day of the Term.'));
  rows.push(clauseBlock('reno', '30. Renovation Notice', 'Tenant acknowledges that construction or renovation work may be performed in or near the Building or in adjacent units. Such work shall not constitute a constructive eviction or entitle Tenant to any abatement of rent.'));
  rows.push(clauseBlock('hoarder', '31. Excessive Property', 'Tenant shall not accumulate personal property in the ' + unitLabel + ' or Building common areas in such a manner as to create a health, safety, fire, or structural hazard. Landlord shall have the right to require removal of such property upon written notice.'));

  rows.push(p('<strong>32. Limit of recovery</strong> &nbsp; Tenant, for Tenant and all persons claiming under Tenant, shall look solely to the estate or interest of Landlord in the Building for the satisfaction of any right or remedy of Tenant for the collection of a judgment. No other property or assets of Landlord shall be subject to levy, execution or other enforcement procedure for the satisfaction of Tenant&rsquo;s remedies.'));
  rows.push(p('<strong>33. Lease binding on successors</strong> &nbsp; The agreements in this Lease shall bind and benefit the heirs, distributees, executors, administrators, legal representatives, successors, and, except as otherwise provided in the Lease, the assigns of Landlord and Tenant.'));
  rows.push(p('<strong>34. Landlord defined</strong> &nbsp; The word &ldquo;Landlord&rdquo; includes plural and/or feminine as well as singular and masculine. &ldquo;Tenant&rdquo; shall mean the persons who have signed this Lease.'));
  rows.push(p('<strong>35. No waiver, illegality</strong> &nbsp; Landlord&rsquo;s acceptance of rent or failure to enforce any term in this Lease is not a waiver of Landlord&rsquo;s rights. If a term in this Lease is illegal, the rest of this Lease remains in full force.'));
  if (!isCoop) {
    rows.push(p('<strong>36. Common charges and real estate taxes</strong> &nbsp; Tenant shall pay to Landlord, as added rent, all increases in Common Charges and Real Estate Taxes related to the Unit which exceed those charges payable on the date of this Lease.'));
    rows.push(p('<strong>37. No affirmative obligations of Landlord</strong> &nbsp; Landlord is not obligated to provide or render any services whatsoever to Tenant or perform any affirmative obligations under the terms of this Lease. Landlord shall not be liable to Tenant for any act or omission of the Association, Board of Managers, or any other party.'));
    rows.push(p('<strong>38. Voting</strong> &nbsp; This Lease relates solely to the use and occupancy of the Unit. This Lease does not include the transfer or exchange of any voting rights, nor is it to be construed as reducing Landlord&rsquo;s sole right to vote without restriction with respect to any matter related to the Unit.'));
    rows.push(p('<strong>39. Automobiles</strong> &nbsp; The use or storage of Tenant&rsquo;s automobile in or about the Building parking area or garage, if any, shall at all times be at the sole risk of Tenant. Any employee of the Condominium who assists Tenant with parking is considered the agent of Tenant, not Landlord.'));
    rows.push(p('<strong>40. Appliances included in Lease</strong> &nbsp; The Lease includes only personal property itemized on the annexed Personal Property Schedule. No other appliances or items of personal property are included unless specifically identified in writing.'));
  }

  // Signatures
  rows.push(ph('Signatures'));
  rows.push('<p>Landlord and Tenant have signed this Lease as of the above date. It is effective when Landlord delivers to Tenant a copy signed by all parties.</p>');
  rows.push('<table style="width:100%;border-collapse:collapse;margin-top:16px;">');
  rows.push('<tr>');
  rows.push('<td style="width:50%;padding-right:20px;vertical-align:top;">');
  rows.push('<p><strong>LANDLORD:</strong></p>');
  rows.push('<p style="border-bottom:1px solid #333;margin-top:24px;padding-bottom:2px;">' + blank(d.landlord) + '</p>');
  rows.push('<p style="margin-top:4px;font-size:0.8rem;">WITNESS: ________________________________</p>');
  rows.push('</td>');
  rows.push('<td style="width:50%;padding-left:20px;vertical-align:top;">');
  rows.push('<p><strong>TENANT:</strong></p>');
  rows.push('<p style="border-bottom:1px solid #333;margin-top:24px;padding-bottom:2px;">' + blank(d.tenant) + '</p>');
  rows.push('<p style="margin-top:4px;font-size:0.8rem;">WITNESS: ________________________________</p>');
  rows.push('</td>');
  rows.push('</tr>');
  rows.push('</table>');

  // Guaranty
  rows.push(ph('GUARANTY OF PAYMENT'));
  rows.push('<p style="font-size:0.85rem;">I know that the Landlord would not rent the ' + unitLabel + ' to the Tenant unless I guarantee Tenant&rsquo;s performance. I guaranty the full performance of the Lease by the Tenant. This Guaranty is absolute and without any condition. It includes, but is not limited to, the payment of rent and other money charges.</p>');
  rows.push('<table style="width:100%;border-collapse:collapse;margin-top:12px;">');
  rows.push('<tr>');
  rows.push('<td style="width:50%;padding-right:20px;vertical-align:top;font-size:0.85rem;">');
  rows.push('<p><strong>GUARANTOR:</strong> ________________________________</p>');
  rows.push('<p>Guarantor&rsquo;s address: ________________________________</p>');
  rows.push('</td>');
  rows.push('<td style="width:50%;padding-left:20px;vertical-align:top;font-size:0.85rem;">');
  rows.push('<p><strong>Date of Guaranty:</strong> ________________________________</p>');
  rows.push('<p><strong>WITNESS:</strong> ________________________________</p>');
  rows.push('</td>');
  rows.push('</tr>');
  rows.push('</table>');
  rows.push('<p style="font-size:0.78rem;color:#888;margin-top:8px;">*If no broker, insert &ldquo;None.&rdquo;</p>');

  return rows.join('\n');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// REBNY APARTMENT ‚Äî RENT STABILIZED (REBNY Apt. Stab. 2019 Rev 7.19)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildREBNYStab(d) {
  var rows = [];

  rows.push('<div style="text-align:center;margin-bottom:12px;">');
  rows.push('<div style="font-size:0.75rem;color:#888;">REBNY Apt. Stab. 2019 Rev 7.19</div>');
  rows.push('<div style="font-size:0.7rem;color:#aaa;">&copy; Copyright 2019 The Real Estate Board of New York, Inc. All Rights Reserved.</div>');
  rows.push('<div style="font-size:0.8rem;font-weight:600;color:#c0392b;margin-top:6px;">&ldquo;ATTACHED RIDER SETS FORTH RIGHTS AND OBLIGATIONS OF TENANTS AND LANDLORDS UNDER THE RENT STABILIZATION LAW.&rdquo;</div>');
  rows.push('</div>');
  rows.push(ph('STANDARD FORM OF APARTMENT LEASE'));
  rows.push('<p style="text-align:center;font-style:italic;">THE REAL ESTATE BOARD OF NEW YORK, INC.</p>');

  rows.push('<p><strong>PREAMBLE:</strong> This Lease contains the agreements between You and Owner concerning Your rights and obligations and the rights and obligations of Owner. You and Owner have other rights and obligations which are set forth in government laws and regulations. You should read this Lease and all of its attached parts carefully.</p>');

  rows.push('<p>THIS LEASE is made on ' + blank(d.startDate) + ' between Owner, <strong>' + blank(d.landlord) + '</strong>, whose address is ' + blank(d.landlordAddr, 'c/o XL Real Property Management, 80 Fifth Avenue, Suite 1501, New York, NY 10011') + (d.landlordEmail ? '; Email: ' + blank(d.landlordEmail) : '') + ' and You, the Tenant, <strong>' + blank(d.tenant) + '</strong>, whose address is ' + blank(d.tenantCurrentAddr, '________________________________') + (d.tenantEmail ? '; Email: ' + blank(d.tenantEmail) : '') + '.</p>');

  if (d.landlordAtty || d.tenantAtty) {
    rows.push('<p><strong>Landlord&rsquo;s Attorney:</strong> ' + blank(d.landlordAtty, '________________________________') + ' &nbsp;&nbsp; <strong>Tenant&rsquo;s Attorney:</strong> ' + blank(d.tenantAtty, '________________________________') + '</p>');
  }

  rows.push(p('<strong>1. Apartment and Use</strong> &nbsp; Owner agrees to lease to You Apartment ' + blank(d.unit) + ' on the ' + blank(d.floor, '____') + ' floor in the Building at ' + blank(d.address) + ' in the Borough of Manhattan, City and State of New York. You shall use the Apartment for living purposes only. The Apartment may be occupied by the tenant or tenants named above and by the immediate family of the tenant or tenants and by occupants as defined in and only in accordance with Real Property Law &sect;235-f.'));
  rows.push(p('<strong>2. Length of Lease</strong> &nbsp; The term of this Lease is ____years, ____months, beginning on ' + blank(d.startDate) + ' and ending on ' + blank(d.endDate) + '. If you do not do everything You agree to do in this Lease, Owner may have the right to end it before the above date.'));
  rows.push(p('<strong>3. Rent</strong> &nbsp; Your monthly rent for the Apartment is ' + blank(d.rent) + '. You must pay Owner the rent, in advance, on the first day of each month either at Owner&rsquo;s office or at another place that Owner may inform You of by written notice. Owner need not give notice each month to Tenant to pay the rent. Rent must be paid in full and no amount subtracted from it.'));
  rows.push(p('<strong>4. Rent Adjustments</strong> &nbsp; If this Lease is for a Rent Stabilized apartment, the rent shall be adjusted up or down during the Lease term, including retroactively, to conform to the Rent Guidelines. Legal registered rent: ' + blank(d.legalRent, '$________________') + '. Preferential rent (if applicable): ' + blank(d.prefRent, '$________________') + '. DHCR Registration No.: ' + blank(d.dhcrNo, '________________________________') + '. RGB Order/Guidelines: ' + blank(d.rgbOrder, '________________________________') + '. Pursuant to Real Property Law Section 238-a(2), a late fee shall apply if payment of rent has not been received within five days of the first day of each month.'));
  rows.push(p('<strong>5. Security Deposit</strong> &nbsp; You are required to give Owner the sum of ' + blank(d.deposit) + ' (not to exceed one month&rsquo;s rent pursuant to The Housing Stability and Tenant Protection Act of 2019) when You sign this Lease as a security deposit. Owner will deposit this security at __________________________________ bank at ____________________________________. If You carry out all of your agreements in this Lease and move out returning the Apartment in the same condition, except for ordinary wear and tear, Owner will return to You the full amount of the Security Deposit and interest where applicable, within fourteen (14) days after the later of (i) the date this Lease ends, or (ii) the date You vacate the Apartment.'));
  rows.push(p('<strong>6. If You Are Unable to Move In</strong> &nbsp; A situation could arise which might prevent Owner from letting You move into the Apartment on the beginning date set in this Lease. If this happens for reasons beyond Owner&rsquo;s reasonable control, Owner will not be responsible for Your damages or expenses and this Lease will remain in effect. However, in such case, this Lease will start on the date when You can move in. You will not have to pay rent until the move-in date Owner gives You by written notice, or the date You move in, whichever is earlier.'));
  rows.push(p('<strong>7. Captions</strong> &nbsp; In any dispute arising under this Lease, in the event of a conflict between the text and a caption, the text controls.'));
  rows.push(p('<strong>8. Warranty of Habitability</strong> &nbsp; All of the sections of this Lease are subject to the provisions of the Warranty of Habitability Law. Owner agrees that the Apartment and the Building are fit for human habitation and that there will be no conditions which will be detrimental to life, health or safety.'));

  rows.push(clauseBlock('alterations', '9 & 10. Care of Apartment; Changes and Alterations', 'Tenant will take good care of the Apartment and will not permit or do any damage to it, except for damage which occurs through ordinary wear and tear. Tenant cannot build in, add to, change or alter the Apartment in any way without first obtaining the prior written consent of Owner, which may be withheld in Owner&rsquo;s sole discretion. If Owner&rsquo;s consent is given, the alterations and installations shall become the property of Owner when completed and paid for by Tenant.'));

  rows.push(p('<strong>11. Your Duty to Obey and Comply with Laws</strong> &nbsp; You will obey and comply (1) with all present and future city, state and federal laws and regulations, including the Rent Stabilization Code and Law, which affect the Building or the Apartment, and (2) with all orders and regulations of Insurance Rating Organizations which affect the Apartment and the Building.'));
  rows.push(p('<strong>12. Objectionable Conduct</strong> &nbsp; As a tenant in the Building, You will not engage in nor permit family members, guests or invitees to engage in objectionable conduct. Objectionable conduct means behavior which makes or will make the Apartment or the Building less fit to live in for You or other occupants. It also means anything which interferes with the right of others to properly and peacefully enjoy their Apartments, or causes conditions that are dangerous, hazardous, unsanitary and detrimental to other tenants in the Building. Objectionable conduct by You gives Owner the right to end this Lease.'));
  rows.push(p('<strong>13. Services and Facilities</strong> &nbsp; Owner will provide cold and hot water and heat as required by law, repairs to the Apartment as required by law, elevator service if the Building has elevator equipment, and the utilities, if any, included in the rent. The following utilities are included in the rent: ________________________________. You are not entitled to any rent reduction because of a stoppage or reduction of any of the above services unless it is provided by law.'));
  rows.push(p('<strong>14. Inability to Provide Services</strong> &nbsp; Because of a strike, labor trouble, national emergency, repairs, or any other cause beyond Owner&rsquo;s reasonable control, Owner may not be able to provide or may be delayed in providing any services or in making any repairs to the Building. In any of these events, any rights You may have against Owner are only those rights which are allowed by law.'));
  rows.push(p('<strong>15. Entry to Apartment</strong> &nbsp; During reasonable hours and with reasonable notice, except in emergencies, Owner may enter the Apartment to: (a) erect, use and maintain pipes and conduits in and through the walls and ceilings; (b) inspect and make any necessary repairs or changes; (c) show the Apartment to persons who may wish to become owners or lessees of the entire Building; and (d) for four months before the end of the Lease, show the Apartment to persons who wish to rent it.'));

  rows.push(clauseBlock('sublet', '16. Assigning, Subletting, Abandonment', 'You cannot assign this Lease or sublet the Apartment without Owner&rsquo;s advance written consent in each instance, in the manner required by Real Property Law &sect;226-b and in accordance with the provisions of the Rent Stabilization Code and Law. Owner may refuse to consent to a lease assignment for any reason or no reason, but if Owner unreasonably refuses to consent to a request for a Lease assignment properly made, Owner will end this Lease effective as of thirty days after Your request.'));

  rows.push(p('<strong>17. Default</strong> &nbsp; You default under the Lease if You: (A) fail to carry out any agreement or provision of this Lease other than Article 12; (B) do not take possession or move into the Apartment 15 days after the beginning of this Lease; or (C) You and other legal occupants of the Apartment move out permanently before this Lease ends. If You default (other than failure to pay rent), Owner may serve You with a written notice to stop or correct the specified default within ten days.'));
  rows.push(p('<strong>18. Remedies of Owner and Your Liability</strong> &nbsp; If this Lease is ended by Owner because of Your default, You must pay Your rent until this Lease has ended. Thereafter, You must pay an equal amount for use and occupancy until You actually move out. You must also pay Owner: (1) the difference between the rent in this Lease and the amount, if any, of rents collected in any later lease for the remaining period; (2) Owner&rsquo;s expenses for advertisements, broker&rsquo;s fees and the cost of putting the Apartment in good condition for re-rental; and (3) Owner&rsquo;s reasonable attorney&rsquo;s fees.'));
  rows.push(p('<strong>19. Additional Owner Remedies</strong> &nbsp; If You do not do everything You have agreed to do, or if You do anything which shows that You intend not to do what You have agreed to do, Owner has the right to ask a court to make You carry out Your agreement or to give the Owner such other relief as the Court can provide.'));
  rows.push(p('<strong>20. Fees and Expenses</strong> &nbsp; You must reimburse Owner for any fees and expenses incurred by Owner in: (1) making any repairs to the Apartment or the Building which result from misuse, omissions or negligence by Tenant or the Tenant Parties; (2) correcting any violations of laws or orders caused by Tenant; or (3) bringing any legal proceedings against Tenant.'));
  rows.push(p('<strong>21. Jury Trial Waiver</strong> &nbsp; Owner and Tenant each waive the right to a jury trial in any action or proceeding between Owner and Tenant relating to this Lease, the Apartment, the Building or the relationship of landlord and tenant.'));
  rows.push(p('<strong>22. No Waiver</strong> &nbsp; Owner&rsquo;s acceptance of rent or failure to enforce any term in this Lease is not a waiver of Owner&rsquo;s rights. If a term in this Lease is illegal, the rest of this Lease remains in full force.'));
  rows.push(p('<strong>23. Subordination</strong> &nbsp; This Lease and Tenant&rsquo;s rights are subject and subordinate to all present and future leases for the Building, mortgages on the Building, and agreements securing money paid or to be paid by a lender.'));
  rows.push(p('<strong>24. Condemnation</strong> &nbsp; If all of the Apartment or Building is taken or condemned by a legal authority, the Term and Tenant&rsquo;s rights shall end as of the date the authority takes title. If any part of the Apartment or Building is taken, Owner may cancel this Lease on notice to Tenant.'));
  rows.push(p('<strong>25. Caretaking of Building</strong> &nbsp; If Owner is unable to obtain heat, water, elevator service or any other service by reason of a strike, labor trouble, national emergency, or any other cause beyond Owner&rsquo;s reasonable control, this will not be a violation of this Lease by Owner.'));

  rows.push(clauseBlock('noise', '26. Noise and Rules', 'Tenant must comply with the building Rules. Tenant shall not make or permit any disturbing noise in the Building or interfere with occupants of other Apartments. Notice of Rules will be given to Tenant. Landlord, the Association or Board of Managers need not enforce Rules against other tenants.'));
  rows.push(clauseBlock('smoking', '27. Smoking Policy', 'Pursuant to NYC Administrative Code &sect;17-503, smoking of tobacco or any substance is prohibited in the Apartment, on terraces or balconies, and in all common areas of the Building including hallways, stairwells, lobbies, and laundry rooms.'));
  rows.push(clauseBlock('airbnb', '28. No Short-Term Rental', 'Tenant shall not list or offer the Apartment on Airbnb, VRBO, or any short-term rental platform. Any violation shall constitute a material default and immediate grounds for termination of this Lease and may subject Tenant to penalties under applicable law.'));
  rows.push(clauseBlock('keycard', '29. Keys and Access Devices', 'Tenant acknowledges receipt of _______ key(s) and _______ access card(s). Lost or additional keys and access devices shall be replaced at Tenant&rsquo;s sole expense. All keys and access devices must be returned to Owner on the last day of the Term.'));
  rows.push(clauseBlock('concierge', '30. Concierge and Building Procedures', 'Tenant and all occupants shall comply with all building concierge, delivery, visitor, and move-in/move-out procedures established by Owner or building management, as may be amended from time to time upon reasonable written notice to Tenant.'));
  rows.push(clauseBlock('reno', '31. Renovation Notice', 'Tenant acknowledges that construction or renovation work may be performed in the Building or in adjacent units. Such work shall not constitute a constructive eviction or entitle Tenant to any abatement of rent.'));
  rows.push(clauseBlock('hoarder', '32. Excessive Property', 'Tenant shall not accumulate personal property in the Apartment or Building common areas in such a manner as to create a health, safety, fire, or structural hazard. Owner shall have the right to require removal of such property upon written notice.'));
  rows.push(clauseBlock('earlyterm', '33. Early Termination', 'Tenant may terminate this Lease prior to the expiration of the Term upon not less than sixty (60) days&rsquo; prior written notice to Owner and payment of an early termination fee equal to two (2) months&rsquo; rent, which shall be deemed liquidated damages and not a penalty.'));
  rows.push(clauseBlock('guarantor', '34. Guaranty', 'Any guaranty of this Lease by a Guarantor shall be executed simultaneously with this Lease. The Guarantor unconditionally guarantees the full performance of all of Tenant&rsquo;s obligations under this Lease, including the payment of all rent and additional rent.'));

  rows.push(p('<strong>35. Holdover</strong> &nbsp; If Tenant holds over after the expiration of the Term without Owner&rsquo;s written consent, Tenant shall be liable for use and occupancy at the rate of 150% of the monthly rent in effect at the expiration of the Term and Owner may treat Tenant as a month-to-month tenant subject to all terms of this Lease.'));
  rows.push(p('<strong>36. Representations and Changes</strong> &nbsp; Tenant has read this Lease. All promises made by the Owner are in this Lease. There are no others. This Lease may be changed only by an agreement in writing signed by and delivered to each party.'));
  rows.push(p('<strong>37. Definitions</strong> &nbsp; &ldquo;Owner&rdquo; and &ldquo;Landlord&rdquo; are used interchangeably herein. &ldquo;You&rdquo; and &ldquo;Tenant&rdquo; refer to all persons who have signed this Lease. &ldquo;Lease&rdquo; includes this document and all attached riders.'));

  // Signature block
  rows.push(ph('Signatures'));
  rows.push('<p>Owner and Tenant have signed this Lease as of the date written above.</p>');
  rows.push('<table style="width:100%;border-collapse:collapse;margin-top:16px;">');
  rows.push('<tr>');
  rows.push('<td style="width:50%;padding-right:20px;vertical-align:top;">');
  rows.push('<p><strong>OWNER:</strong></p>');
  rows.push('<p style="border-bottom:1px solid #333;margin-top:24px;padding-bottom:2px;">' + blank(d.landlord) + '</p>');
  rows.push('<p style="margin-top:4px;font-size:0.8rem;">Address: ' + blank(d.landlordAddr, 'c/o XL Real Property Management, 80 Fifth Avenue, Suite 1501, New York, NY 10011') + (d.landlordEmail ? '<br>Email: ' + blank(d.landlordEmail) : '') + '</p>');
  rows.push('</td>');
  rows.push('<td style="width:50%;padding-left:20px;vertical-align:top;">');
  rows.push('<p><strong>TENANT:</strong></p>');
  rows.push('<p style="border-bottom:1px solid #333;margin-top:24px;padding-bottom:2px;">' + blank(d.tenant) + '</p>');
  rows.push('<p style="margin-top:4px;font-size:0.8rem;">Address: ' + blank(d.address) + ', ' + blank(d.unit) + '</p>');
  rows.push('</td>');
  rows.push('</tr>');
  rows.push('</table>');

  return rows.join('\n');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// REBNY TOWNHOUSE ‚Äî Single Family/Townhouse Lease (REBNY Townhouse 2019)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildREBNYTownhouse(d) {
  var rows = [];

  rows.push('<div style="text-align:center;margin-bottom:12px;">');
  rows.push('<div style="font-size:0.75rem;color:#888;">REBNY Townhouse 2019 Rev 7.19</div>');
  rows.push('<div style="font-size:0.7rem;color:#aaa;">&copy; Copyright 2019 The Real Estate Board of New York, Inc. All Rights Reserved.</div>');
  rows.push('</div>');
  rows.push(ph('STANDARD FORM OF SINGLE FAMILY/TOWNHOUSE LEASE'));
  rows.push('<p style="text-align:center;font-style:italic;">THE REAL ESTATE BOARD OF NEW YORK, INC.</p>');

  rows.push('<p><strong>PREAMBLE:</strong> This Lease contains the agreements between Tenant and Owner concerning the rights and obligations of each party. Tenant and Owner have other rights and obligations which are set forth in government laws and regulations. Tenant should read this Lease carefully.</p>');

  rows.push('<p>THIS LEASE is made as of ' + blank(d.startDate) + ' between Owner <strong>' + blank(d.landlord) + '</strong>, whose address is ' + blank(d.landlordAddr, 'c/o XL Real Property Management, 80 Fifth Avenue, Suite 1501, New York, NY 10011') + (d.landlordEmail ? '; Email: ' + blank(d.landlordEmail) : '') + ' and Tenant <strong>' + blank(d.tenant) + '</strong>, whose address is ' + blank(d.tenantCurrentAddr, '________________________________') + (d.tenantEmail ? '; Email: ' + blank(d.tenantEmail) : '') + '.</p>');

  if (d.landlordAtty || d.tenantAtty) {
    rows.push('<p><strong>Landlord&rsquo;s Attorney:</strong> ' + blank(d.landlordAtty, '________________________________') + (d.landlordAttyAddr ? ', ' + blank(d.landlordAttyAddr) : '') + '<br>');
    rows.push('<strong>Tenant&rsquo;s Attorney:</strong> ' + blank(d.tenantAtty, '________________________________') + (d.tenantAttyAddr ? ', ' + blank(d.tenantAttyAddr) : '') + '</p>');
  }

  rows.push('<p><em>Please note the following paragraphs that require a selection among alternative wording: 2, 3E, 34. Please note the following paragraphs that require the insertion of terms: 1, 2, 3A, 3B, 4, 12, 25, 32, 34, 35, 38, Exhibit A, Exhibit B, Exhibit C.</em></p>');

  rows.push(p('<strong>1. Premises and Use</strong> &nbsp; Owner agrees to lease to Tenant the premises located at ' + blank(d.address) + ' (the &ldquo;Premises&rdquo;), in the State of New York. Tenant shall use the Premises for living purposes only and for no other purpose. The Premises may only be occupied by Tenant and the following Permitted Occupants: ________________________________. Tenant acknowledges that no other person may reside in the Premises without the prior written consent of Owner.'));
  rows.push(p('<strong>2. Lease Commencement Date; Length of Lease</strong> &nbsp; The &ldquo;Lease Commencement Date&rdquo; is ' + blank(d.startDate) + '. The term of this Lease will begin on the Lease Commencement Date and will end on ' + blank(d.endDate) + ' (the &ldquo;Term&rdquo;).'));
  rows.push(p('<strong>3. Rent</strong> &nbsp; Tenant&rsquo;s monthly rent for the Premises is ' + blank(d.rent) + ' per month. Tenant must pay Owner the Rent, in equal monthly installments, on the first day of each month. When Tenant signs this Lease, Tenant must pay by bank or cashier&rsquo;s check (i) one (1) month&rsquo;s Rent (' + blank(d.rent) + '); (ii) the Security Deposit; and (iii) any commission due to the Brokers. Tenant shall be entitled to a five (5) day grace period for the payment of any sum of Rent or Additional Rent. Any sum not paid within five (5) days shall be subject to a late fee of the lesser of $50.00 or five percent (5%) of the unpaid amount.'));
  rows.push(p('<strong>4. Security Deposit</strong> &nbsp; Tenant is required to give Owner the sum of ' + blank(d.deposit) + ' (not to exceed one month&rsquo;s Rent pursuant to The Housing Stability and Tenant Protection Act of 2019) when Tenant signs this Lease as a security deposit. If Tenant carries out all of Tenant&rsquo;s agreements in this Lease and moves out of the Premises returning it to Owner vacant, broom clean and in the same condition, except for ordinary wear and tear, Owner will return to Tenant the full amount of the Security Deposit within fourteen (14) days after the later of (i) the date this Lease ends, or (ii) the date Tenant vacates the Premises.'));
  rows.push(p('<strong>5. If Tenant Is Unable to Move In</strong> &nbsp; Except as otherwise provided herein, Owner shall not be liable for failure to give Tenant possession of the Premises on the Lease Commencement Date. If this happens for reasons beyond Owner&rsquo;s reasonable control, Owner will not be responsible for Tenant&rsquo;s damages or expenses and this Lease will remain in effect. If Owner does not give Tenant notice that possession is available within thirty (30) days after the Lease Commencement Date, Tenant may send a fifteen (15) day written Termination Notice to Owner.'));
  rows.push(p('<strong>6. Captions</strong> &nbsp; In any dispute arising under this Lease, in the event of a conflict between the text and a caption, the text controls.'));
  rows.push(p('<strong>7. Warranty of Habitability</strong> &nbsp; All of the sections of this Lease are subject to the provisions of the Warranty of Habitability Law. Owner agrees that the Premises are fit for human habitation and that there will be no conditions which will be detrimental to life, health or safety.'));

  rows.push(clauseBlock('alterations', '8 & 9. Care of Premises; Changes and Alterations', 'Tenant will take good care of the Premises and will not permit or do any damage to it, except for damage which occurs through ordinary wear and tear. Tenant cannot build in, add to, change or alter, the Premises in any way without first obtaining the prior written consent of Owner which may be withheld in Owner&rsquo;s sole discretion. If Owner&rsquo;s consent is given, the alterations and installations shall become the property of Owner when completed and paid for by Tenant.'));

  rows.push(p('<strong>10. Tenant&rsquo;s Duty to Obey and Comply with Laws</strong> &nbsp; Tenant will obey and comply with all present and future city, state and federal laws, rules, regulations and codes of any governmental or quasi-governmental entity or body which affect the Premises, and with all orders and regulations of insurance rating organizations which affect the Premises.'));
  rows.push(p('<strong>11. Objectionable Conduct</strong> &nbsp; Tenant, the Permitted Occupants, and any other people visiting the Premises will not engage in objectionable conduct at the Premises. Objectionable Conduct means behavior which makes or will make the Premises less fit to live in for Tenant or other occupants, or causes conditions that are dangerous, hazardous, unsanitary and detrimental to occupants of the Premises. Objectionable Conduct may be treated as a default under this Lease and gives Owner the right to end this Lease on six (6) days written notice.'));
  rows.push(p('<strong>12. Services and Facilities</strong> &nbsp; Owner will provide (i) cold and hot water and heat, as required by law; (ii) repairs to the Premises not caused by Tenant; and (iii) the utilities, if any, included in the Rent. The following utilities are included in the Rent: ________________________________. Tenant shall be responsible, at Tenant&rsquo;s sole cost and expense, for securing air conditioning, electricity, gas, cable, phone, snow removal, exterminating and all other utilities and services (including landscaping services). Tenant acknowledges and agrees that Tenant will, at Tenant&rsquo;s own cost and expense, remove all ice and snow from the sidewalk and driveway of the Premises.'));
  rows.push(p('<strong>13. Inability to Provide Services</strong> &nbsp; Because of a strike, labor trouble, national emergency, repairs, or any other cause beyond Owner&rsquo;s reasonable control, Owner may not be able to provide or may be delayed in providing any services or in making any repairs to the Premises. In any of these events, any rights Tenant may have against Owner are only those rights which are allowed by laws in effect when the reduction in service occurs.'));
  rows.push(p('<strong>14. Entry to Premises</strong> &nbsp; During reasonable hours and with reasonable notice, except in emergencies, Owner, Owner&rsquo;s representatives, agents or employees may enter the Premises to: inspect; exterminate; install or work on master antennas or other systems; and perform other work and make any and all repairs, alterations or changes Owner decides are necessary. For ninety (90) days before the end of the Lease Term, Owner may show the Premises to persons who wish to lease it.'));

  rows.push(clauseBlock('sublet', '15. Assigning; Subletting; Abandonment', 'Tenant cannot assign this Lease or sublet the Premises or any part thereof without Owner&rsquo;s advance written consent in each instance. If You move out of the Premises (abandonment) before the end of this Lease without the consent of Owner, this Lease will not be ended. You will remain responsible for each monthly payment of rent as it becomes due until the end of this Lease, subject to Real Property Law &sect;227-e.'));

  rows.push(p('<strong>16. Insurance</strong> &nbsp; Tenant shall, at Tenant&rsquo;s sole cost and expense, obtain and maintain throughout the Term: (a) commercial general liability insurance with limits of not less than $1,000,000 per occurrence and $2,000,000 in the aggregate; (b) renter&rsquo;s property insurance covering Tenant&rsquo;s personal property for its full replacement value; and (c) such other insurance as Owner may reasonably require. All policies shall name Owner as an additional insured. Tenant shall deliver copies of all policies or certificates of insurance to Owner prior to taking possession.'));
  rows.push(p('<strong>17. Default</strong> &nbsp; Tenant defaults under the Lease if Tenant: (A) fails to carry out any agreement or provision of this Lease; (B) does not take possession or move into the Premises 15 days after the beginning of this Lease; (C) Tenant and all occupants move out permanently before this Lease ends; or (D) engages in Objectionable Conduct. If Tenant defaults (other than failure to pay rent), Owner may serve Tenant with a written notice to stop or correct the specified default within ten (10) days.'));
  rows.push(p('<strong>18. Remedies of Owner and Tenant&rsquo;s Liability</strong> &nbsp; If this Lease is ended by Owner because of Tenant&rsquo;s default, Tenant must pay Tenant&rsquo;s rent until this Lease has ended. Thereafter, Tenant must pay an equal amount for use and occupancy until Tenant actually moves out. Tenant must also pay Owner: (1) the difference between the rent in this Lease and the amount, if any, of rents collected in any later lease; (2) Owner&rsquo;s expenses for advertisements, broker&rsquo;s fees and the cost of putting the Premises in good condition for re-rental; and (3) Owner&rsquo;s reasonable attorney&rsquo;s fees.'));
  rows.push(p('<strong>19. Additional Owner Remedies</strong> &nbsp; If Tenant does not do everything Tenant has agreed to do, Owner has the right to ask a court to make Tenant carry out Tenant&rsquo;s agreement or to give Owner such other relief as the Court can provide. This is in addition to the remedies in Articles 17 and 18.'));
  rows.push(p('<strong>20. Fees and Expenses</strong> &nbsp; Tenant must reimburse Owner for any fees and expenses incurred by Owner in making repairs to the Premises or the Building which result from misuse, omissions or negligence by Tenant or the Tenant Parties, or correcting any violations of laws caused by Tenant, or bringing any legal proceedings against Tenant.'));
  rows.push(p('<strong>21. Jury Trial Waiver</strong> &nbsp; Owner and Tenant each waive the right to a jury trial in any action or proceeding between Owner and Tenant relating to this Lease or the Premises.'));
  rows.push(p('<strong>22. No Waiver</strong> &nbsp; Owner&rsquo;s acceptance of rent or failure to enforce any term in this Lease is not a waiver of Owner&rsquo;s rights. If a term in this Lease is illegal, the rest of this Lease remains in full force.'));
  rows.push(p('<strong>23. Subordination</strong> &nbsp; This Lease and Tenant&rsquo;s rights are subject and subordinate to all present and future mortgages on the Premises, and agreements securing money paid or to be paid by a lender.'));
  rows.push(p('<strong>24. Condemnation</strong> &nbsp; If all of the Premises is taken or condemned by a legal authority, the Term and Tenant&rsquo;s rights shall end as of the date the authority takes title. If any part of the Premises is taken, Owner may cancel this Lease on notice to Tenant.'));

  rows.push(clauseBlock('smoking', '25. Smoking Policy', 'Smoking of tobacco or any substance is prohibited inside the Premises and on any terrace, balcony, or outdoor area that is part of the Premises.'));
  rows.push(clauseBlock('airbnb', '26. No Short-Term Rental', 'Tenant shall not list or offer the Premises on Airbnb, VRBO, or any short-term rental platform. Any violation shall constitute an immediate default and grounds for termination of this Lease.'));
  rows.push(clauseBlock('keycard', '27. Keys and Access', 'Tenant acknowledges receipt of _______ key(s). Lost or additional keys shall be replaced at Tenant&rsquo;s sole expense. All keys must be returned to Owner on the last day of the Term.'));
  rows.push(clauseBlock('storage', '28. Storage', 'Any storage space provided to Tenant by Owner is furnished as a revocable license only, without any warranty or representation. Owner may revoke such license upon thirty (30) days written notice.'));
  rows.push(clauseBlock('reno', '29. Renovation Notice', 'Tenant acknowledges that construction or renovation work may be performed in or near the Premises or adjacent properties. Such work shall not constitute a constructive eviction or entitle Tenant to any abatement of rent.'));
  rows.push(clauseBlock('hoarder', '30. Excessive Property', 'Tenant shall not accumulate personal property in the Premises in such a manner as to create a health, safety, fire, or structural hazard. Owner shall have the right to require removal of such property upon written notice.'));
  rows.push(clauseBlock('noise', '31. Noise and Nuisance', 'Tenant shall not make or permit any disturbing noise in or around the Premises or interfere with the peaceful enjoyment of neighboring properties. Tenant shall comply with all applicable noise ordinances and regulations.'));
  rows.push(clauseBlock('earlyterm', '32. Early Termination', 'Tenant may terminate this Lease prior to the expiration of the Term upon not less than sixty (60) days&rsquo; prior written notice to Owner and payment of an early termination fee equal to two (2) months&rsquo; Rent, which shall be deemed liquidated damages and not a penalty.'));
  rows.push(clauseBlock('guarantor', '33. Guaranty', 'Any guaranty of this Lease by a Guarantor shall be executed simultaneously with this Lease. The Guarantor unconditionally guarantees the full performance of all of Tenant&rsquo;s obligations under this Lease.'));
  rows.push(buildRenewalArticle(d, '34', 'Tenant'));

  rows.push(p('<strong>35. Holdover</strong> &nbsp; If Tenant holds over after the expiration of the Term without Owner&rsquo;s written consent, Tenant shall pay Owner 150% of the monthly Rent in effect at the expiration of the Term for each month or part thereof of such holdover. Such holdover shall be on a month-to-month basis, terminable on 30 days&rsquo; notice, and subject to all terms of this Lease.'));
  rows.push(p('<strong>36. Broker</strong> &nbsp; Tenant represents that Tenant has not dealt with any real estate broker in connection with this Lease except: ' + blank(d.broker, '________________________________') + '. Tenant shall indemnify Owner against any claims arising from any breach of this representation.'));
  rows.push(p('<strong>37. Representations</strong> &nbsp; Tenant has read this Lease. All promises made by the Owner are in this Lease. There are no others. This Lease may be changed only by an agreement in writing signed by and delivered to each party.'));
  rows.push(p('<strong>38. Exhibit A &mdash; Memorandum Confirming Term</strong> &nbsp; Within five (5) business days after request of Owner, Tenant shall return the Memorandum Confirming Term attached hereto as Exhibit A, confirming the Lease Commencement Date, the Rent Commencement Date (if different), the Lease expiration date, and certifying that Tenant has accepted delivery of the Premises.'));
  rows.push(p('<strong>39. Exhibit B &mdash; Owner&rsquo;s Work</strong> &nbsp; Owner shall complete the work described in Exhibit B attached hereto prior to the Lease Commencement Date. All such work shall be performed in a good and workmanlike manner.'));
  rows.push(p('<strong>40. Exhibit C &mdash; Premises Furniture</strong> &nbsp; ' + (d.furnished ? 'The Premises is leased in its furnished condition. A complete inventory of the Furniture is set forth in Exhibit C attached hereto and made a part of this Lease. See Furnished Apartment Rider for additional terms.' : 'The Premises is leased unfurnished. No furniture, furnishings or personal property of Owner is included in this Lease unless specifically set forth in Exhibit C attached hereto.')));

  // Signature block
  rows.push(ph('Signatures'));
  rows.push('<p>Owner and Tenant have signed this Lease as of the date written above. This Lease is effective when Owner delivers to Tenant a copy signed by all parties.</p>');
  rows.push('<table style="width:100%;border-collapse:collapse;margin-top:16px;">');
  rows.push('<tr>');
  rows.push('<td style="width:50%;padding-right:20px;vertical-align:top;">');
  rows.push('<p><strong>OWNER:</strong></p>');
  rows.push('<p style="border-bottom:1px solid #333;margin-top:24px;padding-bottom:2px;">' + blank(d.landlord) + '</p>');
  rows.push('<p style="margin-top:4px;font-size:0.8rem;">Address: ' + blank(d.landlordAddr, 'c/o XL Real Property Management, 80 Fifth Avenue, Suite 1501, New York, NY 10011') + (d.landlordEmail ? '<br>Email: ' + blank(d.landlordEmail) : '') + '</p>');
  if (d.landlordAtty) rows.push('<p style="margin-top:8px;font-size:0.8rem;">Attorney: ' + blank(d.landlordAtty) + '</p>');
  rows.push('</td>');
  rows.push('<td style="width:50%;padding-left:20px;vertical-align:top;">');
  rows.push('<p><strong>TENANT:</strong></p>');
  rows.push('<p style="border-bottom:1px solid #333;margin-top:24px;padding-bottom:2px;">' + blank(d.tenant) + '</p>');
  rows.push('<p style="margin-top:4px;font-size:0.8rem;">Address: ' + blank(d.address) + '</p>');
  if (d.tenantAtty) rows.push('<p style="margin-top:8px;font-size:0.8rem;">Attorney: ' + blank(d.tenantAtty) + '</p>');
  rows.push('</td>');
  rows.push('</tr>');
  rows.push('</table>');

  // Guaranty
  rows.push(ph('GUARANTY OF PAYMENT'));
  rows.push('<p style="font-size:0.85rem;">I know that the Owner would not rent the Premises to the Tenant unless I guarantee Tenant&rsquo;s performance. I guaranty the full performance of the Lease by the Tenant. This Guaranty is absolute and without any condition. It includes, but is not limited to, the payment of rent and other money charges.</p>');
  rows.push('<table style="width:100%;border-collapse:collapse;margin-top:12px;">');
  rows.push('<tr>');
  rows.push('<td style="width:50%;padding-right:20px;vertical-align:top;font-size:0.85rem;">');
  rows.push('<p><strong>GUARANTOR:</strong> ________________________________</p>');
  rows.push('<p>Guarantor&rsquo;s address: ________________________________</p>');
  rows.push('</td>');
  rows.push('<td style="width:50%;padding-left:20px;vertical-align:top;font-size:0.85rem;">');
  rows.push('<p><strong>Date of Guaranty:</strong> ________________________________</p>');
  rows.push('<p><strong>WITNESS:</strong> ________________________________</p>');
  rows.push('</td>');
  rows.push('</tr>');
  rows.push('</table>');

  return rows.join('\n');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// COMMERCIAL / OFFICE PLACEHOLDER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildCommercialPlaceholder(d) {
  var pt = PROPERTY_LABELS[state.propertyType];
  var rows = [];
  rows.push(ph(pt.toUpperCase() + ' LEASE AGREEMENT'));
  rows.push('<div style="border:2px dashed var(--gold);border-radius:8px;padding:24px;margin:24px 0;text-align:center;">');
  rows.push('<div style="font-size:1.1rem;font-weight:600;color:var(--gold);margin-bottom:8px;">Commercial Form ‚Äî Coming Soon</div>');
  rows.push('<p style="color:var(--text-muted);">The ' + pt + ' lease template has not yet been configured. Once you provide the commercial lease form template, it will be built into this step.</p>');
  rows.push('<p style="margin-top:12px;font-size:0.85rem;color:var(--text-muted);">Parties: ' + blank(d.landlord) + ' (Landlord) &amp; ' + blank(d.tenant) + ' (Tenant)<br>Premises: ' + blank(d.address) + ' &mdash; Term: ' + blank(d.startDate) + ' to ' + blank(d.endDate) + '</p>');
  rows.push('</div>');
  return rows.join('\n');
}


function buildBlumbergA55Direct(d) {
  var yr = '';
  if (d.rent) {
    var rentNum = parseFloat(d.rent.replace(/[^0-9.]/g, ''));
    if (!isNaN(rentNum)) yr = '$' + (rentNum * 12).toLocaleString();
  }

  var rows = [];

  rows.push('<div style="text-align:center;margin-bottom:18px;">');
  rows.push('<div style="font-size:0.75rem;color:#888;margin-bottom:4px;">A 55 &mdash; Apartment lease, comprehensive form, rules, guaranty, plain English format</div>');
  rows.push('<div style="font-size:0.7rem;color:#aaa;">&copy; BlumbergExcelsior, Inc. | PREPARED BY ARNOLD MANDELL, L.L.B.</div>');
  rows.push('</div>');

  rows.push(ph('LEASE AGREEMENT'));
  rows.push('<p style="text-align:center;font-style:italic;">The Landlord and Tenant agree to lease the Apartment for the Term and at the Rent stated on these terms:</p>');

  // Header table
  rows.push('<table style="width:100%;border-collapse:collapse;margin:16px 0;font-size:0.88rem;border:1px solid #ccc;">');
  rows.push('<tr>');
  rows.push('<td style="padding:8px;border:1px solid #ccc;width:50%;vertical-align:top;">');
  rows.push('<strong>LANDLORD:</strong><br>' + blank(d.landlord) + '<br><br>');
  rows.push('Address for Notices: ' + blank(d.landlordAddr, 'c/o XL Real Property Management, 80 Fifth Avenue, Suite 1501, New York, NY 10011') + (d.landlordEmail ? '<br>Email: ' + blank(d.landlordEmail) : '') + '<br><br>');
  rows.push('Apartment: ' + blank(d.unit) + ' at ' + blank(d.address) + '<br>');
  rows.push('Bank: ' + blank(d.bank, '________________________________'));
  rows.push('</td>');
  rows.push('<td style="padding:8px;border:1px solid #ccc;width:50%;vertical-align:top;">');
  rows.push('<strong>TENANT:</strong><br>' + blank(d.tenant));
  rows.push('</td>');
  rows.push('</tr>');
  rows.push('<tr><td colspan="2" style="padding:0;border:1px solid #ccc;">');
  rows.push('<table style="width:100%;border-collapse:collapse;">');
  rows.push('<tr>');
  rows.push('<td style="padding:8px;border-right:1px solid #ccc;width:40%;vertical-align:top;">');
  rows.push('<strong>Lease date:</strong> ' + blank(d.startDate) + '<br><br>');
  rows.push('<strong>Term</strong> beginning ' + blank(d.startDate) + '<br>');
  rows.push('&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ending ' + blank(d.endDate));
  rows.push('</td>');
  rows.push('<td style="padding:8px;vertical-align:top;">');
  rows.push('<strong>Yearly Rent</strong> &nbsp;' + blank(yr) + '<br>');
  rows.push('<strong>Monthly Rent</strong> ' + blank(d.rent) + '<br>');
  rows.push('<strong>Security</strong> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' + blank(d.deposit));
  rows.push('</td>');
  rows.push('</tr>');
  rows.push('<tr><td colspan="2" style="padding:6px 8px;border-top:1px solid #ccc;">');
  rows.push('<strong>Broker*</strong> ' + blank(d.broker));
  rows.push('</td></tr>');
  rows.push('</table>');
  rows.push('</td></tr>');
  rows.push('</table>');

  rows.push('<p style="font-size:0.82rem;color:#555;margin-bottom:16px;"><strong>Rider</strong> &nbsp; Additional terms on _______ page(s) initialed at the end by the parties is attached and made a part of this Lease.</p>');

  // Sections 1-39
  rows.push(p('<strong>1. Use</strong> &nbsp; The Apartment must be used only as a private Apartment to live in as the primary residence of the Tenant and for no other reason. Only a party signing this Lease may use the Apartment. This is subject to Tenant&#39;s rights under the Apartment Sharing Law and to limits on the number of people who may legally occupy an Apartment of this size.'));
  rows.push(p('<strong>2. Failure to give possession</strong> &nbsp; Landlord shall not be liable for failure to give Tenant possession of the Apartment on the beginning date of the Term. Rent shall be payable as of the beginning of the Term unless Landlord is unable to give possession. Rent shall then be payable as of the date possession is available. Landlord must give possession within a reasonable time, if not, Tenant may cancel and obtain a refund of money deposited. The ending date of the Term will not change.'));
  rows.push(p('<strong>3. Rent, added rent</strong> &nbsp; The rent payment for each month must be paid on the first day of that month at Landlord&#39;s address. Landlord need not give notice to pay the rent. Rent must be paid in full without deduction. The first month&#39;s rent is to be paid when Tenant signs this Lease. Tenant may be required to pay other charges to Landlord under the terms of this Lease. They are called &ldquo;added rent.&rdquo; This added rent will be billed and is payable as rent, together with the next monthly rent due.'));
  rows.push(p('<strong>4. Notices</strong> &nbsp; Any bill, statement or notice must be in writing. If to Tenant, it must be delivered or mailed to the Tenant at the Apartment. If to Landlord it must be mailed to Landlord&#39;s address. It will be considered delivered on the day mailed or if not mailed, when left at the proper address. A notice must be sent by certified mail. Landlord must notify Tenant if Landlord&#39;s address is changed.'));
  rows.push(p('<strong>5. Security</strong> &nbsp; Tenant has given security to Landlord in the amount of ' + blank(d.deposit) + ' stated above. The security has been deposited in the Bank named above and delivery of this Lease is notice of the deposit. If the Bank is not named, Landlord will notify Tenant of the Bank&#39;s name and address in which the security is deposited.'));
  rows.push(p('<strong>6. Services</strong> &nbsp; Landlord will supply: (a) heat as required by law, (b) hot and cold water for bathroom and kitchen sink, (c) use of elevator, if any, and (d) cooling if central air-conditioning is installed. Landlord is not required to install air-conditioning. Stopping or reducing of service(s) will not be reason for Tenant to stop paying rent, to make a money claim or to claim eviction.'));

  rows.push(clauseBlock('alterations', '7. Alterations', 'Tenant must obtain Landlord&#39;s prior written consent to install any panelling, flooring, built-in decorations, partitions, railings, or make alterations or to paint or wallpaper the Apartment. Tenant must not change the plumbing, ventilating, air conditioning, electric or heating systems. If consent is given, the alterations and installations shall become the property of Landlord when completed and paid for.'));

  rows.push(p('<strong>8. Repairs</strong> &nbsp; Tenant must take good care of the Apartment and all equipment and fixtures in it. Landlord will repair the plumbing, heating and electrical systems. Tenant must, at Tenant&#39;s cost, make all repairs and replacements whenever the need results from Tenant&#39;s act or neglect. If Tenant fails to make a needed repair or replacement, Landlord may do it. Landlord&#39;s reasonable expense will be added rent.'));
  rows.push(p('<strong>9. Fire, accident, defects, damage</strong> &nbsp; Tenant must give Landlord prompt notice of fire, accident, damage or dangerous or defective condition. If the Apartment cannot be used because of fire or other casualty, Tenant is not required to pay rent for the time the Apartment is unusable. If part of the Apartment cannot be used, Tenant must pay rent for the usable part.'));
  rows.push(p('<strong>10. Liability</strong> &nbsp; Landlord is not liable for loss, expense, or damage to any person or property, unless due to Landlord&#39;s negligence. Landlord is not liable to Tenant for permitting or refusing entry of anyone into the Building. Tenant must pay for damages suffered and reasonable expenses of Landlord relating to any claim arising from any act or neglect of Tenant.'));
  rows.push(p('<strong>11. Entry by Landlord</strong> &nbsp; Landlord may enter the Apartment at reasonable hours to: repair, inspect, exterminate, install or work on systems or equipment and perform other work that Landlord decides is necessary or desirable. At reasonable hours Landlord may show the Apartment to possible buyers, lenders, or tenants. Entry by Landlord must be on reasonable notice except in emergency.'));

  rows.push(clauseBlock('sublet', '12. Assignment and sublease', 'Tenant must not assign all or part of this Lease or sublet all or part of the Apartment or permit any other person to use the Apartment. If Tenant does, Landlord has the right to cancel the Lease. State law may permit Tenant to sublet under certain conditions. Tenant must get Landlord&#39;s written permission each time Tenant wants to assign or sublet.'));

  rows.push(p('<strong>13. Subordination</strong> &nbsp; This Lease and Tenant&#39;s rights are subject and subordinate to all present and future: (a) leases for the Building or the land on which it stands, (b) mortgages on the leases or the Building or land, (c) agreements securing money paid or to be paid by a lender, and (d) terms, conditions, renewals, changes of any kind and extensions of the mortgages, leases or lender agreements.'));
  rows.push(p('<strong>14. Condemnation</strong> &nbsp; If all of the Apartment or Building is taken or condemned by a legal authority, the Term and Tenant&#39;s rights shall end as of the date the authority takes title. If any part of the Apartment or Building is taken, Landlord may cancel this Lease on notice to Tenant.'));
  rows.push(p('<strong>15. Construction or demolition</strong> &nbsp; Construction or demolition may be performed in or near the Building. Even if it interferes with Tenant&#39;s ventilation, view or enjoyment of the Apartment it shall not affect Tenant&#39;s obligations in this Lease.'));
  rows.push(p('<strong>16. Tearing down the building</strong> &nbsp; If Landlord wants to tear down the entire Building, Landlord shall have the right to end this Lease by giving six (6) months notice to Tenant, provided such notice was given to every residential tenant in the Building.'));
  rows.push(p('<strong>17. Liability for property left with Landlord&#39;s employees</strong> &nbsp; Landlord&#39;s employees are not permitted to drive Tenant&#39;s cars or care for Tenant&#39;s personal property. Tenant must not leave a car or other personal property with any of Landlord&#39;s employees. Landlord is not responsible for loss, theft or damage to the property.'));
  rows.push(p('<strong>18. Playground, pool, parking and recreation areas</strong> &nbsp; If there is a playground, pool, parking or recreation area, Landlord may give Tenant permission to use it. Tenant will use the area at Tenant&#39;s own risk and must pay all fees Landlord charges. Landlord&#39;s permission may be cancelled at any time.'));
  rows.push(p('<strong>19. Terraces and balconies</strong> &nbsp; The Apartment may have a terrace or balcony. The terms of this Lease apply to the terrace or balcony as if part of the Apartment. Tenant must keep the terrace or balcony clean and free from snow, ice, leaves and garbage. No cooking is allowed on the terrace or balcony.'));
  rows.push(p('<strong>20. Tenant&#39;s certificate</strong> &nbsp; Upon request by Landlord, Tenant shall sign a certificate stating: (1) This Lease is in full force and unchanged; (2) Landlord has fully performed all terms of this Lease; (3) Tenant is fully performing all terms; (4) rent and added rent have been paid to date.'));
  rows.push(p('<strong>21. Correcting Tenant&#39;s defaults</strong> &nbsp; If Tenant fails to timely correct a default after notice from Landlord, Landlord may correct it at Tenant&#39;s expense. Landlord&#39;s costs to correct the default shall be added rent.'));
  rows.push(p('<strong>22. Tenant&#39;s duty to obey laws and regulations</strong> &nbsp; Tenant must, at Tenant&#39;s expense, promptly comply with all laws, orders, rules, requests, and directions of all governmental authorities and Landlord&#39;s insurers. Tenant may not do anything which may increase Landlord&#39;s insurance premiums. If Tenant does, Tenant must pay the increase in premium as added rent.'));
  rows.push(p('<strong>23. Tenant&#39;s default</strong> &nbsp; A. Landlord must give Tenant written notice of default. The following are defaults: (1) Failure to pay rent or added rent on time, 3 days to cure; (2) Failure to move into the Apartment within 15 days after the beginning date of the Term, 10 days to cure; (3) Improper conduct by Tenant annoying other tenants, 10 days to cure; (4) Failure to comply with any other term or Rule in the Lease, 10 days to cure.'));
  rows.push(p('<strong>24. Jury trial and counterclaims</strong> &nbsp; Landlord and Tenant agree not to use their right to a Trial by Jury in any action or proceeding brought by either, against the other, for any matter concerning this Lease or the Apartment.'));
  rows.push(p('<strong>25. No waiver, illegality</strong> &nbsp; Landlord&#39;s acceptance of rent or failure to enforce any term in this Lease is not a waiver of Landlord&#39;s rights. If a term in this Lease is illegal, the rest of this Lease remains in full force.'));
  rows.push(p('<strong>26. Insolvency</strong> &nbsp; If Tenant assigns property for the benefit of creditors, or a non-bankruptcy trustee or receiver of Tenant or Tenant&#39;s property is appointed, Landlord may give Tenant 30 days notice of cancellation of the Term of this Lease.'));

  rows.push(clauseBlock('noise', '27. Rules', 'Tenant must comply with the building Rules. Notice of new Rules will be given to Tenant. Tenant shall not make or permit any disturbing noise in the building or interfere with occupants of other apartments.'));

  rows.push(p('<strong>28. Representations, changes in Lease</strong> &nbsp; Tenant has read this Lease. All promises made by the Landlord are in this Lease. There are no others. This Lease may be changed only by an agreement in writing signed by and delivered to each party.'));
  rows.push(p('<strong>29. Landlord unable to perform</strong> &nbsp; If due to labor trouble, government order, lack of supply, Tenant&#39;s act or neglect, or any other cause not fully within Landlord&#39;s reasonable control, Landlord is delayed or unable to carry out any of Landlord&#39;s promises, this Lease shall not be ended or Tenant&#39;s obligations affected.'));
  rows.push(p('<strong>30. End of term</strong> &nbsp; At the end of the Term, Tenant must: leave the Apartment clean and in good condition, subject to ordinary wear and tear; remove all of Tenant&#39;s property and installations; repair all damages caused by moving; and restore the Apartment to its condition at the beginning of the Term.'));
  rows.push(p('<strong>31. Space &ldquo;as is&rdquo;</strong> &nbsp; Tenant has inspected the Apartment and Building. Tenant states they are in good order and repair and takes the Apartment as is except for latent defects.'));
  rows.push(p('<strong>32. Landlord&#39;s warranty of habitability</strong> &nbsp; Landlord states that the Apartment and Building are fit for human living and there is no condition dangerous to health, life or safety.'));
  rows.push(p('<strong>33. Landlord&#39;s consent</strong> &nbsp; If Tenant requires Landlord&#39;s consent to any act and such consent is not given, Tenant&#39;s only right is to ask the Court for a declaratory judgment to force Landlord to give consent.'));
  rows.push(p('<strong>34. Limit of recovery against Landlord</strong> &nbsp; Tenant is limited to Landlord&#39;s interest in the Building for payment of a judgment or other court remedy against Landlord.'));
  rows.push(p('<strong>35. Lease binding on</strong> &nbsp; This Lease is binding on Landlord and Tenant and their heirs, distributees, executors, administrators, successors and lawful assigns.'));
  rows.push(p('<strong>36. Landlord</strong> &nbsp; Landlord means the owner of the Building or Apartment, or the lessee of the Building, or a lender in possession. Landlord&#39;s obligations end when Landlord&#39;s interest is transferred. Any acts Landlord may do may be performed by Landlord&#39;s agents or employees.'));
  rows.push(p('<strong>37. Paragraph headings</strong> &nbsp; The paragraph headings are for convenience only.'));

  rows.push(clauseBlock('smoking', '38. Smoking', 'Smoking of tobacco, cannabis, or any other substance is strictly prohibited within the Apartment and all common areas of the Building.'));
  rows.push(clauseBlock('airbnb', 'Short-Term Rental Prohibition', 'Under no circumstances shall Tenant list or offer the Apartment on Airbnb or any other short-term rental platform (rental for less than 30 days). If Tenant does so, Landlord has the right to immediately terminate this Lease.'));
  rows.push(clauseBlock('pets', '39. No Pets', 'Dogs, cats or other animals or pets are not allowed in the Apartment or Building unless expressly permitted in writing by Landlord.'));
  rows.push(clauseBlock('keycard', 'Keys & Access', 'Tenant acknowledges receipt of _______ key(s) and _______ access card(s). Any lost or damaged keys or access cards shall be replaced at Tenant&#39;s sole expense.'));
  rows.push(clauseBlock('storage', 'Storage', 'Any storage space assigned to Tenant is a revocable license only and may be terminated by Landlord upon thirty (30) days written notice. Storage space is not part of the demised Premises.'));
  rows.push((function(){ var rc = buildRenewalClause(d); return rc ? clauseBlock('renewal', 'Renewal Option', rc) : ''; })());
  rows.push(clauseBlock('earlyterm', 'Early Termination', 'Tenant may terminate this Lease prior to the expiration date upon not less than sixty (60) days prior written notice to Landlord and payment of an early termination fee equal to two (2) months&#39; rent.'));
  rows.push(clauseBlock('concierge', 'Concierge & Building Procedures', 'Tenant shall comply with all building concierge, package delivery, and visitor access protocols as established by building management and as may be amended from time to time.'));
  rows.push(clauseBlock('reno', 'Renovation Notice', 'Tenant acknowledges that renovation or construction may be performed in adjacent units or common areas during the lease term and agrees such work shall not constitute grounds for rent abatement or constructive eviction.'));
  rows.push(clauseBlock('hoarder', 'Excessive Personal Property', 'Tenant shall not accumulate personal property in a manner that creates a health, safety, or fire hazard or impairs reasonable access to the Premises or common areas of the Building.'));
  rows.push(clauseBlock('guarantor', 'Guarantor', 'The performance of all obligations of Tenant hereunder is guaranteed by a qualified guarantor pursuant to the Guaranty of Payment executed simultaneously herewith and attached hereto.'));

  // Signatures
  rows.push(ph('Signatures'));
  rows.push(p('Landlord and Tenant have signed this Lease as of the above date. It is effective when Landlord delivers to Tenant a copy signed by all parties.'));
  rows.push('<br>');
  rows.push('<table style="width:100%;border-collapse:collapse;">');
  rows.push('<tr>');
  rows.push('<td style="width:50%;padding-right:20px;vertical-align:top;">');
  rows.push('<p><strong>LANDLORD:</strong></p>');
  rows.push('<p style="border-bottom:1px solid #333;margin-top:24px;padding-bottom:2px;">' + blank(d.landlord) + '</p>');
  rows.push('<p style="margin-top:4px;font-size:0.8rem;">WITNESS: ________________________________</p>');
  rows.push('</td>');
  rows.push('<td style="width:50%;padding-left:20px;vertical-align:top;">');
  rows.push('<p><strong>TENANT:</strong></p>');
  rows.push('<p style="border-bottom:1px solid #333;margin-top:24px;padding-bottom:2px;">' + blank(d.tenant) + '</p>');
  rows.push('<p style="margin-top:4px;font-size:0.8rem;">WITNESS: ________________________________</p>');
  rows.push('</td>');
  rows.push('</tr>');
  rows.push('</table>');

  // Guaranty
  rows.push(ph('GUARANTY OF PAYMENT'));
  rows.push('<p style="font-size:0.85rem;">I know that the Landlord would not rent the Apartment to the Tenant unless I guarantee Tenant&#39;s performance. I guaranty the full performance of the Lease by the Tenant. This Guaranty is absolute and without any condition.</p>');
  rows.push('<table style="width:100%;border-collapse:collapse;margin-top:12px;">');
  rows.push('<tr>');
  rows.push('<td style="width:50%;padding-right:20px;vertical-align:top;font-size:0.85rem;">');
  rows.push('<p><strong>GUARANTOR:</strong> ________________________________</p>');
  rows.push('<p>Guarantor&#39;s address: ________________________________</p>');
  rows.push('</td>');
  rows.push('<td style="width:50%;padding-left:20px;vertical-align:top;font-size:0.85rem;">');
  rows.push('<p><strong>Date of Guaranty:</strong> ________________________________</p>');
  rows.push('</td>');
  rows.push('</tr>');
  rows.push('</table>');
  rows.push('<p style="font-size:0.78rem;color:#888;margin-top:8px;">*If no broker, insert &ldquo;None.&rdquo;</p>');

  return rows.join('\n');
}

function buildBlumbergA55(d) { return buildBlumbergA55Direct(d); }

function buildMainLease(d) {
  var pt = PROPERTY_LABELS[state.propertyType];
  var isRental = state.propertyType === 'rental';
  var isStab = state.propertyType === 'stabilized';

  // ‚îÄ‚îÄ ROUTER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  var form = state.leaseForm; // 'rebny' or 'blumberg'
  if (state.propertyType === 'rental')     return form === 'rebny' ? buildREBNYApt(d) : buildBlumbergA55(d);
  if (state.propertyType === 'condo')      return form === 'rebny' ? buildREBNYCondo(d) : buildBlumberg101(d);
  if (state.propertyType === 'coop')       return form === 'rebny' ? buildREBNYCoop(d) : buildBlumberg101(d, true);
  if (state.propertyType === 'stabilized') return buildREBNYStab(d);
  if (state.propertyType === 'townhouse')  return buildREBNYTownhouse(d);
  if (state.propertyType === 'commercial' || state.propertyType === 'office') return buildCommercialPlaceholder(d);

  return buildBlumbergA55Direct(d);
}


function buildRiderContent(id, d) {
  const templates = {
    leadpaint: `
      <div class="doc-section-heading">Lead-Based Paint Disclosure</div>
      <p><strong>FEDERAL LAW REQUIRES</strong> the following disclosure for housing built before 1978.</p>
      <p><strong>Landlord's Disclosure:</strong> Landlord has no knowledge of lead-based paint and/or lead-based paint hazards in the Premises, except: ________________.</p>
      <p>Landlord has provided Tenant with all available records and reports pertaining to lead-based paint in the Premises. Tenant has received the EPA pamphlet "Protect Your Family From Lead in Your Home."</p>
      <p>Tenant acknowledges receipt of this disclosure and the EPA informational pamphlet.</p>
      <br><p><strong>LANDLORD:</strong> ${blank(d.landlord)} &nbsp;&nbsp; Date: ________</p>
      <br><p><strong>TENANT:</strong> ${blank(d.tenant)} &nbsp;&nbsp; Date: ________</p>
    `,
    bedbug: `
      <div class="doc-section-heading">Bedbug Infestation Disclosure</div>
      <p>Pursuant to New York City Administrative Code ¬ß27-2018.1, Landlord discloses the following bedbug infestation history for the building located at ${blank(d.address)}:</p>
      <p><strong>Premises (${blank(d.unit)}):</strong> No infestation history in the past year, except as noted: ________________.</p>
      <p><strong>Building-Wide:</strong> The building has [ ] / has not [ ] had a bedbug infestation in the past year.</p>
      <p>Tenant acknowledges receipt of this disclosure and the NYC DOHMH bedbug informational brochure.</p>
      <br><p><strong>TENANT:</strong> ${blank(d.tenant)} &nbsp;&nbsp; Date: ________</p>
    `,
    smoke: `
      <div class="doc-section-heading">Smoke Detector & Carbon Monoxide Detector Rider</div>
      <p>Landlord represents that, as of the commencement date, functioning smoke detector(s) and carbon monoxide detector(s) have been installed in the Premises in accordance with applicable NYC and NYS law.</p>
      <p>Tenant agrees to: (i) test detectors monthly; (ii) replace batteries as needed; (iii) not disable or tamper with any detector; and (iv) notify Landlord promptly if any detector is inoperative.</p>
      <br><p><strong>TENANT:</strong> ${blank(d.tenant)} &nbsp;&nbsp; Date: ________</p>
    `,
    windowguard: `
      <div class="doc-section-heading">Window Guard Notice</div>
      <p>Pursuant to NYC Health Code ¬ß131.15, Landlord is required to provide and install window guards in your apartment if a child 10 years of age or younger resides in your apartment, OR if you request window guards.</p>
      <p>[ ] YES ‚Äî I want window guards installed.<br>[ ] NO ‚Äî No child 10 years of age or younger lives in my apartment.</p>
      <br><p><strong>TENANT:</strong> ${blank(d.tenant)} &nbsp;&nbsp; Date: ________</p>
    `,
    petadd: `
      <div class="doc-section-heading">Pet Rider</div>
      <p>Notwithstanding the no-pet provision in the Lease, Landlord hereby consents to Tenant keeping the following pet(s): ________________ (species/breed/name).</p>
      <p>Tenant shall pay an additional pet deposit of $________________, refundable upon surrender of the Premises in satisfactory condition. Tenant assumes full liability for any damage or injury caused by the pet(s).</p>
      <br><p><strong>LANDLORD:</strong> ${blank(d.landlord)} &nbsp;&nbsp; Date: ________</p>
      <br><p><strong>TENANT:</strong> ${blank(d.tenant)} &nbsp;&nbsp; Date: ________</p>
    `,
    guarantor_rider: `
      <div class="doc-section-heading">Guaranty of Lease</div>
      <p>For value received, and in consideration of Landlord entering into the foregoing Lease with Tenant, the undersigned Guarantor ("Guarantor") unconditionally and irrevocably guarantees the full and timely performance by Tenant of all obligations under the Lease.</p>
      <p><strong>Guarantor Name:</strong> ________________ &nbsp;&nbsp; <strong>Relationship to Tenant:</strong> ________________</p>
      <p><strong>Guarantor Address:</strong> ________________</p>
      <p>This Guaranty shall remain in full force and effect for the entire lease term and any renewals or holdover periods.</p>
      <br><p><strong>GUARANTOR:</strong> ________________ &nbsp;&nbsp; Date: ________</p>
    `,
    coop_rules: `
      <div class="doc-section-heading">House Rules Acknowledgment</div>
      <p>Tenant acknowledges receipt of the current House Rules of the building located at ${blank(d.address)} and agrees to comply with all such rules and any amendments thereto during the lease term.</p>
      <p>Tenant understands that violation of the House Rules may constitute a material breach of the Lease.</p>
      <br><p><strong>TENANT:</strong> ${blank(d.tenant)} &nbsp;&nbsp; Date: ________</p>
    `,
    renewal_rider: `
      <div class="doc-section-heading">Rent Stabilization Renewal Lease Rider</div>
      <p>This tenancy is subject to the Rent Stabilization Law. The current legal regulated rent is ${blank(d.legalRent)}.</p>
      <p>The permissible rent increase for this renewal term is determined by the applicable Rent Guidelines Board Order. Tenant has the right to renew this Lease and may not be evicted except for good cause as defined by law.</p>
      <p>DHCR Registration No.: ${blank(d.dhcrNo)}.</p>
      <br><p><strong>TENANT:</strong> ${blank(d.tenant)} &nbsp;&nbsp; Date: ________</p>
    `,
    preferential: `
      <div class="doc-section-heading">Preferential Rent Rider</div>
      <p>Pursuant to RSL ¬ß26-511(c)(14), Landlord discloses the following:</p>
      <p><strong>Legal Registered Rent:</strong> ${blank(d.legalRent)}<br>
      <strong>Preferential Rent Charged:</strong> ${blank(d.prefRent)}</p>
      <p>Tenant acknowledges that the legal registered rent is higher than the preferential rent currently being charged, and that upon lease renewal, Landlord may be entitled to charge up to the legal registered rent subject to applicable RGB guidelines.</p>
      <br><p><strong>TENANT:</strong> ${blank(d.tenant)} &nbsp;&nbsp; Date: ________</p>
    `,
  };

  // ‚îÄ‚îÄ Furnished Rider ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  templates['furnished'] = '<div class="doc-section-heading">FURNISHED APARTMENT RIDER</div>' +
    '<p>This Rider is attached to and made part of the Lease Agreement dated ' + blank(d.startDate) + ' between ' + blank(d.landlord) + ' ("Landlord") and ' + blank(d.tenant) + ' ("Tenant") for the premises at ' + blank(d.address) + ', ' + blank(d.unit) + '.</p>' +

    '<p><strong>1. Furnished Premises.</strong> The Apartment is leased in its furnished condition. Landlord represents that all furniture, furnishings, fixtures, and personal property described in the inventory below ("Furniture") is present in the Apartment as of the Commencement Date of the Lease.</p>' +

    '<div class="doc-section-heading" style="font-size:0.85rem;margin-top:20px;">FURNITURE INVENTORY ‚Äî EXHIBIT A</div>' +
    '<table style="width:100%;border-collapse:collapse;font-size:0.85rem;margin:12px 0;">' +
    '<tr style="background:#f2f2f2;">' +
    '<th style="padding:8px;border:1px solid #ccc;text-align:left;width:35%;">Item / Description</th>' +
    '<th style="padding:8px;border:1px solid #ccc;text-align:left;width:25%;">Room / Location</th>' +
    '<th style="padding:8px;border:1px solid #ccc;text-align:left;width:20%;">Quantity</th>' +
    '<th style="padding:8px;border:1px solid #ccc;text-align:left;width:20%;">Condition</th>' +
    '</tr>' +
    '<tr><td style="padding:8px;border:1px solid #ccc;">________________________________</td><td style="padding:8px;border:1px solid #ccc;">________________________________</td><td style="padding:8px;border:1px solid #ccc;">________</td><td style="padding:8px;border:1px solid #ccc;">________________</td></tr>' +
    '<tr><td style="padding:8px;border:1px solid #ccc;">________________________________</td><td style="padding:8px;border:1px solid #ccc;">________________________________</td><td style="padding:8px;border:1px solid #ccc;">________</td><td style="padding:8px;border:1px solid #ccc;">________________</td></tr>' +
    '<tr><td style="padding:8px;border:1px solid #ccc;">________________________________</td><td style="padding:8px;border:1px solid #ccc;">________________________________</td><td style="padding:8px;border:1px solid #ccc;">________</td><td style="padding:8px;border:1px solid #ccc;">________________</td></tr>' +
    '<tr><td style="padding:8px;border:1px solid #ccc;">________________________________</td><td style="padding:8px;border:1px solid #ccc;">________________________________</td><td style="padding:8px;border:1px solid #ccc;">________</td><td style="padding:8px;border:1px solid #ccc;">________________</td></tr>' +
    '<tr><td style="padding:8px;border:1px solid #ccc;">________________________________</td><td style="padding:8px;border:1px solid #ccc;">________________________________</td><td style="padding:8px;border:1px solid #ccc;">________</td><td style="padding:8px;border:1px solid #ccc;">________________</td></tr>' +
    '<tr><td style="padding:8px;border:1px solid #ccc;color:#aaa;font-style:italic;" colspan="4">Additional items may be listed on a separate attached page initialed by both parties.</td></tr>' +
    '</table>' +

    '<p><strong>2. Accepted As-Is.</strong> Tenant acknowledges having inspected the Furniture and accepts it in its present condition, subject to any defects noted above. Landlord makes no warranty as to the condition, fitness, or suitability of the Furniture beyond the representations herein.</p>' +

    '<p><strong>3. Tenant Responsibility.</strong> Tenant shall: (a) use the Furniture with reasonable care; (b) promptly notify Landlord of any damage; (c) be responsible for the cost of repair or replacement of any Furniture damaged beyond ordinary wear and tear; and (d) not remove any Furniture from the Apartment without Landlord&#39;s prior written consent.</p>' +

    '<p><strong>4. Return Condition.</strong> At the expiration or earlier termination of the Lease, Tenant shall return the Apartment with all Furniture in substantially the same condition as received, ordinary wear and tear excepted. Landlord shall inspect the Apartment within _______ days of Tenant&#39;s vacating and provide Tenant with a written statement of any claimed damage to the Furniture. The cost of replacing or repairing any missing or damaged Furniture beyond ordinary wear and tear shall be deducted from the Security Deposit.</p>' +

    '<p><strong>5. Additional Furniture Security.</strong> In addition to the Security Deposit provided in the Lease, Tenant shall deposit the sum of ' + blank(null, '$________________') + ' as additional security for the Furniture (&ldquo;Furniture Deposit&rdquo;), to be held and returned in accordance with the terms of the Lease.</p>' +

    '<p><strong>6. Insurance.</strong> Tenant is encouraged to obtain renter&#39;s insurance covering the Furniture against loss, theft, or damage. Landlord&#39;s property insurance does not cover Tenant&#39;s liability for damage to the Furniture.</p>' +

    '<br><p><strong>LANDLORD:</strong> ' + blank(d.landlord) + ' &nbsp;&nbsp; Date: ________</p>' +
    '<br><p><strong>TENANT:</strong> ' + blank(d.tenant) + ' &nbsp;&nbsp; Date: ________</p>';

  // ‚îÄ‚îÄ Concessions Rider ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  templates['concessions'] = '<div class="doc-section-heading">CONCESSION RIDER</div>' +
    '<p>This Rider is attached to and made part of the Lease Agreement dated ' + blank(d.startDate) + ' between ' + blank(d.landlord) + ' ("Landlord") and ' + blank(d.tenant) + ' ("Tenant") for the premises at ' + blank(d.address) + ', ' + blank(d.unit) + '.</p>' +

    '<p>In consideration of Tenant executing the Lease, Landlord agrees to provide the following concession(s) (check all that apply):</p>' +

    '<div style="margin:16px 0;padding:16px;background:#f9f9f9;border:1px solid #ddd;border-radius:6px;">' +

    '<p style="margin-bottom:14px;"><strong>[ &nbsp; ] FREE RENT MONTHS</strong><br>' +
    'Landlord agrees to abate the full monthly rent of ' + blank(d.rent) + ' for the following month(s): ________________________________.<br>' +
    'Free rent shall be applied at the <strong>[ &nbsp; ] start</strong> &nbsp; <strong>[ &nbsp; ] end</strong> of the lease term. ' +
    'No rent shall be due or payable for the designated free month(s), provided Tenant is not in default under the Lease.</p>' +

    '<p style="margin-bottom:14px;"><strong>[ &nbsp; ] AMORTIZED RENT REDUCTION</strong><br>' +
    'The monthly rent shall be reduced to ' + blank(null, '$________________') + ' for the period from ________________ through ________________ (the &ldquo;Reduction Period&rdquo;). ' +
    'The effective economic rent for the full lease term, amortized over _______ months, equals ' + blank(null, '$________________') + ' per month.</p>' +

    '<p><strong>[ &nbsp; ] ONE-TIME RENT CREDIT</strong><br>' +
    'Landlord shall apply a one-time credit of ' + blank(null, '$________________') + ' against the rent due for the month of ________________.</p>' +
    '</div>' +

    '<p><strong>Clawback on Early Termination.</strong> If Tenant terminates the Lease prior to the expiration of the full lease term for any reason other than Landlord&#39;s default, or if Tenant is dispossessed for cause, the full value of any concession granted hereunder shall become immediately due and payable as additional rent. The unamortized value of the concession shall be calculated on a straight-line basis over the original lease term.</p>' +

    '<p><strong>Concession Contingent on Full Performance.</strong> The concessions described herein are contingent upon Tenant&#39;s full and timely performance of all obligations under the Lease throughout the entire lease term. Any default by Tenant, if uncured within the applicable notice period, shall cause all concessions to be void and the full rental value to be immediately due.</p>' +

    '<p><strong>No Modification of Base Rent.</strong> The concessions granted herein do not modify the base monthly rent of ' + blank(d.rent) + ' as stated in the Lease. This Rider sets forth a temporary abatement or credit only and shall not be used to establish a new base rent for any renewal term.</p>' +

    '<br><p><strong>LANDLORD:</strong> ' + blank(d.landlord) + ' &nbsp;&nbsp; Date: ________</p>' +
    '<br><p><strong>TENANT:</strong> ' + blank(d.tenant) + ' &nbsp;&nbsp; Date: ________</p>';

  templates['renewal_option_rider'] = (function() {
    var rd = renewalData(d);
    if (rd.count === 0) {
      return '<div class="doc-section-heading">Renewal Option Rider</div><p><em>No renewal option was configured. Return to Step 2 to set up renewal options.</em></p>';
    }
    var rows = [];
    rows.push('<div class="doc-section-heading">Renewal Option Rider</div>');
    rows.push('<p>This Rider is attached to and made a part of the Lease Agreement dated ' + blank(d.startDate) + ' between ' + blank(d.landlord) + ' (&ldquo;Owner&rdquo;) and ' + blank(d.tenant) + ' (&ldquo;Tenant&rdquo;) for the premises at ' + blank(d.address) + (d.unit ? ', ' + blank(d.unit) : '') + '.</p>');

    for (var i = 1; i <= rd.count; i++) {
      // Compute dates for each option (each starts day after prior period ends)
      var leaseEnd = d.endDate ? new Date(d.endDate) : null;
      var optStart = null, optEnd = null;
      if (leaseEnd && !isNaN(leaseEnd.getTime())) {
        optStart = new Date(leaseEnd.getTime() + 86400000); // day after lease end
        if (rd.termYears > 0) {
          optStart.setFullYear(optStart.getFullYear() + (i - 1) * rd.termYears);
          optEnd = new Date(optStart);
          optEnd.setFullYear(optEnd.getFullYear() + rd.termYears);
          optEnd.setDate(optEnd.getDate() - 1);
        }
      }
      var sDate = optStart ? formatDate(optStart) : '________________________________';
      var eDate = (optEnd   ? formatDate(optEnd)   : (rd.mtm ? 'month-to-month' : '________________________________'));
      var termStr = rd.termYears > 0 ? String(rd.termYears) : (rd.mtm ? 'month-to-month' : rd.term);
      var ordinal = i === 1 ? 'First' : i === 2 ? 'Second' : i === 3 ? 'Third' : i + 'th';

      rows.push(p('<strong>Option ' + i + ' &mdash; ' + ordinal + ' Renewal Term</strong>'));
      rows.push(p('A. <strong>Term.</strong> Tenant shall have the right to extend the term of this Lease for ' + blank(termStr) + ' year(s) commencing ' + blank(sDate) + ' and ending on ' + blank(eDate) + ' (the &ldquo;' + ordinal + ' Extension Term&rdquo;).'));
      rows.push(p('B. <strong>Exercise.</strong> To exercise this option, Tenant must deliver written notice to Owner no less than ' + rd.notice + ' days prior to the expiration of the then-current term, <strong>TIME BEING OF THE ESSENCE</strong>. If Tenant fails to timely deliver such notice, this Option ' + i + ' shall be of no further force and effect' + (i < rd.count ? ', provided that Options ' + (i + 1) + ' through ' + rd.count + ' shall remain unaffected' : '') + '.'));
      rows.push(p('C. <strong>Conditions.</strong> Tenant may not exercise this option if Tenant (i) is in default of any provision of this Lease at the time of exercise or at commencement of the Extension Term, (ii) has assigned this Lease, or (iii) has sublet the Apartment.'));
      rows.push(p('D. <strong>Rent.</strong> The monthly Rent during the ' + ordinal + ' Extension Term shall be ' + blank(rd.rentDisplay.dollar) + (rd.rentType !== 'fixed' ? ' [' + rd.rentDisplay.sentence + ']' : '') + '.'));
      rows.push(p('E. <strong>Terms.</strong> All provisions of this Lease, except as modified herein, shall remain in full force and effect during the ' + ordinal + ' Extension Term.'));
      if (i < rd.count) rows.push('<hr style="border:none;border-top:1px solid #ddd;margin:12px 0;">');
    }

    rows.push('<br><p><strong>OWNER:</strong> ' + blank(d.landlord) + ' &nbsp;&nbsp; Date: ________</p>');
    rows.push('<br><p><strong>TENANT:</strong> ' + blank(d.tenant) + ' &nbsp;&nbsp; Date: ________</p>');
    return rows.join('\n');
  })();

  // XL Rider name is dynamic based on property type
  const xlName = `XL Rider - ${PROPERTY_LABELS[state.propertyType] || 'Residential'}`;
  templates['xl_rider'] = `
    <div class="doc-section-heading">${xlName}</div>
    <p>This rider is attached to and made a part of the Lease Agreement between ${blank(d.landlord)} ("Landlord") and ${blank(d.tenant)} ("Tenant") for the premises at ${blank(d.address)}, ${blank(d.unit)}.</p>
    <p style="font-style:italic; color:#888; border:1.5px dashed #c9a84c; padding:16px; border-radius:6px; margin:16px 0;">
      <strong>[ Company Rider Content ]</strong><br><br>
      Your standard XL Rider text will be inserted here. Please provide the rider content and it will be incorporated into the preview and export.
    </p>
    <br><p><strong>LANDLORD:</strong> ${blank(d.landlord)} &nbsp;&nbsp; Date: ________</p>
    <br><p><strong>TENANT:</strong> ${blank(d.tenant)} &nbsp;&nbsp; Date: ________</p>
  `;

  return templates[id] || `<div class="doc-section-heading">Rider Content</div><p>Placeholder content for the <strong>${ALL_RIDERS.find(r=>r.id===id)?.name}</strong> rider. Your actual rider text will be inserted here when you provide the template.</p><br><p><strong>LANDLORD:</strong> ${blank(d.landlord)} &nbsp;&nbsp; Date: ________</p><br><p><strong>TENANT:</strong> ${blank(d.tenant)} &nbsp;&nbsp; Date: ________</p>`;
}

// ‚ïê‚ïê‚ïê EXPORT (placeholder ‚Äî real PDF would require a library) ‚ïê‚ïê‚ïê
function exportPortfolio() {
  alert('Portfolio PDF export: In the full version, this will generate a professionally formatted PDF package with the main lease and each rider as clearly separated, individually-paginated sections ‚Äî ready for DocuSign or printing.\n\nTo enable real PDF export, this app can be connected to a PDF generation library.');
}
function exportConsolidated() {
  alert('Single PDF export: In the full version, this will generate one continuous PDF with all documents merged in order.\n\nTo enable real PDF export, this app can be connected to a PDF generation library.');
}

// ‚ïê‚ïê‚ïê INVOICE GENERATOR (placeholder ‚Äî template to be provided by XL) ‚ïê‚ïê‚ïê
function generateInvoice() {
  var d = collectData();
  if (!d.billOwner) return;

  // ‚îÄ‚îÄ Invoice number: XL-YYYYMMDD-[rand 3 digits] ‚îÄ‚îÄ
  var now = new Date();
  var pad = function(n){ return String(n).padStart(2,'0'); };
  var datePart = now.getFullYear() + pad(now.getMonth()+1) + pad(now.getDate());
  var rand = String(Math.floor(Math.random()*900)+100);
  var invoiceNo = 'XL-' + datePart + '-' + rand;

  // ‚îÄ‚îÄ Format amounts ‚îÄ‚îÄ
  var rawAmt = (d.billingAmount || '$400.00').replace(/[^0-9.]/g,'');
  var amount = parseFloat(rawAmt) || 400;
  var amountFmt = '$' + amount.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');

  var boardAmt = 0;
  var boardAmtFmt = '$0.00';
  if (d.boardPackage) {
    var rawBoard = (d.boardPackageAmount || '$600.00').replace(/[^0-9.]/g,'');
    boardAmt = parseFloat(rawBoard) || 600;
    boardAmtFmt = '$' + boardAmt.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
  }

  var totalAmt = amount + boardAmt;
  var totalFmt = '$' + totalAmt.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');

  var boardRow = d.boardPackage ? `
    <tr>
      <td>
        <strong>Board Package / Screening Services</strong><br>
        <span style="color:#666;font-size:12px;">Coordination and preparation of board package / screening process for ${property}</span>
      </td>
      <td>1</td>
      <td class="amt-col">${boardAmtFmt}</td>
      <td class="amt-col">${boardAmtFmt}</td>
    </tr>` : '';

  // ‚îÄ‚îÄ Date display ‚îÄ‚îÄ
  var invoiceDate = now.toLocaleDateString('en-US', { month:'long', day:'numeric', year:'numeric' });

  // ‚îÄ‚îÄ Property address ‚îÄ‚îÄ
  var property = [d.aptAddr, d.aptNo ? 'Apt ' + d.aptNo : ''].filter(Boolean).join(', ') || 'Property address not entered';

  // ‚îÄ‚îÄ Build HTML invoice in new window ‚îÄ‚îÄ
  // ‚ö†Ô∏è  PLACEHOLDER TEMPLATE ‚Äî replace with XL branded version when provided
  var html = `<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Invoice ${invoiceNo}</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Helvetica Neue', Arial, sans-serif; font-size: 13px; color: #1a1a2e; background: #fff; padding: 60px; }
  .inv-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 48px; }
  .inv-logo { font-size: 28px; font-weight: 700; letter-spacing: 0.04em; color: #0d1b2a; }
  .inv-logo span { color: #c9a84c; }
  .inv-logo-sub { font-size: 10px; letter-spacing: 0.12em; text-transform: uppercase; color: #888; margin-top: 3px; }
  .inv-meta { text-align: right; }
  .inv-meta .inv-no { font-size: 18px; font-weight: 600; color: #0d1b2a; margin-bottom: 4px; }
  .inv-meta .inv-date { font-size: 12px; color: #666; }
  hr { border: none; border-top: 1px solid #e2ddd5; margin: 28px 0; }
  .inv-parties { display: flex; gap: 60px; margin-bottom: 40px; }
  .inv-party label { font-size: 10px; text-transform: uppercase; letter-spacing: 0.1em; color: #888; display: block; margin-bottom: 8px; }
  .inv-party .name { font-weight: 600; font-size: 14px; margin-bottom: 3px; }
  .inv-party .detail { color: #555; line-height: 1.6; }
  table { width: 100%; border-collapse: collapse; margin-bottom: 32px; }
  thead th { background: #0d1b2a; color: #fff; padding: 10px 14px; text-align: left; font-size: 11px; letter-spacing: 0.07em; text-transform: uppercase; }
  tbody td { padding: 14px; border-bottom: 1px solid #f0ece5; }
  tbody tr:last-child td { border-bottom: none; }
  .amt-col { text-align: right; }
  .inv-total { display: flex; justify-content: flex-end; margin-bottom: 40px; }
  .inv-total table { width: 280px; }
  .inv-total td { padding: 7px 14px; }
  .inv-total .total-row td { font-weight: 700; font-size: 15px; border-top: 2px solid #0d1b2a; padding-top: 12px; }
  .inv-footer { font-size: 11px; color: #888; line-height: 1.7; border-top: 1px solid #e2ddd5; padding-top: 20px; }
  .inv-due { display: inline-block; background: #f7f4ef; border: 1px solid #e2ddd5; border-radius: 4px; padding: 4px 12px; font-size: 11px; font-weight: 600; color: #0d1b2a; margin-bottom: 20px; }
  @media print { body { padding: 40px; } }
</style>
</head>
<body>

<div class="inv-header">
  <div>
    <div class="inv-logo">XL<span>.</span></div>
    <div class="inv-logo-sub">Real Property Management</div>
  </div>
  <div class="inv-meta">
    <div class="inv-no">Invoice ${invoiceNo}</div>
    <div class="inv-date">${invoiceDate}</div>
  </div>
</div>

<hr>

<div class="inv-parties">
  <div class="inv-party">
    <label>From</label>
    <div class="name">XL Real Property Management</div>
    <div class="detail">
      80 Fifth Avenue, Suite 1501<br>
      New York, NY 10011<br>
      josh@xl-rpm.com
    </div>
  </div>
  <div class="inv-party">
    <label>Bill To</label>
    <div class="name">${d.landlord || 'Owner Name'}</div>
    <div class="detail">
      ${d.landlordAddr || ''}<br>
      ${d.landlordEmail ? d.landlordEmail : ''}
    </div>
  </div>
  <div class="inv-party">
    <label>Re: Property</label>
    <div class="name">${property}</div>
    <div class="detail">
      Lease term: ${d.leaseStart || '‚Äî'} ‚Äì ${d.leaseEnd || '‚Äî'}<br>
      Tenant: ${d.tenant || '‚Äî'}
    </div>
  </div>
</div>

<div class="inv-due">Due Upon Receipt</div>

<table>
  <thead>
    <tr>
      <th style="width:60%">Description</th>
      <th>Qty</th>
      <th class="amt-col">Rate</th>
      <th class="amt-col">Amount</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        <strong>Lease Drafting Services</strong><br>
        <span style="color:#666;font-size:12px;">Preparation of residential lease package for ${property}</span>
      </td>
      <td>1</td>
      <td class="amt-col">${amountFmt}</td>
      <td class="amt-col">${amountFmt}</td>
    </tr>
    ${boardRow}
  </tbody>
</table>

<div class="inv-total">
  <table>
    <tr><td>Subtotal</td><td class="amt-col">${totalFmt}</td></tr>
    <tr><td>Tax</td><td class="amt-col">$0.00</td></tr>
    <tr class="total-row"><td>Total Due</td><td class="amt-col">${totalFmt}</td></tr>
  </table>
</div>

<div class="inv-footer">
  <!-- ‚ö†Ô∏è PLACEHOLDER ‚Äî replace footer with XL payment instructions when template is provided -->
  Please remit payment to XL Real Property Management. Reference invoice number <strong>${invoiceNo}</strong> with your payment.<br>
  Questions? Contact josh@xl-rpm.com &nbsp;|&nbsp; 80 Fifth Avenue, Suite 1501, New York, NY 10011
</div>

<script>window.print();<\/script>
</body>
</html>`;

  var win = window.open('', '_blank', 'width=900,height=700');
  if (win) {
    win.document.write(html);
    win.document.close();
  } else {
    alert('Pop-up blocked. Please allow pop-ups for this page to generate the invoice.');
  }
}
// ‚ïê‚ïê‚ïê PIN GATE ‚ïê‚ïê‚ïê
(function() {
  const CORRECT = '8684';
  const SESSION_KEY = 'xl_lease_auth';

  function unlock() {
    document.getElementById('pinGate').classList.add('hidden');
    sessionStorage.setItem(SESSION_KEY, '1');
  }

  // Already authenticated this session
  if (sessionStorage.getItem(SESSION_KEY) === '1') {
    unlock();
    return;
  }

  // Focus input on load
  window.addEventListener('load', function() {
    const inp = document.getElementById('pinInput');
    if (inp) setTimeout(() => inp.focus(), 100);
  });

  window.submitPin = function() {
    const inp = document.getElementById('pinInput');
    const err = document.getElementById('pinError');
    const val = inp.value.trim();

    if (val === CORRECT) {
      unlock();
    } else {
      inp.classList.add('error');
      err.textContent = 'Incorrect PIN. Please try again.';
      inp.value = '';
      setTimeout(() => {
        inp.classList.remove('error');
        inp.focus();
      }, 400);
    }
  };
})();
</script>
</html>
